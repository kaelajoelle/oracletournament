{
  "version": 3,
  "sources": ["../scripts/services/config.js", "../scripts/lib/sessionsClient.js", "../scripts/ui/app.js"],
  "sourcesContent": ["export function ensureAppConfig(){\n  const cfg = window.APP_CONFIG || {};\n  const configured = typeof cfg.apiBaseUrl === 'string' ? cfg.apiBaseUrl.trim() : '';\n  if(configured){\n    const merged = { ...cfg, apiBaseUrl: configured };\n    window.APP_CONFIG = merged;\n    return merged;\n  }\n  const sameOrigin = (typeof window !== 'undefined' && window.location && window.location.origin)\n    ? `${window.location.origin.replace(/\\/$/, '')}/api`\n    : '/api';\n  console.warn('[OracleTournament] window.APP_CONFIG.apiBaseUrl is not configured; defaulting to', sameOrigin);\n  const merged = { ...cfg, apiBaseUrl: sameOrigin };\n  window.APP_CONFIG = merged;\n  return merged;\n}\n", "/**\n * Sessions Client\n * Lightweight helper for fetching session data from the /sessions endpoint.\n * This is the single source of truth for session data in the frontend.\n * \n * TODO: These functions are ready for use when the frontend is updated to fetch\n * sessions via the new /api/sessions endpoint instead of /api/state. Currently\n * the app uses SharedState.refresh() which calls /api/state. Migration to use\n * these helpers would complete the frontend's alignment with the new session API.\n */\n\n/**\n * Fetch all sessions from the API\n * TODO: Use this instead of fetching sessions via /api/state for cleaner separation\n * @param {string} apiBaseUrl - Base URL for the API (e.g., '/api' or 'https://api.example.com')\n * @returns {Promise<{sessions: Array, error: string|null}>}\n */\nexport async function fetchSessions(apiBaseUrl = '/api') {\n  try {\n    const url = `${apiBaseUrl.replace(/\\/$/, '')}/sessions`;\n    const response = await fetch(url, {\n      headers: { Accept: 'application/json' }\n    });\n    \n    if (!response.ok) {\n      const text = await response.text();\n      return { sessions: [], error: text || `Request failed (${response.status})` };\n    }\n    \n    const data = await response.json();\n    const sessions = Array.isArray(data?.sessions) ? data.sessions : [];\n    return { sessions, error: null };\n  } catch (err) {\n    return { sessions: [], error: err?.message || 'Failed to fetch sessions' };\n  }\n}\n\n/**\n * Fetch a single session by ID\n * TODO: Use this for session detail views when migrating away from /api/state\n * @param {string} sessionId - The session ID to fetch\n * @param {string} apiBaseUrl - Base URL for the API\n * @returns {Promise<{session: object|null, error: string|null}>}\n */\nexport async function fetchSessionById(sessionId, apiBaseUrl = '/api') {\n  if (!sessionId) {\n    return { session: null, error: 'Session ID is required' };\n  }\n  \n  try {\n    const url = `${apiBaseUrl.replace(/\\/$/, '')}/sessions/${encodeURIComponent(sessionId)}`;\n    const response = await fetch(url, {\n      headers: { Accept: 'application/json' }\n    });\n    \n    if (response.status === 404) {\n      return { session: null, error: 'Session not found' };\n    }\n    \n    if (!response.ok) {\n      const text = await response.text();\n      return { session: null, error: text || `Request failed (${response.status})` };\n    }\n    \n    const data = await response.json();\n    return { session: data?.session || null, error: null };\n  } catch (err) {\n    return { session: null, error: err?.message || 'Failed to fetch session' };\n  }\n}\n\n/**\n * Check if a player is already in a session\n * @param {object} session - The session object with players array\n * @param {string} playerKey - The player key to check\n * @returns {boolean}\n */\nexport function sessionHasPlayer(session, playerKey) {\n  if (!session || !playerKey) return false;\n  const normalizedKey = String(playerKey).trim().toLowerCase();\n  if (!normalizedKey) return false;\n  \n  const players = Array.isArray(session.players) ? session.players : [];\n  return players.some(player => {\n    // Check multiple possible backend field names for player identification\n    const key = String(\n      player?.key ||\n      player?.playerKey ||\n      player?.player_key ||\n      player?.code ||\n      player?.id ||\n      player?.player_id ||\n      ''\n    ).trim().toLowerCase();\n    return key === normalizedKey;\n  });\n}\n\n/**\n * Get a deep copy of sessions to avoid accidental mutation\n * TODO: Use this when caching sessions locally to prevent state corruption\n * @param {Array} sessions - Array of session objects\n * @returns {Array}\n */\nexport function cloneSessions(sessions) {\n  if (!Array.isArray(sessions)) return [];\n  return sessions.map(session => ({\n    ...session,\n    players: Array.isArray(session.players)\n      ? session.players.map(player => ({ ...player }))\n      : []\n  }));\n}\n", "import { ensureAppConfig } from '../services/config.js';\nimport { sessionHasPlayer } from '../lib/sessionsClient.js';\n\n  /* =======================\n     CONSTANTS & STORES\n  ======================= */\n\n  const APP_CONFIG = ensureAppConfig();\n\n\n\n  const API_BASE = APP_CONFIG.apiBaseUrl;\n\n  const PlayerIdentity = (()=>{\n    const STORAGE_KEY = 'player_key';\n    const GUEST_KEY = 'guest';\n    function read(){\n      try{\n        return (localStorage.getItem(STORAGE_KEY) || '').trim().toLowerCase();\n      }catch(err){\n        console.warn('Failed to read player key from storage', err);\n        return '';\n      }\n    }\n    function requireKey(){\n      const key = read();\n      if(!key){\n        window.location.href = './login.html';\n        throw new Error('Player key is required.');\n      }\n      return key;\n    }\n    function clear(){\n      try{ localStorage.removeItem(STORAGE_KEY); }catch{}\n    }\n    function getRosterEntry(){\n      const key = read();\n      if(!key) return null;\n      const roster = getRosterList({ includeHidden: true });\n      return roster.find(entry => entry.key === key) || null;\n    }\n    function isGuest(){\n      return read() === GUEST_KEY;\n    }\n    return { getKey: read, requireKey, clear, getRosterEntry, isGuest, getGuestKey: () => GUEST_KEY };\n  })();\n\n  const CURRENT_PLAYER_KEY = PlayerIdentity.requireKey();\n  const IS_GUEST_SESSION = PlayerIdentity.isGuest();\n  const READ_ONLY_NOTICE = 'Guest accounts can browse but cannot change shared data. Use your personal access code to keep editing.';\n  function requireWritable(action='perform this action'){\n    if(IS_GUEST_SESSION){\n      throw new Error(`Guest accounts cannot ${action}. ${READ_ONLY_NOTICE}`);\n    }\n  }\n\n  const DEFAULT_SHARED_STATE = {\n    sessions: [],\n    rosterExtras: [],\n    rosterMeta: {},\n    buildCards: {}\n  };\n\n  function normalisePlayer(entry){\n    if(!entry) return null;\n    if(typeof entry === 'string'){\n      const character = sanitizeName(entry);\n      if(!character) return null;\n      return { key: rosterKey(entry), character };\n    }\n    if(typeof entry !== 'object') return null;\n    const character = sanitizeName(entry.character || entry.characterName || entry.character_name || entry.name || entry.player_name || '');\n    const keySource = entry.key || entry.playerKey || entry.player_key || entry.code || entry.id || entry.player_id || character;\n    const key = rosterKey(keySource);\n    if(!key && !character){\n      return null;\n    }\n    const playerName = sanitizeName(entry.playerName || entry.player_name || entry.displayName || '');\n    return {\n      key: key || rosterKey(character),\n      character: character || playerName || key || '',\n      playerName\n    };\n  }\n\n  function normaliseSession(session){\n    if(!session || typeof session !== 'object') return null;\n    const id = String(session.id || '').trim();\n    const title = sanitizeOptional(session.title) || (id ? `Session ${id}` : 'Session');\n    const dm = sanitizeOptional(session.dm);\n    const date = String(session.date || '').trim();\n    const capacity = Number.isFinite(Number(session.capacity)) ? Number(session.capacity) : 0;\n    const players = Array.isArray(session.players)\n      ? session.players.map(normalisePlayer).filter(Boolean)\n      : [];\n    return {\n      id,\n      title,\n      dm,\n      date,\n      capacity,\n      finale: Boolean(session.finale),\n      players\n    };\n  }\n\n  function normaliseSharedState(input){\n    const safe = {\n      sessions: [],\n      rosterExtras: [],\n      rosterMeta: {},\n      buildCards: {}\n    };\n\n    if(!input || typeof input !== 'object'){\n      return safe;\n    }\n\n    if(Array.isArray(input.sessions)){\n      input.sessions.forEach((session)=>{\n        const clean = normaliseSession(session);\n        if(clean && clean.id){\n          clean.players = Array.isArray(session.players)\n            ? session.players.map(normalisePlayer).filter(Boolean)\n            : [];\n          safe.sessions.push(clean);\n        }\n      });\n    }\n\n    if(Array.isArray(input.rosterExtras)){\n      input.rosterExtras.forEach((item)=>{\n        if(!item || typeof item !== 'object') return;\n        const name = sanitizeName(item.name);\n        if(!name) return;\n        const key = rosterKey(item.key || name);\n        if(!key) return;\n        safe.rosterExtras.push({\n          key,\n          name,\n          status: sanitizeOptional(item.status),\n          notes: sanitizeOptional(item.notes),\n          custom: true\n        });\n      });\n    }\n\n    if(input.rosterMeta && typeof input.rosterMeta === 'object'){\n      Object.entries(input.rosterMeta).forEach(([rawKey, value])=>{\n        const key = rosterKey(rawKey);\n        if(!key || !value || typeof value !== 'object') return;\n        const status = sanitizeOptional(value.status);\n        const notes = sanitizeOptional(value.notes);\n        const hidden = Boolean(value.hidden);\n        if(status || notes || hidden){\n          safe.rosterMeta[key] = { status, notes, hidden };\n        }\n      });\n    }\n\n    if(input.buildCards && typeof input.buildCards === 'object'){\n      Object.entries(input.buildCards).forEach(([rawKey, card])=>{\n        const key = rosterKey(rawKey);\n        if(!key || !card || typeof card !== 'object') return;\n        const entry = {};\n        if(card.class) entry.class = sanitizeOptional(card.class);\n        if(card.university) entry.university = sanitizeOptional(card.university);\n        if(card.characterName || card.character_name || card.name){\n          entry.characterName = sanitizeName(card.characterName || card.character_name || card.name);\n        }\n        safe.buildCards[key] = entry;\n      });\n    }\n\n    return safe;\n  }\n\n  const OfflineStateStore = {\n    key: 'oracleOfflineState',\n    read(){\n      try{\n        const raw = localStorage.getItem(this.key);\n        if(!raw) return null;\n        const parsed = JSON.parse(raw);\n        if(parsed && typeof parsed === 'object' && parsed.version === 1 && parsed.state){\n          return normaliseSharedState(parsed.state);\n        }\n      }catch(err){\n        console.warn('Offline cache read failed', err);\n      }\n      return null;\n    },\n    write(state){\n      try{\n        localStorage.setItem(this.key, JSON.stringify({version:1, state}));\n      }catch(err){\n        console.warn('Offline cache write failed', err);\n      }\n    },\n    clear(){\n      try{ localStorage.removeItem(this.key); }catch{}\n    }\n  };\n\n  const NetworkStatus = (function(){\n    const banner = document.getElementById('networkBanner');\n    let pending = 0;\n    let lastError = '';\n\n    function update(){\n      if(!banner) return;\n      if(lastError){\n        banner.textContent = `\u26A0\uFE0F ${lastError}`;\n        banner.classList.add('error');\n        banner.classList.remove('loading');\n        banner.hidden = false;\n        return;\n      }\n      if(pending > 0){\n        banner.textContent = 'Syncing with the Oracle Archives\u2026';\n        banner.classList.add('loading');\n        banner.classList.remove('error');\n        banner.hidden = false;\n      } else {\n        banner.hidden = true;\n        banner.classList.remove('error');\n        banner.classList.remove('loading');\n      }\n    }\n\n    return {\n      begin(){ pending++; update(); },\n      end(){ pending = Math.max(0, pending - 1); update(); },\n      setError(message){ lastError = message || 'Network request failed.'; update(); },\n      clearError(){ lastError = ''; update(); }\n    };\n  })();\n\n  const DraftStatus = (function(){\n    const el = document.getElementById('draftStatus');\n    function set(message, tone='info'){\n      if(!el) return;\n      el.textContent = message;\n      el.dataset.tone = tone;\n    }\n    return {\n      info(message){ set(message, 'info'); },\n      success(message){ set(message, 'success'); },\n      error(message){ set(message, 'error'); }\n    };\n  })();\n\n  function withApiBase(path){\n    if(!API_BASE) return path;\n    if(/^https?:/i.test(path)) return path;\n    try{\n      return new URL(path, API_BASE).toString();\n    }catch{\n      return API_BASE.replace(/\\/$/, '') + path;\n    }\n  }\n\n  async function apiFetch(path, options={}){\n    const url = withApiBase(path);\n    const opts = {...options};\n    opts.headers = {...(options.headers||{})};\n    if(opts.body && !(opts.body instanceof FormData) && !opts.headers['Content-Type']){\n      opts.headers['Content-Type'] = 'application/json';\n    }\n\n    NetworkStatus.begin();\n    try{\n      const response = await fetch(url, opts);\n      if(!response.ok){\n        const text = await response.text();\n        throw new Error(text || `Request failed (${response.status})`);\n      }\n      const contentType = response.headers.get('content-type') || '';\n      let payload = null;\n      if(contentType.includes('application/json')){\n        payload = await response.json();\n      } else {\n        payload = await response.text();\n      }\n      NetworkStatus.clearError();\n      return payload;\n    }catch(err){\n      NetworkStatus.setError(err && err.message ? err.message : 'Network request failed.');\n      throw err;\n    }finally{\n      NetworkStatus.end();\n    }\n  }\n\nfunction renderCurrentPlayerBanner() {\n  const el = document.getElementById('current-player-banner');\n  if (!el) return;\n\n  // Get the current player key and roster entry for display name\n  const playerKey = CURRENT_PLAYER_KEY;\n  if (!playerKey) {\n    el.innerHTML = '';\n    return;\n  }\n\n  const rosterEntry = PlayerIdentity.getRosterEntry();\n  const displayName = rosterEntry?.name || playerKey;\n  const isGuest = PlayerIdentity.isGuest();\n  const displayLabel = isGuest ? 'Guest' : displayName;\n\n  el.innerHTML = `\n    <div class=\"player-banner\">\n      <span class=\"player-banner__text\">Logged in as <span class=\"player-banner__name\">${escapeHTML(displayLabel)}</span></span>\n      <button type=\"button\" class=\"player-banner__logout\" id=\"logout-btn\">Logout</button>\n    </div>\n  `;\n\n  const logoutBtn = document.getElementById('logout-btn');\n  if (logoutBtn) {\n    // Use onclick to avoid accumulating event listeners on re-render\n    logoutBtn.onclick = handleLogout;\n  }\n}\n\nfunction handleLogout() {\n  // Clear the player key from localStorage\n  PlayerIdentity.clear();\n  // Redirect to login page\n  window.location.href = './login.html';\n}\n\n\n  window.APP_UTILS = window.APP_UTILS || {};\n  window.APP_UTILS.testApiConnection = async function testApiConnection(){\n    const response = await apiFetch('/api/state', { headers:{ Accept:'application/json' } });\n    console.info('[OracleTournament] /api/state responded with:', response);\n    return response;\n  };\n\n  const SharedState = {\n    data: normaliseSharedState(DEFAULT_SHARED_STATE),\n    offline: true,\n    fallback: normaliseSharedState(DEFAULT_SHARED_STATE),\n    listeners: new Set(),\n    apply(state, source='remote'){\n      const normalised = normaliseSharedState(state);\n      this.data = normalised;\n      if(source === 'remote'){\n        OfflineStateStore.write(normalised);\n        this.offline = false;\n      } else {\n        this.offline = true;\n        if(source === 'offline-cache'){\n          OfflineStateStore.write(normalised);\n        }\n      }\n      this.notify();\n      return normalised;\n    },\n    useFallbackSessions(list){\n      if(Array.isArray(list)){\n        this.fallback.sessions = list.map((session)=>{\n          const clean = normaliseSession(session);\n          return clean ? {\n            ...clean,\n            players: Array.isArray(clean.players)\n              ? clean.players.map(player => ({ ...player }))\n              : []\n          } : null;\n        }).filter(Boolean);\n      }\n    },\n    useDefaultFallback(){\n      this.apply(this.fallback, 'offline-default');\n    },\n    loadFallbackFromCache(){\n      const cached = OfflineStateStore.read();\n      if(cached){\n        this.apply(cached, 'offline-cache');\n        return true;\n      }\n      return false;\n    },\n    async refresh(){\n      try{\n        const payload = await apiFetch('/api/state', { headers:{'Accept':'application/json'} });\n        if(!payload || typeof payload !== 'object' || !payload.state){\n          throw new Error('Invalid response from datastore.');\n        }\n        this.apply(payload.state, 'remote');\n        return this.data;\n      }catch(err){\n        const hadCache = this.loadFallbackFromCache();\n        if(!hadCache){\n          this.useDefaultFallback();\n        }\n        throw err;\n      }\n    },\n    subscribe(fn){\n      if(typeof fn === 'function'){\n        this.listeners.add(fn);\n        try{ fn(this.data); }catch(err){ console.error(err); }\n      }\n      return ()=>this.listeners.delete(fn);\n    },\n    notify(){\n      this.listeners.forEach((fn)=>{\n        try{ fn(this.data); }catch(err){ console.error(err); }\n      });\n    },\n    getSessionsCopy(){\n      return this.data.sessions.map((session)=>({\n        ...session,\n        players: Array.isArray(session.players)\n          ? session.players.map(player => ({ ...player }))\n          : []\n      }));\n    }\n  };\n\n  const Backend = {\n    async joinSession(sessionId, payload){\n      requireWritable('join sessions');\n      const rosterEntry = PlayerIdentity.getRosterEntry();\n      const body = {\n        ...payload,\n        playerKey: payload?.playerKey || CURRENT_PLAYER_KEY,\n        playerName: payload?.playerName || rosterEntry?.name || '',\n        characterName: payload?.characterName || payload?.name\n      };\n      const res = await apiFetch(`/api/sessions/${encodeURIComponent(sessionId)}/join`, {\n        method:'POST',\n        body: JSON.stringify(body)\n      });\n      if(res && res.state){\n        SharedState.apply(res.state, 'remote');\n      }\n      return res;\n    },\n    async leaveSession(sessionId, payload){\n      requireWritable('leave sessions');\n      const body = {\n        ...payload,\n        playerKey: payload?.playerKey || CURRENT_PLAYER_KEY\n      };\n      const res = await apiFetch(`/api/sessions/${encodeURIComponent(sessionId)}/leave`, {\n        method:'POST',\n        body: JSON.stringify(body)\n      });\n      if(res && res.state){\n        SharedState.apply(res.state, 'remote');\n      }\n      return res;\n    },\n    async addRosterExtra(payload){\n      requireWritable('add roster entries');\n      const res = await apiFetch('/api/roster/extras', {\n        method:'POST',\n        body: JSON.stringify(payload)\n      });\n      if(res && res.state){\n        SharedState.apply(res.state, 'remote');\n      }\n      return res;\n    },\n    async updateRosterEntry(key, payload){\n      requireWritable('edit the roster');\n      const res = await apiFetch(`/api/roster/${encodeURIComponent(key)}`, {\n        method:'PATCH',\n        body: JSON.stringify(payload)\n      });\n      if(res && res.state){\n        SharedState.apply(res.state, 'remote');\n      }\n      return res;\n    },\n    async removeRosterExtra(key){\n      requireWritable('remove roster entries');\n      const res = await apiFetch(`/api/roster/extras/${encodeURIComponent(key)}`, {\n        method:'DELETE'\n      });\n      if(res && res.state){\n        SharedState.apply(res.state, 'remote');\n      }\n      return res;\n    }\n  };\n\n  const RosterExtrasStore = {\n    read(){\n      return SharedState.data.rosterExtras;\n    }\n  };\n\n  const RosterMetaStore = {\n    read(){\n      return SharedState.data.rosterMeta;\n    }\n  };\n\n  const HTML_ESCAPE = { \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", \"\\\"\": \"&quot;\", \"'\": \"&#39;\" };\n\n  function sanitizeName(value){\n    return String(value ?? '').trim();\n  }\n\n  function sanitizeOptional(value){\n    return String(value ?? '').trim();\n  }\n\n  function rosterKey(name){\n    return sanitizeName(name).toLowerCase();\n  }\n\n  function escapeHTML(value){\n    return String(value ?? '').replace(/[&<>\"']/g, (ch)=>HTML_ESCAPE[ch]||ch);\n  }\n\n  function escapeAttr(value){\n    return escapeHTML(value);\n  }\n\n  let BASE_ROSTER_KEYS = new Set();\n\n  function rosterHasKey(key){\n    const normalised = rosterKey(key);\n    if(!normalised) return false;\n    if(BASE_ROSTER_KEYS.has(normalised)) return true;\n    return RosterExtrasStore.read().some(entry => entry.key === normalised);\n  }\n\n  async function addRosterExtra(name, status='', notes=''){\n    if(IS_GUEST_SESSION){\n      return {ok:false, msg: READ_ONLY_NOTICE};\n    }\n    const cleanName = sanitizeName(name);\n    if(!cleanName) return {ok:false, msg:'Name is required.'};\n    const key = rosterKey(cleanName);\n    if(rosterHasKey(key)) return {ok:false, msg:`${cleanName} is already on the roster.`};\n    const cleanStatus = sanitizeOptional(status);\n    const cleanNotes = sanitizeOptional(notes);\n    try{\n      await Backend.addRosterExtra({ name: cleanName, status: cleanStatus, notes: cleanNotes });\n      return {ok:true, key, name: cleanName};\n    }catch(err){\n      return {ok:false, msg: err && err.message ? err.message : 'Failed to add roster entry.'};\n    }\n  }\n\n  async function updateRosterDetails(key, entry, status, notes, hiddenOverride){\n    if(IS_GUEST_SESSION){\n      throw new Error(READ_ONLY_NOTICE);\n    }\n    const cleanKey = rosterKey(key);\n    if(!cleanKey) return;\n    const cleanStatus = sanitizeOptional(status);\n    const cleanNotes = sanitizeOptional(notes);\n    const hidden = hiddenOverride == null ? Boolean(entry && entry.hidden) : Boolean(hiddenOverride);\n    await Backend.updateRosterEntry(cleanKey, {\n      status: cleanStatus,\n      notes: cleanNotes,\n      custom: Boolean(entry && entry.custom),\n      name: entry && entry.name ? sanitizeName(entry.name) : '',\n      hidden\n    });\n  }\n\n  async function setRosterHidden(entry, hidden){\n    if(IS_GUEST_SESSION){\n      throw new Error(READ_ONLY_NOTICE);\n    }\n    if(!entry || !entry.key) return;\n    await updateRosterDetails(entry.key, entry, entry.status, entry.notes, hidden);\n  }\n\n  async function removeRosterExtra(key){\n    if(IS_GUEST_SESSION){\n      throw new Error(READ_ONLY_NOTICE);\n    }\n    const cleanKey = rosterKey(key);\n    if(!cleanKey) return;\n    await Backend.removeRosterExtra(cleanKey);\n  }\n\n  function getRosterList(opts={}){\n    const includeHidden = Boolean(opts.includeHidden);\n    const extras = RosterExtrasStore.read();\n    const meta = RosterMetaStore.read();\n    const list = [];\n\n    DATA.roster.forEach((r)=>{\n      const key = rosterKey(r.key || r.name);\n      const override = meta[key] || {};\n      const entry = {\n        name: r.name,\n        key,\n        status: override.status || sanitizeOptional(r.status),\n        notes: override.notes || sanitizeOptional(r.notes),\n        custom: false,\n        hidden: Boolean(override.hidden)\n      };\n      if(entry.hidden && !includeHidden){\n        return;\n      }\n      list.push(entry);\n    });\n\n    extras.forEach((item)=>{\n      const key = rosterKey(item.key || item.name);\n      const override = meta[key] || {};\n      const entry = {\n        name: item.name,\n        key,\n        status: override.status || sanitizeOptional(item.status),\n        notes: override.notes || sanitizeOptional(item.notes),\n        custom: true,\n        hidden: Boolean(override.hidden)\n      };\n      if(entry.hidden && !includeHidden){\n        return;\n      }\n      list.push(entry);\n    });\n\n    return list.sort((a,b)=>a.name.localeCompare(b.name,'en',{sensitivity:'base'}));\n  }\n\n  function getHiddenRosterEntries(){\n    return getRosterList({ includeHidden: true }).filter(entry => entry.hidden);\n  }\n\n  function labelDate(iso){\n    try{\n      const dt = new Date(iso + 'T00:00:00');\n      return dt.toLocaleDateString('en-CA',{month:'short', day:'2-digit'}); // e.g., Dec 21\n    }catch{ return iso; }\n  }\n\n  function toLocalICS(dt){\n    const pad = n => String(n).padStart(2,'0');\n    return dt.getFullYear()+pad(dt.getMonth()+1)+pad(dt.getDate())+'T'+pad(dt.getHours())+pad(dt.getMinutes())+pad(dt.getSeconds());\n  }\n\n  function downloadICS(session){\n    const tz = 'America/Edmonton';\n    // default 7\u20139pm local\n    const start = new Date(session.date + 'T19:00:00');\n    const end   = new Date(session.date + 'T21:00:00');\n    const uid = `${session.id}@oracletrials`;\n    const ics = [\n      'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//OracleTrials//Scheduler//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',\n      `UID:${uid}`,\n      `SUMMARY:${session.title}`,\n      `DESCRIPTION:DM: ${session.dm} | Capacity: ${session.capacity}`,\n      `DTSTART;TZID=${tz}:${toLocalICS(start)}`,\n      `DTEND;TZID=${tz}:${toLocalICS(end)}`,\n      'END:VEVENT','END:VCALENDAR'\n    ].join('\\r\\n');\n    const blob = new Blob([ics], {type:'text/calendar'});\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = `${session.title.replace(/\\s+/g,'-')}.ics`;\n    a.click();\n    URL.revokeObjectURL(a.href);\n  }\n\n  /* =======================\n     DATA\n  ======================= */\n  const DATA = {\n    levels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],\n    abilityArrays:{ standard:[15,14,13,12,10,8] },\n    universities:[\n      { key:'lorehold', name:'Lorehold', theme:'History & Spirits', colours:'Red/White', focus:'Archaeomancy', playstyle:'Scholar / Explorer', flavour:'Delve into the past with spirits and flame. History is never dead here.', spells:{\n          1:['Comprehend Languages','Identify'],\n          2:['Borrowed Knowledge','Locate Object'],\n          3:['Speak with Dead','Spirit Guardians'],\n          4:['Arcane Eye','Stone Shape'],\n          5:['Flame Strike','Legend Lore']\n      }},\n      { key:'prismari', name:'Prismari', theme:'Elemental Arts', colours:'Blue/Red', focus:'Performance & Elements', playstyle:'Passion / Spectacle', flavour:'Express yourself through elemental fury. Art meets raw magical power.', spells:{\n          1:['Chromatic Orb','Thunderwave'],\n          2:['Flaming Sphere','Kinetic Jaunt'],\n          3:['Haste','Water Walk'],\n          4:['Freedom of Movement','Wall of Fire'],\n          5:['Cone of Cold','Conjure Elemental']\n      }},\n      { key:'quandrix', name:'Quandrix', theme:'Math & Nature', colours:'Blue/Green', focus:'Fractals / Growth', playstyle:'Logical / Curious', flavour:'Bend reality with mathematics. Nature obeys those who understand its formulas.', spells:{\n          1:['Entangle','Guiding Bolt'],\n          2:['Enlarge/Reduce','Vortex Warp'],\n          3:['Aura of Vitality','Haste'],\n          4:['Control Water','Freedom of Movement'],\n          5:['Circle of Power','Passwall']\n      }},\n      { key:'silverquill', name:'Silverquill', theme:'Eloquence & Ink', colours:'White/Black', focus:'Radiance & Shadow', playstyle:'Charisma / Wit', flavour:'Words cut deeper than blades. Master the magic of eloquence and shadow.', spells:{\n          1:['Dissonant Whispers','Silvery Barbs'],\n          2:['Calm Emotions','Darkness'],\n          3:['Beacon of Hope','Daylight'],\n          4:['Compulsion','Confusion'],\n          5:['Dominate Person','Rary\u2019s Telepathic Bond']\n      }},\n      { key:'witherbloom', name:'Witherbloom', theme:'Life & Decay', colours:'Green/Black', focus:'Alchemy / Essence', playstyle:'Healer / Witch', flavour:'Life and death are two sides of one coin. Embrace the cycle and thrive.', spells:{\n          1:['Cure Wounds','Inflict Wounds'],\n          2:['Lesser Restoration','Wither and Bloom'],\n          3:['Revivify','Vampiric Touch'],\n          4:['Blight','Death Ward'],\n          5:['Antilife Shell','Greater Restoration']\n      }}\n    ],\n    backgrounds:[\n      {key:'lorehold-student', name:'Lorehold Student', skills:['History','Religion'], tools:[], languages:'2 of choice', gear:['Ink/pen','Hammer','Lantern','History tome','Uniform'], feat:'Strixhaven Initiate (Lorehold)'},\n      {key:'prismari-student', name:'Prismari Student', skills:['Acrobatics','Performance'], tools:['+1 instrument/tool'], languages:'1', gear:['Ink/pen','Artisan tools or Instrument','Uniform'], feat:'Strixhaven Initiate (Prismari)'},\n      {key:'quandrix-student', name:'Quandrix Student', skills:['Arcana','Nature'], tools:['+1 artisan tool'], languages:'1', gear:['Ink/pen','Abacus','Arcane theory book','Uniform'], feat:'Strixhaven Initiite (Silverquill)'},\n      {key:'silverquill-student', name:'Silverquill Student', skills:['Intimidation','Persuasion'], tools:[], languages:'2', gear:['Ink/pen','Poetry book','Uniform'], feat:'Strixhaven Initiite (Silverquill)'},\n      {key:'witherbloom-student', name:'Witherbloom Student', skills:['Nature','Survival'], tools:['Herbalism Kit'], languages:'1', gear:['Plant ID book','Iron pot','Herbalism kit','Uniform'], feat:'Strixhaven Initiate (Witherbloom)'}\n    ],\n    feats:{\n      strixhavenInitiate:{\n        name:'Strixhaven Initiate',\n        text:'Choose your college; learn 2 cantrips from its list + one 1st-level spell. Cast the 1st-level spell once per long rest without a slot; also with slots. Choose Int/Wis/Cha as spellcasting ability for these.'\n      }\n    },\n    extracurriculars:[\n      {key:'dead-languages', name:'Dead Languages Society', skills:['Athletics','History']},\n      {key:'fine-artists', name:'Distinguished Society of Fine Artists', skills:['Performance','Sleight of Hand']},\n      {key:'dragonchess', name:'Dragonchess Club', skills:['Deception','Investigation']},\n      {key:'historical-soc', name:'Dragonsguard Historical Society', skills:['Arcana','History']},\n      {key:'horticulture', name:'Fantastical Horticulture Club', skills:['Nature','Survival']},\n      {key:'entrepreneurs', name:'Future Entrepreneurs of Strixhaven', skills:['Insight','Persuasion']},\n      {key:'gymnastics', name:'Intramural Gymnastics', skills:['Acrobatics','Performance']},\n      {key:'silkball', name:'Silkball Club', skills:['Athletics','Intimidation']},\n      {key:'water-dance', name:'Water-Dancing Club', skills:['Athletics','Performance']},\n      {key:'larp', name:'LARP Guild', skills:['Animal Handling','Performance']},\n      {key:'cheer', name:'Mage Tower Cheer', skills:['Perception','Persuasion']},\n      {key:'drama', name:'Playactors Drama Guild', skills:['Arcana','Deception']},\n      {key:'iron-lifters', name:'Iron-Lifters', skills:['Athletics','Medicine']},\n      {key:'show-band', name:'Show Band', skills:['Sleight of Hand','Performance']},\n      {key:'newspaper', name:'Strixhaven Star (Newspaper)', skills:['Investigation','Insight']},\n      {key:'faith', name:'Student-Mages of Faith', skills:['Insight','Religion']}\n    ],\n    jobs:[\n      {key:'biblioplex', name:'Biblioplex', skills:['Arcana','History']},\n      {key:'firejolt', name:'Firejolt Caf\u00E9', skills:['Insight','Persuasion']},\n      {key:'bowsend', name:\"Bow's End Tavern\", skills:['Performance','Deception']},\n      {key:'stadium', name:'Stadium', skills:['Athletics','Intimidation']},\n      {key:'performing-arts', name:'Performing Arts Society', skills:['Performance','Deception']},\n      {key:'dorms', name:'Dormitories', skills:['Persuasion','Perception']},\n      {key:'grounds', name:'Campus Grounds', skills:['Nature','Survival']},\n      {key:'labs', name:'Magic Labs', skills:['Arcana','Investigation']},\n      {key:'intramural', name:'Intramural Fields', skills:['Athletics','Acrobatics']}\n    ],\n    roster:[\n       { name: 'Kaela',        status: 'Yes', key: 'kaela123' },\n\n  { name: 'Tory DM',      status: 'Yes', key: 'torydm123' },\n  { name: 'Mike',         status: 'Pending', key: 'mike2025' },\n  { name: 'Megan',        status: 'Pending', key: 'megan2025' },\n  { name: 'Jocelyn',      status: 'Pending', key: 'joss2025' },\n  { name: 'Emory',        status: 'Pending', key: 'emory2025' },\n  { name: 'Snack Erin',   status: 'Yes', key: 'snacks' },\n  { name: 'Erin',         status: 'Yes', key: 'erin2627' },\n  { name: 'Trevor',       status: 'Yes', key: 'trev2227' },\n  { name: 'Amy',          status: 'Yes', key: 'amyoracle' },\n  { name: 'Nicole',       status: 'Yes', key: 'nicole2627' },\n  { name: 'Spencer',      status: 'Yes', key: 'spence2627' },\n  { name: 'Marvin',       status: 'Pending', key: 'marv2025' },\n  { name: 'Megan E',      status: 'Pending', key: 'megane2025' },\n  { name: 'Jordan',       status: 'Pending', key: 'jordan2025' },\n  { name: 'Becca',        status: 'Yes', key: 'becca2728' },\n  { name: 'Evan',         status: 'Yes', key: 'evan2728' },\n  { name: 'Lyric',        status: 'Pending', key: 'lyric2025' },\n  { name: 'Lazarus',      status: 'Yes', key: 'laz_kids' },\n  { name: 'Aramis',       status: 'Pending', key: 'aramis2025' },\n  { name: 'James',        status: 'Pending', key: 'james2025' },\n  { name: 'David',        status: 'Pending', key: 'david2025' },\n  { name: 'Nova',         status: 'Yes', key: 'nova_any' },\n  { name: 'Melissa',      status: 'Yes', key: 'melissa_not28' },\n  { name: 'Josh',         status: 'Yes', key: 'josh222729' },\n  { name: 'Marilyn',      status: 'Pending', key: 'marilyn2025' },\n    ],\n    sessions:[]\n  };\n\n  // Always render roster A\u2192Z without risk to source order\n  DATA.roster = [...DATA.roster].sort((a,b)=>a.name.localeCompare(b.name,'en'));\n  BASE_ROSTER_KEYS = new Set(DATA.roster.map(r=>rosterKey(r.key || r.name)));\n\n  SharedState.useDefaultFallback();\n\n  // Optional quick rule examples\n  const ELIGIBILITY = {\n    hardNo: [ 'Link' ],\n    blockedDates: { 'Melissa': ['2025-12-28'] }\n  };\n\n  /* =======================\n     VALIDATION & ERROR HANDLING\n  ======================= */\n  function validateConfig(){\n    const errors=[];\n\n    try{\n      if(!Array.isArray(DATA.sessions)) errors.push('DATA.sessions is missing or not an array.');\n      else{\n        const ids=new Set();\n        DATA.sessions.forEach((s,idx)=>{\n          if(!s || typeof s!=='object'){ errors.push(`sessions[${idx}] is not an object`); return; }\n          if(!s.id) errors.push(`sessions[${idx}] is missing an id`);\n          if(s.id){ if(ids.has(s.id)) errors.push(`Duplicate session id: ${s.id}`); else ids.add(s.id); }\n          if(!/^\\d{4}-\\d{2}-\\d{2}$/.test(String(s.date||''))) errors.push(`${s.title||s.id||('session#'+idx)} has non-ISO date \"${s.date}\"`);\n          if(typeof s.capacity !== 'number') errors.push(`${s.title||s.id||('session#'+idx)} capacity must be a number`);\n        });\n      }\n    }catch{ errors.push('DATA.sessions could not be validated.'); }\n\n    try{ if(!Array.isArray(DATA.roster)) errors.push('DATA.roster is missing or not an array.'); }\n    catch{ errors.push('DATA.roster could not be validated.'); }\n\n    return errors;\n  }\n\n  function showErrors(errors){\n    if(!errors || !errors.length) return;\n    const main=document.querySelector('main');\n    const box=document.createElement('div');\n    box.className='panel';\n    box.style.border='1px solid #f14a3b';\n    box.style.background='#1d1111';\n    box.innerHTML = `\n      <h2>Configuration issues</h2>\n      <p>Fix the items below, then refresh. If you changed dates/IDs recently, hit <strong>Clear Local Data</strong> in the sidebar.</p>\n      <ul>${errors.map(e=>`<li>${e.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</li>`).join('')}</ul>\n    `;\n    main.prepend(box);\n  }\n\n  window.addEventListener('error', (e)=>{\n    const main=document.querySelector('main');\n    if(!main) return;\n    const box=document.createElement('div');\n    box.className='panel';\n    box.style.border='1px solid #f14a3b';\n    box.style.background='#1d1111';\n    box.innerHTML=`<strong>Runtime error:</strong> ${String(e.message||'Unknown error')}`;\n    main.prepend(box);\n  });\n\n  /* =======================\n     STATE\n  ======================= */\n  const LocalDraftStore = {\n    key: 'oracleTrialsSave',\n    read(){\n      try{\n        const raw = localStorage.getItem(this.key);\n        if(!raw) return null;\n        return JSON.parse(raw);\n      }catch(err){\n        console.warn('Local draft read failed', err);\n        return null;\n      }\n    },\n    write(data){\n      try{\n        localStorage.setItem(this.key, JSON.stringify(data));\n      }catch(err){\n        console.warn('Local draft write failed', err);\n      }\n    },\n    clear(){\n      try{ localStorage.removeItem(this.key); }catch(err){ console.warn('Local draft clear failed', err); }\n    }\n  };\n\n  function cloneDraftData(data){\n    try{\n      return JSON.parse(JSON.stringify(data || {}));\n    }catch(err){\n      console.warn('Draft clone failed', err);\n      return {};\n    }\n  }\n\n  // Legacy CharacterDraftsApi - DEPRECATED\n  // The /api/characters/:playerKey endpoint has been disabled.\n  // Build persistence now uses the new /api/builds/:playerKey endpoints instead.\n  const CharacterDraftsApi = {\n    async saveDraft(){\n      console.info('[CharacterDraftsApi] saveDraft is deprecated. Using /api/builds for persistence.');\n      return null;\n    },\n    async loadDraft(){\n      console.info('[CharacterDraftsApi] loadDraft is deprecated. Using /api/builds for persistence.');\n      return null;\n    }\n  };\n\n  // Oracle Build Persistence API\n  // These functions load and save full Oracle builds via the new /api/builds endpoints\n  async function loadSavedBuildForPlayer(playerKey) {\n    if (!playerKey) {\n      console.warn('loadSavedBuildForPlayer: no playerKey provided');\n      return null;\n    }\n    try {\n      const encoded = encodeURIComponent(playerKey);\n      const response = await fetch(withApiBase(`/api/builds/${encoded}`), {\n        headers: { Accept: 'application/json' }\n      });\n      if (response.status === 404) {\n        // No saved build yet - this is fine for new players\n        return null;\n      }\n      if (!response.ok) {\n        const text = await response.text();\n        console.error('loadSavedBuildForPlayer failed:', text);\n        return null;\n      }\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('loadSavedBuildForPlayer error:', err);\n      return null;\n    }\n  }\n\n  async function saveBuildForPlayer(playerKey, build) {\n    if (!playerKey) {\n      console.warn('saveBuildForPlayer: no playerKey provided');\n      return false;\n    }\n    if (!build || typeof build !== 'object') {\n      console.warn('saveBuildForPlayer: invalid build object');\n      return false;\n    }\n    try {\n      const encoded = encodeURIComponent(playerKey);\n      const response = await fetch(withApiBase(`/api/builds/${encoded}`), {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(build)\n      });\n      if (!response.ok) {\n        const text = await response.text();\n        console.error('saveBuildForPlayer failed:', text);\n        return false;\n      }\n      return true;\n    } catch (err) {\n      console.error('saveBuildForPlayer error:', err);\n      return false;\n    }\n  }\n\n  const State = {\n    data:{\n      meta:{version:'0.5-stable'},\n      core:{ playerName:'', name:'', race:'', class:'', background:'', level:4, abilityMethod:'standard', abilities:{STR:15,DEX:14,CON:13,INT:12,WIS:10,CHA:8}, equipment:'class'},\n      university:{ key:'', spellAbility:'INT' },\n      feats:[],\n      extras:{ job:null, clubs:[], studentDice:[] },\n      personality:{ traits:'', ideal:'', bond:'', rival:'', goal:'', prompt:'' },\n      exams:{ notes:'', studyRerolls:0, results:[] }\n    },\n    sessions: [],\n    async save(){\n      const snapshot = cloneDraftData(this.data);\n      LocalDraftStore.write(snapshot);\n      DraftStatus.info('Draft saved locally.');\n      \n      if(!IS_GUEST_SESSION){\n        // Persist to Supabase via /api/builds endpoint (fire-and-forget)\n        // saveBuildForPlayer handles its own errors and returns boolean\n        saveBuildForPlayer(CURRENT_PLAYER_KEY, snapshot).then(ok => {\n          if(ok){\n            console.info('Build synced to Oracle Archives via /api/builds');\n            DraftStatus.success('Draft saved locally and synced to the Oracle Archives.');\n          } else {\n            console.warn('Build sync returned false');\n            DraftStatus.info('Draft saved locally. Sync to Oracle Archives may have failed.');\n          }\n        });\n        return true;\n      }\n      \n      DraftStatus.info('Guest saves stay in this browser. Enter your access code to sync online.');\n      return true;\n    },\n    async load(){\n      // Try local draft first\n      const localDraft = LocalDraftStore.read();\n      if(localDraft){\n        this.data = cloneDraftData(localDraft);\n        renderAll();\n        DraftStatus.info('Loaded the draft stored in this browser.');\n        return true;\n      }\n      \n      // If not guest and no local draft, try to load from /api/builds\n      // loadSavedBuildForPlayer handles its own errors and returns null on failure\n      if(!IS_GUEST_SESSION){\n        const savedBuild = await loadSavedBuildForPlayer(CURRENT_PLAYER_KEY);\n        if(savedBuild && typeof savedBuild === 'object'){\n          this.data = cloneDraftData(savedBuild);\n          LocalDraftStore.write(this.data);\n          renderAll();\n          DraftStatus.success('Draft loaded from the Oracle Archives.');\n          return true;\n        }\n        // No saved build found in Oracle Archives - fall through to \"no drafts\" message\n      }\n      \n      DraftStatus.error('No saved drafts yet.');\n      alert('No saved draft found. Create and save a character first.');\n      return false;\n    },\n    export(){ const blob=new Blob([JSON.stringify({character:this.data, sessions:this.sessions},null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`oracle-trials-${(this.data.core.name||'character').toLowerCase().replace(/[^a-z0-9-]/g,'-')}.json`; a.click(); URL.revokeObjectURL(url); }\n  };\n\n  SharedState.subscribe(()=>{\n    State.sessions = SharedState.getSessionsCopy();\n    if(State?.data?.core){\n      const rosterEntry = PlayerIdentity.getRosterEntry();\n      if(rosterEntry && !State.data.core.playerName){\n        State.data.core.playerName = rosterEntry.name;\n      }\n    }\n  });\n\n  /* =======================\n     HELPERS\n  ======================= */\n\n// Dashboard: renders \"My Character\" and \"My Session\" summary cards\nfunction renderDashboard() {\n  // My Character card\n  const core = State.data?.core || {};\n  const uni = State.data?.university || {};\n  const hasCharacter = core.name && core.name.trim().length > 0;\n  \n  let characterContent = '';\n  if (hasCharacter) {\n    const charName = escapeHTML(core.name || '');\n    const charClass = escapeHTML(core.class || 'No class');\n    const charLevel = core.level || '?';\n    const uniKey = uni.key || '';\n    const uniName = uniKey ? ((DATA.universities || []).find(u => u.key === uniKey)?.name || uniKey) : 'No college';\n    characterContent = `\n      <div class=\"dashboard-stat\"><strong>${charName}</strong></div>\n      <div class=\"dashboard-detail\">${charClass} \u2022 Level ${charLevel}</div>\n      <div class=\"dashboard-detail\">${escapeHTML(uniName)}</div>\n      <button class=\"secondary dashboard-btn\" data-nav=\"builder\">Edit Character \u2192</button>\n    `;\n  } else {\n    characterContent = `\n      <div class=\"dashboard-empty\">No character saved yet.</div>\n      <div class=\"muted\">Visit the Character Builder step to get started.</div>\n      <button class=\"primary dashboard-btn\" data-nav=\"builder\">Create Character \u2192</button>\n    `;\n  }\n\n  // My Session card\n  const sessions = State.sessions || [];\n  let playerSession = null;\n  for (const s of sessions) {\n    if (CURRENT_PLAYER_KEY && sessionHasPlayer(s, CURRENT_PLAYER_KEY)) {\n      playerSession = s;\n      break;\n    }\n  }\n\n  let sessionContent = '';\n  if (playerSession) {\n    const filled = (playerSession.players || []).length;\n    sessionContent = `\n      <div class=\"dashboard-stat\"><strong>${escapeHTML(playerSession.title)}</strong></div>\n      <div class=\"dashboard-detail\">${escapeHTML(playerSession.date)} \u2022 DM: ${escapeHTML(playerSession.dm || 'TBD')}</div>\n      <div class=\"dashboard-detail\">Capacity: ${filled}/${playerSession.capacity}</div>\n      <button class=\"secondary dashboard-btn\" data-nav=\"join\">View Sessions \u2192</button>\n    `;\n  } else {\n    sessionContent = `\n      <div class=\"dashboard-empty\">You have not joined a Trial yet.</div>\n      <div class=\"muted\">Pick a session to reserve your seat.</div>\n      <button class=\"primary dashboard-btn\" data-nav=\"join\">Join a Session \u2192</button>\n    `;\n  }\n\n  return `\n<div class=\"dashboard-panel\">\n  <div class=\"dashboard-grid\">\n    <div class=\"dashboard-card\" id=\"dashboard-character\">\n      <h4 class=\"dashboard-title\">\uD83D\uDCDC My Character</h4>\n      ${characterContent}\n    </div>\n    <div class=\"dashboard-card\" id=\"dashboard-session\">\n      <h4 class=\"dashboard-title\">\uD83C\uDFAD My Session</h4>\n      ${sessionContent}\n    </div>\n  </div>\n</div>\n`;\n}\n\n// Wire up dashboard navigation buttons\nfunction bindDashboardNav(container) {\n  container.querySelectorAll('button[data-nav]').forEach(btn => {\n    btn.onclick = () => {\n      const target = btn.dataset.nav;\n      if (!STEPS) return;\n      const idx = STEPS.findIndex(s => s.key === target);\n      if (idx >= 0) {\n        activateStep(idx, true);\n      }\n    };\n  });\n}\n    \nfunction buildReady() {\n  const c = State.data.core || {};\n  const uni = State.data.university || {};\n  return Boolean(\n    (c.name && c.name.trim().length >= 2) &&\n    (c.class && c.class.trim()) &&\n    (c.level && Number.isFinite(+c.level)) &&\n    (uni.key && uni.key.trim())\n  );\n}\n\n\n// Reusable card list\nfunction renderSessionCards(container, opts={readOnly:false}){\n  const {readOnly=false} = opts;\n  container.innerHTML = '';\n  const builds = SharedState.data.buildCards || {};\n\n  State.sessions\n    .slice()\n    .sort((a,b)=>a.date.localeCompare(b.date))\n    .forEach(s=>{\n      const filled = (s.players||[]).length;\n      const full = filled>=s.capacity;\n      // Check if current player is in this session (handles null/undefined CURRENT_PLAYER_KEY safely)\n      const playerInSession = CURRENT_PLAYER_KEY ? sessionHasPlayer(s, CURRENT_PLAYER_KEY) : false;\n      const roster = filled\n        ? (Array.isArray(s.players) ? s.players : []).map(player=>{\n            const b = player && player.key ? builds[player.key] : null;\n            let extra = '';\n            if(b){\n              const classLabel = escapeHTML(b.class || '?');\n              const uniLabel = escapeHTML(b.university || '?');\n              extra = ` \u2014 <span class=\"muted\">${classLabel} \u2022 ${uniLabel}</span>`;\n            }\n            const label = escapeHTML(player && (player.character || player.name || player.playerName || 'Player'));\n            // Highlight the current player's entry\n            const isCurrentPlayer = rosterKey(player && player.key) === CURRENT_PLAYER_KEY;\n            const pillClass = isCurrentPlayer ? 'pill pill--highlight' : 'pill';\n            return `<div class=\"${pillClass}\"><span>${label}</span>${extra}</div>`;\n          }).join('')\n        : '<span class=\"muted\">No players yet</span>';\n\n      // Determine which button to show: Join or Leave\n      let actionBtn = '';\n      if (!readOnly) {\n        if (playerInSession) {\n          // Player is already in this session - show Leave button\n          actionBtn = `<button data-leave-id=\"${escapeAttr(s.id)}\" class=\"danger\">Leave this session</button>`;\n        } else {\n          // Player is not in this session - show Join button (disabled if full or build not ready)\n          const joinDisabled = (!buildReady() || full) ? 'disabled' : '';\n          actionBtn = `<button data-id=\"${escapeAttr(s.id)}\" class=\"primary\" ${joinDisabled}>Add my character</button>`;\n        }\n      }\n      \n      // Display enriched trial metadata\n      const themeInfo = s.theme ? `<div class=\"muted\"><strong>Theme:</strong> ${escapeHTML(s.theme)}</div>` : '';\n      const focusInfo = s.focus ? `<div class=\"muted\"><strong>Focus:</strong> ${escapeHTML(s.focus)}</div>` : '';\n      const finaleIndicator = s.finale ? '<span class=\"tag tag--finale\">\u2605 Finale</span>' : '';\n      const playerIndicator = playerInSession ? '<span class=\"tag tag--joined\">\u2713 Joined</span>' : '';\n\n      const card = document.createElement('div'); \n      card.className = playerInSession ? 'card card--joined' : 'card';\n      card.innerHTML = `\n        <div class=\"flex\" style=\"justify-content:space-between\">\n          <div>\n            <strong>${escapeHTML(s.title)}</strong> ${finaleIndicator} ${playerIndicator}\n            <div class=\"muted\">${escapeHTML(s.date)} \u2022 DM: ${escapeHTML(s.dm || '')} \u2022 Capacity: ${filled}/${s.capacity}</div>\n            ${themeInfo}\n            ${focusInfo}\n            <div class=\"muted\" style=\"margin-top:4px\">No duplicate universities allowed in the same session.</div>\n            ${(!readOnly && !playerInSession && !buildReady()) ? `<div class=\"muted\" style=\"margin-top:6px\">Finish <em>Core 5e</em> + choose a <em>University</em> to join.</div>` : ''}\n            ${(!readOnly && !playerInSession && full) ? `<div class=\"muted\" style=\"margin-top:6px\">This session is full.</div>` : ''}\n          </div>\n          <div class=\"flex\">\n            ${actionBtn}\n            <button data-ics=\"${s.id}\">.ics</button>\n          </div>\n        </div>\n        <div style=\"margin-top:8px\" class=\"flex\">${roster}</div>\n      `;\n      container.appendChild(card);\n    });\n}\n\nfunction setupCommentBoard(root){\n  const form = root.querySelector('#commentForm');\n  const textarea = root.querySelector('#commentText');\n  const playerInput = root.querySelector('#commentPlayer');\n  const characterInput = root.querySelector('#commentCharacter');\n  const sessionInput = root.querySelector('#commentSession');\n  const list = root.querySelector('#commentList');\n  const refreshBtn = root.querySelector('#refreshComments');\n  const status = root.querySelector('#commentStatus');\n  if(!form || !textarea || !list) return;\n\n  let statusTimer = 0;\n  const submitButton = form.querySelector('button[type=\"submit\"]');\n  const commentsReadOnly = IS_GUEST_SESSION;\n\n  const announce = (message, tone='success')=>{\n    if(!status) return;\n    try{ window.clearTimeout(statusTimer); }catch{}\n    status.textContent = message;\n    status.dataset.tone = tone;\n    status.hidden = false;\n    statusTimer = window.setTimeout(()=>{ status.hidden = true; }, 3600);\n  };\n\n  if(status){\n    status.hidden = true;\n  }\n\n  if(commentsReadOnly){\n    [textarea, playerInput, characterInput, sessionInput].forEach((inputEl)=>{\n      if(inputEl){\n        inputEl.disabled = true;\n        inputEl.setAttribute('aria-disabled', 'true');\n      }\n    });\n    if(submitButton){\n      submitButton.disabled = true;\n      submitButton.title = READ_ONLY_NOTICE;\n      submitButton.textContent = 'Comments disabled for guests';\n    }\n    const note = document.createElement('p');\n    note.className = 'muted';\n    note.textContent = READ_ONLY_NOTICE;\n    form.appendChild(note);\n  }\n\n  const formatStamp = (iso)=>{\n    try{\n      const date = new Date(iso);\n      return date.toLocaleString(undefined, {\n        month:'short', day:'numeric',\n        hour:'numeric', minute:'2-digit'\n      });\n    }catch{\n      return iso;\n    }\n  };\n\n  const sortComments = (entries)=> entries.slice().sort((a, b)=>{\n    const aTime = new Date(a?.createdAt || 0).getTime();\n    const bTime = new Date(b?.createdAt || 0).getTime();\n    return bTime - aTime;\n  });\n\n  const normaliseComment = (input)=>{\n    if(!input || typeof input !== 'object') return null;\n    const baseId = (input.id ?? input.comment_id ?? '').toString().trim();\n    const textValue = (input.comment ?? input.text ?? '').toString().trim();\n    if(!textValue){\n      return null;\n    }\n    const playerName = sanitizeOptional(input.playerName ?? input.player_name);\n    const characterName = sanitizeOptional(input.characterName ?? input.character_name);\n    const sessionId = sanitizeOptional(input.sessionId ?? input.session_id);\n    let createdAt = input.createdAt || input.created_at || input.stamp;\n    if(createdAt){\n      const stamp = new Date(createdAt);\n      createdAt = Number.isNaN(stamp.getTime()) ? new Date().toISOString() : stamp.toISOString();\n    }else{\n      createdAt = new Date().toISOString();\n    }\n    const id = baseId || `local-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n    return {\n      id,\n      playerName,\n      characterName,\n      sessionId,\n      comment: textValue,\n      createdAt\n    };\n  };\n\n  const state = {\n    comments: [],\n    loading: false\n  };\n\n  const setComments = (entries)=>{\n    const seen = new Set();\n    const cleaned = [];\n    (entries || []).forEach((entry)=>{\n      const normalised = entry && entry.comment ? entry : normaliseComment(entry);\n      if(!normalised || !normalised.comment){\n        return;\n      }\n      if(seen.has(normalised.id)){\n        return;\n      }\n      seen.add(normalised.id);\n      cleaned.push(normalised);\n    });\n    state.comments = sortComments(cleaned);\n    return state.comments;\n  };\n\n  const renderList = ()=>{\n    if(state.loading){\n      list.innerHTML = '<p class=\"comment-empty\">Loading comments\u2026</p>';\n      return;\n    }\n    if(!state.comments.length){\n      list.innerHTML = '<p class=\"comment-empty\">No comments yet. Add the first note above.</p>';\n      return;\n    }\n    list.innerHTML = '';\n    state.comments.forEach((entry)=>{\n      if(!entry || !entry.comment) return;\n      const item = document.createElement('div');\n      item.className = 'comment-item';\n      item.dataset.pending = entry.pending ? 'true' : 'false';\n\n      const copy = document.createElement('p');\n      copy.textContent = entry.comment;\n      item.appendChild(copy);\n\n      if(entry.playerName || entry.characterName || entry.sessionId){\n        const meta = document.createElement('div');\n        meta.className = 'comment-meta';\n        if(entry.playerName){\n          const span = document.createElement('span');\n          span.textContent = `Player: ${entry.playerName}`;\n          meta.appendChild(span);\n        }\n        if(entry.characterName){\n          const span = document.createElement('span');\n          span.textContent = `Character: ${entry.characterName}`;\n          meta.appendChild(span);\n        }\n        if(entry.sessionId){\n          const span = document.createElement('span');\n          span.textContent = `Session: ${entry.sessionId}`;\n          meta.appendChild(span);\n        }\n        item.appendChild(meta);\n      }\n\n      const stamp = document.createElement('time');\n      stamp.dateTime = entry.createdAt;\n      stamp.textContent = formatStamp(entry.createdAt);\n      item.appendChild(stamp);\n\n      const remove = document.createElement('button');\n      remove.type = 'button';\n      remove.className = 'danger';\n      if(entry.pending){\n        remove.textContent = 'Posting\u2026';\n        remove.disabled = true;\n      }else if(commentsReadOnly){\n        remove.textContent = 'Delete';\n        remove.disabled = true;\n        remove.title = READ_ONLY_NOTICE;\n      }else{\n        remove.textContent = 'Delete';\n        remove.addEventListener('click', ()=>{\n          void handleDelete(entry);\n        });\n      }\n      item.appendChild(remove);\n\n      list.appendChild(item);\n    });\n  };\n\n  const fetchComments = async ({ silent = false } = {})=>{\n    state.loading = true;\n    renderList();\n    try{\n      const payload = await apiFetch('/api/comments', { headers:{ Accept:'application/json' } });\n      const rows = Array.isArray(payload?.comments) ? payload.comments : [];\n      setComments(rows.map(normaliseComment).filter(Boolean));\n      if(!silent){\n        announce('Comments updated.', 'info');\n      }\n    }catch(err){\n      if(!silent){\n        announce(err && err.message ? err.message : 'Failed to load comments.', 'error');\n      }\n      throw err;\n    }finally{\n      state.loading = false;\n      renderList();\n    }\n  };\n\n  const handleDelete = async (entry)=>{\n    if(commentsReadOnly){\n      announce(READ_ONLY_NOTICE, 'error');\n      return;\n    }\n    if(!entry || !entry.id) return;\n    const ok = (typeof confirm === 'function') ? confirm('Delete this comment?') : true;\n    if(!ok) return;\n    const previous = state.comments.slice();\n    setComments(previous.filter((item)=> item.id !== entry.id));\n    renderList();\n    announce('Removing comment\u2026', 'info');\n    try{\n      await apiFetch(`/api/comments/${encodeURIComponent(entry.id)}`, { method:'DELETE' });\n      announce('Comment deleted.', 'info');\n    }catch(err){\n      setComments(previous);\n      renderList();\n      announce(err && err.message ? err.message : 'Failed to delete comment.', 'error');\n    }\n  };\n\n  form.addEventListener('submit', async (event)=>{\n    event.preventDefault();\n    if(commentsReadOnly){\n      announce(READ_ONLY_NOTICE, 'error');\n      return;\n    }\n    const textValue = (textarea.value || '').trim();\n    if(!textValue){\n      announce('Comment text is required.', 'error');\n      return;\n    }\n\n    const playerName = playerInput ? sanitizeOptional(playerInput.value) : '';\n    const characterName = characterInput ? sanitizeOptional(characterInput.value) : '';\n    const sessionId = sessionInput ? sanitizeOptional(sessionInput.value) : '';\n\n    const previous = state.comments.slice();\n    const optimistic = {\n      id: `pending-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n      playerName,\n      characterName,\n      sessionId,\n      comment: textValue,\n      createdAt: new Date().toISOString(),\n      pending: true\n    };\n\n    setComments([optimistic, ...previous]);\n    renderList();\n    announce('Posting comment\u2026', 'info');\n    if(submitButton){\n      submitButton.disabled = true;\n    }\n\n    try{\n      const response = await apiFetch('/api/comments', {\n        method:'POST',\n        body: JSON.stringify({\n          playerName,\n          characterName,\n          sessionId,\n          comment: textValue\n        })\n      });\n      const saved = normaliseComment(response && response.comment);\n      if(!saved){\n        throw new Error('Invalid response from datastore.');\n      }\n      setComments([saved, ...previous]);\n      renderList();\n      if(textarea){ textarea.value = ''; }\n      if(playerInput){ playerInput.value = ''; }\n      if(characterInput){ characterInput.value = ''; }\n      if(sessionInput){ sessionInput.value = ''; }\n      announce('Comment posted!', 'success');\n    }catch(err){\n      setComments(previous);\n      renderList();\n      if(err && err.message){\n        announce(err.message, 'error');\n      }else{\n        announce('Failed to post comment.', 'error');\n      }\n    }finally{\n      if(submitButton){\n        submitButton.disabled = false;\n      }\n    }\n  });\n\n  if(refreshBtn){\n    refreshBtn.addEventListener('click', (event)=>{\n      event.preventDefault();\n      fetchComments().catch((err)=>{\n        if(err && err.message){\n          announce(err.message, 'error');\n        }else{\n          announce('Failed to refresh comments.', 'error');\n        }\n      });\n    });\n  }\n\n  renderList();\n  fetchComments({ silent: true }).catch((err)=>{\n    if(err && err.message){\n      announce(err.message, 'error');\n    }else{\n      announce('Unable to load comments.', 'error');\n    }\n  });\n}\n\nasync function hydrateQuestBoard(root=document){\n  const container = root?.querySelector?.('#questList');\n  if(!container) return;\n\n  container.innerHTML = '<p class=\"muted\">Loading quests\u2026</p>';\n\n  try{\n    const response = await fetch('./site/data/quests.json', {cache:'no-store'});\n    if(!response.ok) throw new Error(`Request failed: ${response.status}`);\n\n    const quests = await response.json();\n    if(!Array.isArray(quests) || !quests.length){\n      container.innerHTML = '<p class=\"muted\">No quests are published yet. Check back soon.</p>';\n      return;\n    }\n\n    const frag = document.createDocumentFragment();\n    quests.forEach((quest)=>{\n      if(!quest || typeof quest !== 'object') return;\n      const card = document.createElement('article');\n      card.className = 'quest-card';\n\n      const title = document.createElement('h4');\n      title.textContent = quest.title || `Quest #${quest.id ?? '?'}`;\n      card.appendChild(title);\n\n      const meta = document.createElement('div');\n      meta.className = 'quest-meta';\n\n      if(typeof quest.id !== 'undefined'){\n        const idSpan = document.createElement('span');\n        idSpan.textContent = `ID ${quest.id}`;\n        meta.appendChild(idSpan);\n      }\n\n      if(quest.status){\n        const statusSpan = document.createElement('span');\n        statusSpan.textContent = `Status: ${quest.status}`;\n        meta.appendChild(statusSpan);\n      }\n\n      if(meta.childNodes.length){\n        card.appendChild(meta);\n      }\n\n      if(quest.notes){\n        const notes = document.createElement('p');\n        notes.className = 'quest-notes';\n        notes.textContent = quest.notes;\n        card.appendChild(notes);\n      }\n\n      frag.appendChild(card);\n    });\n\n    container.innerHTML = '';\n    container.appendChild(frag);\n  }catch(err){\n    console.error('Quest board failed', err);\n    container.innerHTML = '<p class=\"muted\">Unable to load quests right now. Try refreshing later.</p>';\n  }\n}\n\n  function getBuildCards(){\n    return SharedState.data.buildCards || {};\n  }\n\n  function getCurrentCharacterName(){\n    const fromState = (State.data?.core?.name||'').trim();\n    if(fromState) return fromState;\n    const input = document.querySelector('#core_name');\n    return (input?.value||'').trim();\n  }\n\n  function canJoinSession(session, name){\n    const thisUni = (DATA.universities.find(u=>u.key===State.data?.university?.key)?.name) || '';\n    if(!thisUni) return {ok:false, msg:'Pick a University in step 4 first.'};\n    const players = Array.isArray(session.players) ? session.players : [];\n    const cards = getBuildCards();\n    for(const entry of players){\n      const b = entry && entry.key ? cards[entry.key] : null;\n      if(b && b.university && b.university === thisUni){\n        return {ok:false, msg:`Another ${thisUni} student is already in this session. Choose a different session or college.`};\n      }\n    }\n    return {ok:true};\n  }\n\n\n  /* =======================\n     STEPS\n  ======================= */\nconst STEPS = [\n  {key:'intro',     title:'Welcome',          hint:'Overview & updates'},\n  {key:'builder',   title:'Character Builder',hint:'Core, college, flavour'},\n  {key:'join',      title:'Join a Session',   hint:'Reserve a seat'},\n  {key:'summary',   title:'Summary & Export', hint:'Share or download'}\n];\n\n\n\n  let currentStep = 0;\n\n  function focusCurrentTab(){\n    const nav = document.getElementById('stepNav');\n    if(!nav) return;\n    const active = nav.querySelector('button[aria-selected=\"true\"]');\n    if(active){\n      active.focus();\n    }\n  }\n\n  function activateStep(idx, focusTab = false){\n    if(Number.isNaN(idx) || idx < 0 || idx >= STEPS.length){\n      return;\n    }\n    currentStep = idx;\n    renderPanels();\n    renderNav();\n    if(focusTab){\n      focusCurrentTab();\n    }\n  }\n\n  function onStepRailKeydown(event){\n    const target = event.target;\n    if(!target || target.getAttribute('role') !== 'tab'){ return; }\n    const key = event.key;\n    const currentIndex = Number(target.dataset.index || '0');\n    let nextIndex = null;\n    if(key === 'ArrowRight' || key === 'ArrowDown'){\n      nextIndex = (currentIndex + 1) % STEPS.length;\n    } else if(key === 'ArrowLeft' || key === 'ArrowUp'){\n      nextIndex = (currentIndex - 1 + STEPS.length) % STEPS.length;\n    } else if(key === 'Home'){\n      nextIndex = 0;\n    } else if(key === 'End'){\n      nextIndex = STEPS.length - 1;\n    }\n    if(nextIndex !== null){\n      event.preventDefault();\n      activateStep(nextIndex, true);\n    }\n  }\n\n  function renderNav(){\n    const nav = document.getElementById('stepNav');\n    if(!nav) return;\n\n    const previousScroll = nav.scrollLeft;\n    nav.innerHTML = '';\n    nav.setAttribute('role', 'tablist');\n    nav.setAttribute('aria-label', 'Character builder steps');\n\n    const fragments = document.createDocumentFragment();\n    STEPS.forEach((s, idx)=>{\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.id = `step-tab-${s.key}`;\n      button.className = 'step-pill';\n      button.dataset.step = s.key;\n      button.dataset.index = String(idx);\n      button.setAttribute('role', 'tab');\n      button.setAttribute('aria-controls', `panel-${s.key}`);\n      const selected = idx === currentStep;\n      button.setAttribute('aria-selected', selected ? 'true' : 'false');\n      button.setAttribute('tabindex', selected ? '0' : '-1');\n      const hint = s.hint ? `<small>${escapeHTML(s.hint)}</small>` : '';\n      button.innerHTML = `\n        <span class=\"step-number\">${idx + 1}</span>\n        <span class=\"step-label\"><span>${escapeHTML(s.title)}</span>${hint}</span>\n      `;\n      button.addEventListener('click', ()=>{\n        activateStep(idx, true);\n      });\n      fragments.appendChild(button);\n    });\n    nav.appendChild(fragments);\n\n    if(!nav.dataset.keysBound){\n      nav.addEventListener('keydown', onStepRailKeydown);\n      nav.dataset.keysBound = 'true';\n    }\n\n    if(nav.scrollWidth > nav.clientWidth + 8){\n      const active = nav.querySelector('button[aria-selected=\"true\"]');\n      if(active){\n        try{\n          active.scrollIntoView({block:'nearest', inline:'center'});\n        }catch{\n          /* ignore */\n        }\n      }\n    }else{\n      nav.scrollLeft = previousScroll;\n    }\n\n    const badge=document.getElementById('cfgBadge');\n    const errs=validateConfig();\n    badge.textContent = errs.length? `\u26A0\uFE0F ${errs.length} config issue${errs.length>1?'s':''}` : '\u2705 config OK';\n  }\n\n  function renderPanels(){\n    const el = document.getElementById('panels');\n    if(!el) return;\n    el.innerHTML='';\n    const step = STEPS[currentStep].key;\n    let panelEl = null;\n    if(step==='builder') panelEl = panelBuilder();\n    if(step==='summary') panelEl = panelSummary();\n    if(step==='intro') panelEl = panelIntro();\n    if(step==='join') panelEl = panelJoin();\n    if(panelEl){\n      panelEl.id = `panel-${step}`;\n      panelEl.setAttribute('role','tabpanel');\n      panelEl.setAttribute('aria-labelledby', `step-tab-${step}`);\n      panelEl.setAttribute('tabindex','0');\n      el.appendChild(panelEl);\n    }\n\n  }\n\n  /* =======================\n     PANELS\n  ======================= */\nfunction panelIntro(){\n  const p = document.createElement('div');\n  p.className = 'panel';\n  \n  // Build the dashboard content\n  const dashboardHtml = renderDashboard();\n  \n  p.innerHTML = dashboardHtml + `\n<details class=\"scroll-letter\" open>\n  <summary>\n    <span class=\"seal\">\u2736</span>\n    Official Correspondence: The Oracle Qualification Trials\n    <span class=\"chev\">\u25B6</span>\n  </summary>\n\n  <div class=\"scroll-content\">\n    <div style=\"text-align:center; font-style:italic; color:var(--muted); margin-bottom:1rem;\">\n      From the Office of the Dean of Arcane Affairs<br>\n      Strixhaven University \u2014 The Premier Institution of Magical Learning in the World<br>\n      <small>Founded by the Five Dragons \u2014 Velomachus, Galazeth, Tanazir, Shadrix, and Beledros</small>\n    </div>\n\n    <hr style=\"border:none;border-top:1px dotted var(--border);margin:1rem 0;\">\n\n    <p><strong>Winter Term \u2022 Year 739 of Archavios</strong></p>\n    <p><em>An Invitation to the Learned and the Brave,</em></p>\n\n    <p>In preparation for this century\u2019s selection of the Oracle Apprentice, the University will conduct a series of sanctioned field examinations. Each Trial is designed to assess essential qualities of leadership, wisdom, and magical aptitude expected of one who may one day inherit the Oracle\u2019s mantle. <br><br>\n\n    Participants will represent their chosen college and be evaluated by a panel of distinguished faculty and arcane observers. Though each Trial varies in format, all share a single purpose \u2014 to illuminate the heart, mind, and will of every contender.<br>\n\n    <p>Strixhaven is honoured to welcome distinguished students and faculty from magical academies across the planes for this year\u2019s Oracle Trials. Each institution brings its own traditions, theories, and flavour of chaos to the proceedings \u2014 ensuring that no two duels, debates, or dissertations are ever the same.</p>\n\n    <div class=\"table-scroll letter-table\">\n      <table class=\"table\">\n        <thead><tr><th>College</th><th>Field of Study</th><th>Founder Dragon</th></tr></thead>\n        <tbody>\n          <tr><td><strong>Lorehold</strong></td><td>History & Archaeomancy</td><td>Velomachus Lorehold</td></tr>\n          <tr><td><strong>Prismari</strong></td><td>Elemental Arts & Expression</td><td>Galazeth Prismari</td></tr>\n          <tr><td><strong>Quandrix</strong></td><td>Numeromancy & Natural Mathematics</td><td>Tanazir Quandrix</td></tr>\n          <tr><td><strong>Silverquill</strong></td><td>Eloquence, Rhetoric, & Word Magic</td><td>Shadrix Silverquill</td></tr>\n          <tr><td><strong>Witherbloom</strong></td><td>Essence Studies: Life & Death</td><td>Beledros Witherbloom</td></tr>\n        </tbody>\n      </table>\n    </div>\n\n    <p><strong>Student Expectations</strong><br>\n      Arrive prepared for adventure, study, and a modest amount of chaos.<br>\n      Dice, imagination, and one\u2019s best festive attire recommended.<br>\n      Non-finalists may appear as professors, spirits, or helpful onlookers via \u201CSupporter Cards.\u201D<br>\n      Cooperation, roleplay, and good humour will be rewarded; detentions will be minimal.\n    </p>\n    \n    <section class=\"news-board\" id=\"newsBoard\">\n  <h3>Games & Trials</h3>\n  <p class=\"muted\">All scholars will compete in select Trials, contributing their unique philosophies to the greater pursuit of magical mastery. Some seek prestige, others enlightenment \u2014 a few, simply the catering.</p>\n<p>Dates (Happening in the Mortal World)</p>\n<p><strong>3 Preliminary College Quests: December 21\u201329<br>\nGrand Oracle Trial: January 1</strong></p>\n<p>(Trials hosted in the mortal realm by Professors Kaela and Tory. Potluck encouraged.)</p>\n  \n  <details class=\"news-item\" closed>\n    <summary>\n      <span class=\"dot\" aria-hidden=\"true\"></span>\n      <span class=\"news-title-text\">Trial I: The Bog Expedition (Date TBD)</span>\n      <span class=\"chev\" aria-hidden=\"true\">\u25B6</span>\n    </summary>\n    <div class=\"news-body\">\n      <ul>\n        <li><strong>Theme:</strong> Resilience & Compassion</li>\n        <li><strong>Focus:</strong> Problem-solving, teamwork, and moral decisions under pressure.</li>\n        <li><strong>Setting:</strong> Witherbloom\u2019s Detention Bog.</li>\n        <li><strong>Premise:</strong> Participants are sent to assist Witherbloom faculty in recovering lost alchemical crates.</li>\n      </ul>\n    </div>\n  </details>\n  \n  <details class=\"news-item\" closed>\n    <summary>\n      <span class=\"dot\" aria-hidden=\"true\"></span>\n      <span class=\"news-title-text\">Trial II: The Masquerade of Mirrors (Date TBD)</span>\n      <span class=\"chev\" aria-hidden=\"true\">\u25B6</span>\n    </summary>\n    <div class=\"news-body\">\n      <ul>\n        <li><strong>Theme:</strong> Wisdom & Integrity</li>\n        <li><strong>Focus:</strong> Deception, charm, and truth-seeking.</li>\n        <li><strong>Setting:</strong> The Winter Masquerade Ball, hosted by Silverquill and Prismari.</li>\n        <li><strong>Premise:</strong> Contestants attend an extravagant gala where faculty and students vie for influence.</li>\n      </ul>\n    </div>\n  </details>\n  \n  <details class=\"news-item\" closed>\n    <summary>\n      <span class=\"dot\" aria-hidden=\"true\"></span>\n      <span class=\"news-title-text\">Trial III: The Trial of the Ruins (Date TBD)</span>\n      <span class=\"chev\" aria-hidden=\"true\">\u25B6</span>\n    </summary>\n    <div class=\"news-body\">\n      <ul>\n        <li><strong>Theme:</strong> Courage & Judgement.</li>\n        <li><strong>Focus:</strong> Exploration, strategy, and moral courage.</li>\n        <li><strong>Setting:</strong> The Fortress Badlands.</li>\n        <li><strong>Premise:</strong> This test appears to be a straightforward recovery mission. Retrieve relics from ancient battlefields.</li>\n      </ul>\n    </div>\n  </details>\n  \n  <details class=\"news-item\" closed>\n    <summary>\n      <span class=\"dot\" aria-hidden=\"true\"></span>\n      <span class=\"news-title-text\">Finale: The Oracle\u2019s Convergence (January 1, 2026)</span>\n      <span class=\"chev\" aria-hidden=\"true\">\u25B6</span>\n    </summary>\n    <div class=\"news-body\">\n      <ul>\n        <li><strong>Focus:</strong> Everyone together \u2014 chaos, redemption, and a vote for destiny.</li>\n        <li><strong>Format:</strong> Hybrid roleplay + short \u201Ctournament\u201D style mini-games.</li>\n        <li><strong>Structure:</strong> Reunion Scene: All characters (kids & adults) witness the Oracle\u2019s unstable spirit forming.</li>\n        <li><strong>Challenges:</strong> \n          <li>Puzzle of Insight (Wisdom)</li>\n          <li>Duel of Flames (Power)\n          <li>Debate of Hearts (Charisma)\n          <li><strong>Audience votes or donates coins/tokens to alter results.</strong></li>\n      </ul>\n      <p><strong>Final Choice:</strong> Whoever wins or earns the group\u2019s vote becomes the Oracle Apprentice.</p>\n    </div>\n  </details>\n</section>\n\n    <p>Should you accept, please confirm attendance and college preference. Positions are limited, and the Founders favour the punctual.</p>\n\n    <p style=\"margin-top:1.1rem;\">\n      <strong>With warm regards and arcane esteem,</strong><br><br>\n      <em>Professor Kaela of House Glissandiants</em><br>\n      <em>Contact kaelacaron@gmail.com</em><br>\n      <em>Department of Druidic Studies</em><br><br>\n      <em>Professor Tory of House Wittatude</em><br>\n      <em>School of Bardic Applications</em><br><br>\n      <strong>Strixhaven University of Magic and Mystery</strong>\n    </p>\n\n    <p style=\"text-align:center; font-style:italic; margin-top:1rem;\">\u201CTo discover, preserve, and share the boundless wonders of magic.\u201D</p>\n  </div>\n</details>\n\n<section class=\"quest-board\" id=\"questBoard\">\n  <h3>Quest Board</h3>\n  <p class=\"muted\">Live adventures pulled from the Oracle Trials database snapshot.</p>\n  <div id=\"questList\" class=\"quest-list\" role=\"list\">\n    <p class=\"muted\">Loading quests\u2026</p>\n  </div>\n</section>\n\n<section class=\"news-board\" id=\"newsBoard\">\n  <h3>Announcements &amp; Updates</h3>\n  <p class=\"muted\">Drop in quick notes for the group. Duplicate the sample dropdown below to add more updates.</p>\n  <details class=\"news-item\" open>\n    <summary>\n      <span class=\"dot\" aria-hidden=\"true\"></span>\n      <span class=\"news-title-text\">Sample Update \u2014 Replace Me</span>\n      <span class=\"chev\" aria-hidden=\"true\">\u25B6</span>\n    </summary>\n    <div class=\"news-body\">\n      <p>Share schedule changes, supply lists, or links here. Copy this entire <code>&lt;details class=\"news-item\"&gt;</code> block to post another note.</p>\n      <ul>\n        <li><strong>When:</strong> Example date and time</li>\n        <li><strong>Where:</strong> Library of the Biblioplex</li>\n        <li><strong>Bring:</strong> Dice, pencils, favourite snack</li>\n      </ul>\n    </div>\n  </details>\n</section>\n\n<section class=\"comment-board\" id=\"commentBoard\">\n  <h3>Comments &amp; Notes</h3>\n  <p class=\"muted\">Jot reminders or questions for the group. Comments sync through the Oracle Archives so everyone stays in the loop.</p>\n  <form id=\"commentForm\" class=\"comment-form\">\n    <div class=\"comment-form-grid\">\n      <div class=\"form-field\">\n        <label for=\"commentPlayer\">Player name (optional)</label>\n        <input id=\"commentPlayer\" name=\"commentPlayer\" autocomplete=\"off\" placeholder=\"e.g., Tamsin Rowe\" />\n      </div>\n      <div class=\"form-field\">\n        <label for=\"commentCharacter\">Character name (optional)</label>\n        <input id=\"commentCharacter\" name=\"commentCharacter\" autocomplete=\"off\" placeholder=\"e.g., Althea the Clever\" />\n      </div>\n      <div class=\"form-field\">\n        <label for=\"commentSession\">Session ID (optional)</label>\n        <input id=\"commentSession\" name=\"commentSession\" autocomplete=\"off\" placeholder=\"e.g., s3 or finale\" />\n      </div>\n    </div>\n    <label for=\"commentText\">Add a comment</label>\n    <textarea id=\"commentText\" name=\"commentText\" placeholder=\"Thanks for the invite! I'll bring cocoa.\" aria-label=\"Comment text\"></textarea>\n    <div class=\"comment-actions\">\n      <button type=\"button\" id=\"refreshComments\" class=\"secondary\">Refresh</button>\n      <button type=\"submit\" class=\"primary\">Post Comment</button>\n    </div>\n    <p id=\"commentStatus\" class=\"comment-status\" aria-live=\"polite\" role=\"status\" hidden></p>\n  </form>\n  <div id=\"commentList\" class=\"comment-list\" aria-live=\"polite\"></div>\n</section>\n\n  `;\n  setupCommentBoard(p);\n  hydrateQuestBoard(p);\n  bindDashboardNav(p);\n  return p;\n}\n\n\n\n\n\n  function panelBuilder(){\n    const p = document.createElement('div');\n    p.className = 'panel';\n    p.innerHTML = `\n      <h2>Character Builder</h2>\n      <div class=\"card\">\n        <p>Complete each accordion below. Save a section once you\u2019ve filled the fields \u2014 you can revisit and update any time.</p>\n      </div>\n      <details class=\"builder-section\" open>\n        <summary>\n          <span>Core 5e Setup</span>\n          <small class=\"muted\">Stats, species, class</small>\n        </summary>\n        <div class=\"section-body\">\n          <div class=\"callout\" aria-label=\"Character creation instructions\">\n            <strong>Quick build checklist:</strong>\n            <ul>\n              <li>Enter your <strong>player name</strong> and <strong>character name</strong>.</li>\n              <li>Pick a race, class, background, level, and ability score method.</li>\n              <li>Select starting equipment \u2014 class kit or 50 gp.</li>\n              <li>Need a refresher? Try the <a href=\"https://dnd.wizards.com/resources/character-sheets\" target=\"_blank\" rel=\"noreferrer\">official D&D 5e character sheets</a>.</li>\n            </ul>\n          </div>\n          <div class=\"grid cols-2\">\n            <div><label>Player Name</label><input id=\"core_player\" placeholder=\"e.g., Kaela\" /></div>\n            <div><label>Character Name</label><input id=\"core_name\" placeholder=\"e.g., Aria Winterborn\" /></div>\n            <div><label>Level</label><select id=\"core_level\"></select></div>\n            <div><label>Race</label><input id=\"core_race\" placeholder=\"Any 5e race\" /></div>\n            <div><label>Class</label><input id=\"core_class\" placeholder=\"Any 5e class\" /></div>\n            <div><label>Background</label><input id=\"core_background\" placeholder=\"PHB/Custom\" /></div>\n            <div>\n              <label>Ability Scores</label>\n              <div class=\"row\">\n                <select id=\"ability_method\">\n                  <option value=\"standard\">Standard Array (15,14,13,12,10,8)</option>\n                  <option value=\"manual\">Manual Entry</option>\n                </select>\n                <select id=\"equipment\">\n                  <option value=\"class\">Class Starting Equipment</option>\n                  <option value=\"50gp\">50 gp</option>\n                </select>\n              </div>\n            </div>\n          </div>\n          <div id=\"ability_box\" class=\"two\" style=\"margin-top:10px\"></div>\n          <div class=\"section-actions\">\n            <button class=\"primary\" id=\"save_core\">Save Core Setup</button>\n            <span class=\"muted\" data-save-note=\"core\"></span>\n          </div>\n        </div>\n      </details>\n      <div class=\"builder-card\">\n        <h3>Strixhaven Details</h3>\n        <details class=\"builder-section\" open>\n          <summary>\n            <span>University & Feat</span>\n            <small class=\"muted\">Select your college</small>\n          </summary>\n          <div class=\"section-body\">\n            <label style=\"display:block;margin-bottom:8px;\">Choose your College</label>\n            <div id=\"college_cards\" class=\"college-grid\" role=\"radiogroup\" aria-label=\"Choose a college\"></div>\n            <input type=\"hidden\" id=\"uni\" value=\"\" />\n            <div style=\"margin-top:14px;\">\n              <label>Strixhaven Initiate \u2014 Spellcasting Ability</label>\n              <select id=\"spell_ability\"><option>INT</option><option>WIS</option><option>CHA</option></select>\n            </div>\n            <div id=\"uni_info\" class=\"card\" style=\"margin-top:10px\"></div>\n            <div class=\"section-actions\">\n              <button class=\"primary\" id=\"save_university\">Save University</button>\n              <span class=\"muted\" data-save-note=\"university\"></span>\n            </div>\n          </div>\n        </details>\n        <details class=\"builder-section\">\n          <summary>\n            <span>Job & Extracurriculars</span>\n            <small class=\"muted\">Schedule & flavour</small>\n          </summary>\n          <div class=\"section-body\">\n            <div class=\"grid cols-2\">\n              <div>\n                <label>Job (optional, 5 gp/week)</label>\n                <select id=\"job\"><option value=\"\">\u2014 None \u2014</option>${DATA.jobs.map(j=>`<option value=\"${j.key}\">${j.name}</option>`).join('')}</select>\n              </div>\n              <div>\n                <label>Extracurriculars (pick up to 2; 1 if you also take a job)</label>\n                <div id=\"clublist\" class=\"grid cols-2\" style=\"max-height:240px;overflow:auto\"></div>\n              </div>\n            </div>\n            <div id=\"bonus_readout\" class=\"callout\" style=\"margin-top:10px\"></div>\n            <div class=\"section-actions\">\n              <button class=\"primary\" id=\"save_extras\">Save Job & Clubs</button>\n              <span class=\"muted\" data-save-note=\"extras\"></span>\n            </div>\n          </div>\n        </details>\n        <details class=\"builder-section\">\n          <summary>\n            <span>Personality & Prompt</span>\n            <small class=\"muted\">Backstory beats</small>\n        </summary>\n        <div class=\"section-body\">\n          <div class=\"grid cols-2\">\n            <div><label>Traits (1\u20132)</label><textarea id=\"traits\" rows=\"3\" placeholder=\"e.g., Curious, dry humour\"></textarea></div>\n            <div><label>Ideal</label><textarea id=\"ideal\" rows=\"3\" placeholder=\"e.g., Knowledge must be shared.\"></textarea></div>\n            <div><label>Bond / Friend / Rival</label><textarea id=\"bond\" rows=\"3\" placeholder=\"Name someone you\u2019re tied to (or opposed to)\"></textarea></div>\n            <div><label>Goal</label><textarea id=\"goal\" rows=\"3\" placeholder=\"What do you want from the Oracle Trials?\"></textarea></div>\n          </div>\n          <div class=\"card\" style=\"margin-top:10px\">\n            <div class=\"kicker\">Quick-Start Character Prompt</div>\n            <div id=\"prompt_box\" class=\"flex\" style=\"margin-top:6px\"></div>\n          </div>\n          <div class=\"section-actions\">\n            <button class=\"primary\" id=\"save_personality\">Save Personality</button>\n            <span class=\"muted\" data-save-note=\"personality\"></span>\n          </div>\n        </div>\n      </details>\n      </div>\n      <div class=\"controls\">\n        <div class=\"left\"><button id=\"back_builder\">\u2190 Back</button></div>\n        <div class=\"right\"><button class=\"primary\" id=\"next_builder\">Next \u2192</button></div>\n      </div>\n    `;\n\n    function markSaved(section, msg){\n      const target = p.querySelector(`[data-save-note=\"${section}\"]`);\n      if(target){\n        target.textContent = msg;\n      }\n    }\n\n    // Core setup\n    const levelSel = p.querySelector('#core_level');\n    DATA.levels.forEach(l=>{ const o=document.createElement('option'); o.value=l; o.textContent=l; levelSel.appendChild(o); });\n\n    const box = p.querySelector('#ability_box');\n    function drawAbilityInputs(){\n      box.innerHTML='';\n      const m = p.querySelector('#ability_method').value;\n      const abilities = ['STR','DEX','CON','INT','WIS','CHA'];\n      if(m==='standard'){\n        const arr = DATA.abilityArrays.standard.slice();\n        abilities.forEach((ab)=>{\n          const d=document.createElement('div'); d.className='card';\n          d.innerHTML=`<label>${ab}</label><select data-ab=\"${ab}\">${arr.map(v=>`<option value=\"${v}\">${v}</option>`).join('')}</select>`;\n          box.appendChild(d);\n        });\n      } else {\n        abilities.forEach(ab=>{\n          const d=document.createElement('div'); d.className='card';\n          d.innerHTML=`<label>${ab}</label><input type=\"number\" min=\"3\" max=\"18\" value=\"10\" data-ab=\"${ab}\" />`;\n          box.appendChild(d);\n        });\n      }\n    }\n    p.querySelector('#ability_method').addEventListener('change', drawAbilityInputs);\n    drawAbilityInputs();\n\n    const s = State.data.core;\n    p.querySelector('#core_player').value = s.playerName || '';\n    p.querySelector('#core_name').value = s.name;\n    p.querySelector('#core_race').value = s.race;\n    p.querySelector('#core_class').value = s.class;\n    p.querySelector('#core_background').value = s.background;\n    p.querySelector('#core_level').value = s.level;\n    p.querySelector('#ability_method').value = s.abilityMethod;\n    p.querySelector('#equipment').value = s.equipment;\n    drawAbilityInputs();\n    const abilities = ['STR','DEX','CON','INT','WIS','CHA'];\n    abilities.forEach(ab=>{\n      const el = box.querySelector(`[data-ab=\"${ab}\"]`);\n      if(el){ el.value = s.abilities?.[ab] ?? el.value; }\n    });\n\n    p.querySelector('#save_core').onclick = ()=>{\n      const abObj = {};\n      abilities.forEach(ab=>{\n        const el = box.querySelector(`[data-ab=\"${ab}\"]`);\n        abObj[ab] = parseInt(el.value,10);\n      });\n      State.data.core = {\n        playerName: p.querySelector('#core_player').value.trim(),\n        name: p.querySelector('#core_name').value.trim(),\n        race: p.querySelector('#core_race').value.trim(),\n        class: p.querySelector('#core_class').value.trim(),\n        background: p.querySelector('#core_background').value.trim(),\n        level: parseInt(p.querySelector('#core_level').value,10),\n        abilityMethod: p.querySelector('#ability_method').value,\n        abilities: abObj,\n        equipment: p.querySelector('#equipment').value\n      };\n      markSaved('core','Core details saved.');\n      // Persist the full build (does not block UI; errors logged to console)\n      State.save().catch(err => console.error('Failed to persist core setup', err));\n    };\n\n    // University - render college cards\n    const sel=p.querySelector('#uni');\n    const collegeGrid = p.querySelector('#college_cards');\n    \n    function renderCollegeCards(){\n      collegeGrid.innerHTML = '';\n      DATA.universities.forEach(u=>{\n        const card = document.createElement('div');\n        card.className = 'college-card';\n        card.setAttribute('role', 'radio');\n        card.setAttribute('tabindex', '0');\n        card.setAttribute('aria-checked', sel.value === u.key ? 'true' : 'false');\n        card.setAttribute('aria-selected', sel.value === u.key ? 'true' : 'false');\n        card.setAttribute('data-key', u.key);\n        card.innerHTML = `\n          <h4 class=\"college-card__name\">${escapeHTML(u.name)}</h4>\n          <p class=\"college-card__flavour\">${escapeHTML(u.flavour || u.theme)}</p>\n          <span class=\"college-card__colours\">${escapeHTML(u.colours)}</span>\n        `;\n        card.addEventListener('click', ()=> selectCollege(u.key));\n        card.addEventListener('keydown', (e)=>{\n          if(e.key === 'Enter' || e.key === ' '){\n            e.preventDefault();\n            selectCollege(u.key);\n          }\n        });\n        collegeGrid.appendChild(card);\n      });\n    }\n    \n    function selectCollege(key){\n      sel.value = key;\n      // Update all cards' aria states\n      collegeGrid.querySelectorAll('.college-card').forEach(card=>{\n        const isSelected = card.getAttribute('data-key') === key;\n        card.setAttribute('aria-checked', isSelected ? 'true' : 'false');\n        card.setAttribute('aria-selected', isSelected ? 'true' : 'false');\n      });\n      drawInfo();\n    }\n    \n    function drawInfo(){\n      const key = sel.value; const out=p.querySelector('#uni_info');\n      if(!key){ out.innerHTML='<span class=\"muted\">Select a college to view theme & bonus spells.</span>'; return; }\n      const u = DATA.universities.find(x=>x.key===key);\n      const spellRows = Object.entries(u.spells).map(([lvl,list])=>`<tr><td>${lvl}</td><td>${list.join(', ')}</td></tr>`).join('');\n      out.innerHTML = `\n        <div class=\"two\">\n          <div>\n            <div class=\"kicker\">Theme</div><div>${u.theme}</div>\n            <div class=\"kicker\" style=\"margin-top:6px\">Focus</div><div>${u.focus}</div>\n            <div class=\"kicker\" style=\"margin-top:6px\">Colours</div><div>${u.colours}</div>\n            <div class=\"kicker\" style=\"margin-top:6px\">Playstyle</div><div>${u.playstyle}</div>\n          </div>\n          <div>\n            <div class=\"kicker\">Bonus Spells</div>\n            <table class=\"table\"><thead><tr><th>Level</th><th>Spells</th></tr></thead><tbody>${spellRows}</tbody></table>\n          </div>\n        </div>\n        <div class=\"callout\" style=\"margin-top:8px\"><strong>Feat:</strong> ${DATA.feats.strixhavenInitiate.name} \u2014 ${DATA.feats.strixhavenInitiate.text}</div>\n      `;\n    }\n    \n    // Initialize with saved value\n    sel.value = State.data.university.key || '';\n    p.querySelector('#spell_ability').value = State.data.university.spellAbility || 'INT';\n    renderCollegeCards();\n    drawInfo();\n    \n    p.querySelector('#save_university').onclick = ()=>{\n      State.data.university={ key: sel.value, spellAbility: p.querySelector('#spell_ability').value };\n      if(!State.data.university.key){ alert('Pick a college to continue.'); return; }\n      if(!State.data.feats.find(f=>f.name==='Strixhaven Initiate')){\n        State.data.feats.push({name:'Strixhaven Initiate', ability: State.data.university.spellAbility });\n      } else {\n        State.data.feats = State.data.feats.map(f=> f.name==='Strixhaven Initiate'? {...f, ability: State.data.university.spellAbility }: f);\n      }\n      markSaved('university','University saved.');\n      // Persist the full build (does not block UI; errors logged to console)\n      State.save().catch(err => console.error('Failed to persist build after university update', err));\n    };\n\n    // Extras\n    const clubWrap = p.querySelector('#clublist');\n    function drawClubs(){\n      clubWrap.innerHTML='';\n      DATA.extracurriculars.forEach(c=>{\n        const id=`club_${c.key}`;\n        const d=document.createElement('label'); d.className='card'; d.style.cursor='pointer';\n        d.innerHTML=`<div class=\"flex\"><input type=\"checkbox\" id=\"${id}\" data-key=\"${c.key}\" /> <div><strong>${c.name}</strong><div class=\"muted\">Student Die (d4): ${c.skills.join(' / ')}</div></div></div>`;\n        clubWrap.appendChild(d);\n      });\n    }\n    drawClubs();\n\n    const jobSel = p.querySelector('#job');\n    jobSel.value = State.data.extras.job || '';\n    (State.data.extras.clubs||[]).forEach(k=>{ const el = clubWrap.querySelector(`[data-key=\"${k}\"]`); if(el) el.checked=true; });\n\n    function readExtras(){\n      const jobKey = jobSel.value || null;\n      const pickedClubs = [...clubWrap.querySelectorAll('input[type=\"checkbox\"]:checked')].map(x=>x.dataset.key);\n      const maxClubs = jobKey?1:2;\n      if(pickedClubs.length>maxClubs){\n        const last = pickedClubs.pop();\n        clubWrap.querySelector(`[data-key=\"${last}\"]`).checked=false;\n      }\n      const job = DATA.jobs.find(j=>j.key===jobKey);\n      const clubs = DATA.extracurriculars.filter(c=>pickedClubs.includes(c.key));\n      const parts=[];\n      if(job) parts.push(`<span class=\"tag\">Job: ${job.name} \u2014 d4: ${job.skills.join(' / ')}</span>`);\n      clubs.forEach(c=>parts.push(`<span class=\"tag\">Club: ${c.name} \u2014 d4: ${c.skills.join(' / ')}</span>`));\n      p.querySelector('#bonus_readout').innerHTML = parts.length? parts.join(' '): '<span class=\"muted\">Pick a job and/or clubs to see Student Dice bonuses.</span>';\n      return { job: jobKey, clubs: pickedClubs };\n    }\n\n    jobSel.addEventListener('change', readExtras);\n    clubWrap.addEventListener('change', readExtras);\n    readExtras();\n\n    p.querySelector('#save_extras').onclick = ()=>{\n      const {job, clubs} = readExtras();\n      State.data.extras.job = job;\n      State.data.extras.clubs = clubs;\n      markSaved('extras','Schedule saved.');\n      // Persist the full build (does not block UI; errors logged to console)\n      State.save().catch(err => console.error('Failed to persist build after extras update', err));\n    };\n\n    // Personality\n    const quickPrompts = [\n      {u:'Lorehold', text:'A cheerful necro-historian who argues with ghosts about footnotes.'},\n      {u:'Prismari', text:'A kinetic dancer who keeps leaving frost footprints after cantrips.'},\n      {u:'Quandrix', text:'A fractal botanist who names houseplants after famous equations.'},\n      {u:'Silverquill', text:'A sunny orator who spotlights corruption with literal light.'},\n      {u:'Witherbloom', text:'A swamp witch medic who collects bones \u201Cfor research.\u201D'}\n    ];\n    const boxPrompts=p.querySelector('#prompt_box');\n    quickPrompts.forEach(q=>{\n      const b=document.createElement('button'); b.className='pill'; b.type='button';\n      b.innerHTML = `<span>${q.u}</span><span>\u2022</span><span>${q.text}</span>`;\n      b.onclick=()=>{ State.data.personality.prompt = q.text; Array.from(boxPrompts.children).forEach(x=>x.classList.remove('success')); b.classList.add('success'); };\n      boxPrompts.appendChild(b);\n      if(State.data.personality.prompt===q.text) b.classList.add('success');\n    });\n\n    p.querySelector('#traits').value = State.data.personality.traits||'';\n    p.querySelector('#ideal').value = State.data.personality.ideal||'';\n    p.querySelector('#bond').value = State.data.personality.bond||'';\n    p.querySelector('#goal').value = State.data.personality.goal||'';\n\n    p.querySelector('#save_personality').onclick=()=>{\n      State.data.personality={\n        traits: p.querySelector('#traits').value.trim(),\n        ideal: p.querySelector('#ideal').value.trim(),\n        bond: p.querySelector('#bond').value.trim(),\n        goal: p.querySelector('#goal').value.trim(),\n        prompt: State.data.personality.prompt||''\n      };\n      markSaved('personality','Personality saved.');\n      // Persist the full build (does not block UI; errors logged to console)\n      State.save().catch(err => console.error('Failed to persist build after personality update', err));\n    };\n\n    p.querySelector('#back_builder').onclick = ()=>{ activateStep(STEPS.findIndex(s=>s.key==='intro')); };\n    p.querySelector('#next_builder').onclick = ()=>{ activateStep(STEPS.findIndex(s=>s.key==='join')); };\n\n    return p;\n  }\n    function panelJoin(){\n  const p=document.createElement('div'); p.className='panel';\n  p.innerHTML = `\n    <h2>Join a Session</h2>\n    <div class=\"card\">\n      <p>Pick a table for your finished character. You\u2019ll need a <strong>Name</strong>, <strong>Class</strong>, <strong>Level</strong>, and a chosen <strong>University</strong>.</p>\n    </div>\n    ${IS_GUEST_SESSION ? '<div class=\"card\" role=\"note\"><p class=\"muted\">Guest mode is read-only. Use your personal access code to reserve a seat.</p></div>' : ''}\n    <div id=\"join_list\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <div class=\"left\"><button id=\"back_join\">\u2190 Back</button></div>\n      <div class=\"right\"><button class=\"primary\" id=\"to_summary\">Next \u2192</button></div>\n    </div>\n  `;\n\n  const wrap = p.querySelector('#join_list');\n  renderSessionCards(wrap, {readOnly: IS_GUEST_SESSION}); // hides the join button when read-only\n\n  // click handlers for join + ics\n  wrap.addEventListener('click', (ev)=>{\n    const addBtn = ev.target.closest('button.primary[data-id]');\n    if(addBtn){\n      if(IS_GUEST_SESSION){\n        alert(READ_ONLY_NOTICE);\n        return;\n      }\n      const id = addBtn.getAttribute('data-id');\n      const s = (State.sessions||[]).find(x=>x.id===id);\n      const name = (State.data.core.name||'').trim();\n      if(!name){ alert('Give your character a name (Core 5e).'); return; }\n      if (ELIGIBILITY.hardNo.includes(name)) { alert(`${name} is marked as not playing.`); return; }\n      if ((ELIGIBILITY.blockedDates[name]||[]).includes(s.date)) { alert(`${name} isn't available for ${s.date}.`); return; }\n      const players = Array.isArray(s.players) ? s.players : [];\n      if(players.some(player => sanitizeName(player && player.character) === sanitizeName(name))){\n        alert('This character is already in that session.');\n        return;\n      }\n      if(players.some(player => rosterKey(player && player.key) === CURRENT_PLAYER_KEY)){\n        alert('Your access code already has a seat in this session.');\n        return;\n      }\n      if(players.length>=s.capacity){ alert('That session is full.'); return; }\n      // enforce unique university\n      const uniName = (DATA.universities.find(u=>u.key===State.data.university.key)?.name)||'';\n      const builds = getBuildCards();\n      if(uniName){\n        for(const player of players){\n          const b = player && player.key ? builds[player.key] : null;\n          if(b && b.university === uniName){\n            alert(`Another ${uniName} student is already in this session. Choose a different session or college.`);\n            return;\n          }\n        }\n      }\n      const klass = State.data.core.class || '';\n      const rosterEntry = PlayerIdentity.getRosterEntry();\n      Backend.joinSession(id, {\n        name,\n        characterName: name,\n        playerKey: CURRENT_PLAYER_KEY,\n        playerName: rosterEntry?.name,\n        build:{ class: klass, university: uniName }\n      })\n        .then(()=>{\n          renderSessionCards(wrap, {readOnly: IS_GUEST_SESSION});\n          alert(`Added ${name} to ${s.title}.`);\n        })\n        .catch((err)=>{\n          alert(`Unable to join ${s.title}: ${err && err.message ? err.message : 'Request failed.'}`);\n        });\n      return;\n    }\n    // Handle leave button clicks\n    const leaveBtn = ev.target.closest('button[data-leave-id]');\n    if(leaveBtn){\n      if(IS_GUEST_SESSION){\n        alert(READ_ONLY_NOTICE);\n        return;\n      }\n      const id = leaveBtn.getAttribute('data-leave-id');\n      const s = (State.sessions||[]).find(x=>x.id===id);\n      if(!s){\n        alert('Session not found.');\n        return;\n      }\n      if(!confirm(`Leave ${s.title}? You can rejoin later if there's space.`)){\n        return;\n      }\n      Backend.leaveSession(id, {\n        playerKey: CURRENT_PLAYER_KEY\n      })\n        .then(()=>{\n          renderSessionCards(wrap, {readOnly: IS_GUEST_SESSION});\n          alert(`You have left ${s.title}.`);\n        })\n        .catch((err)=>{\n          alert(`Unable to leave ${s.title}: ${err && err.message ? err.message : 'Request failed.'}`);\n        });\n      return;\n    }\n    const icsBtn = ev.target.closest('button[data-ics]');\n    if(icsBtn){\n      const id = icsBtn.getAttribute('data-ics');\n      const s = State.sessions.find(x=>x.id===id);\n      downloadICS(s);\n    }\n  });\n\n  p.querySelector('#back_join').onclick = ()=>{ activateStep(STEPS.findIndex(s=>s.key==='builder')); };\n  p.querySelector('#to_summary').onclick= ()=>{ activateStep(STEPS.findIndex(s=>s.key==='summary')); };\n  return p;\n}\n\n\n  function panelSummary(){\n    const p=document.createElement('div'); p.className='panel';\n    const s=State.data;\n    const uni = DATA.universities.find(u=>u.key===s.university.key);\n    const abilityList = Object.entries(s.core.abilities||{}).map(([k,v])=>`<span class=\"tag\">${k}: ${v}</span>`).join(' ');\n    const clubs = (s.extras.clubs||[]).map(k=> DATA.extracurriculars.find(c=>c.key===k)?.name).filter(Boolean);\n    const jobName = DATA.jobs.find(j=>j.key===s.extras.job)?.name || '\u2014';\n\n    p.innerHTML = `\n      <h2>Summary</h2>\n      <div class=\"grid cols-2\">\n        <div class=\"card\">\n          <div class=\"kicker\">Character</div>\n          <div><strong>${s.core.name||'Unnamed'}</strong></div>\n          <div class=\"muted\">Player: ${s.core.playerName || '\u2014'}</div>\n          <div class=\"muted\">${s.core.race||'Race?'} \u2022 ${s.core.class||'Class?'} \u2022 Level ${s.core.level||3}</div>\n          <div style=\"margin-top:8px\">${abilityList}</div>\n          <div style=\"margin-top:8px\" class=\"muted\">Background: ${s.core.background||'\u2014'} \u2022 Equipment: ${s.core.equipment==='50gp'?'50 gp':'Class kit'}</div>\n        </div>\n        <div class=\"card\">\n          <div class=\"kicker\">University & Feat</div>\n          <div><strong>${uni?uni.name:'\u2014'}</strong> <span class=\"muted\">(${uni?uni.colours:'\u2014'})</span></div>\n          <div class=\"muted\">Spellcasting Ability for Initiate: ${s.university.spellAbility||'INT'}</div>\n        </div>\n        <div class=\"card\">\n          <div class=\"kicker\">Job & Clubs</div>\n          <div>Job: <strong>${jobName}</strong></div>\n          <div>Clubs: ${clubs.length? clubs.join(', '): '\u2014'}</div>\n        </div>\n        <div class=\"card\">\n          <div class=\"kicker\">Personality</div>\n          <div>${s.personality.traits||''}</div>\n          <div class=\"muted\">Ideal: ${s.personality.ideal||''}</div>\n          <div class=\"muted\">Bond/Rival/Friend: ${s.personality.bond||''}</div>\n          <div class=\"muted\">Goal: ${s.personality.goal||''}</div>\n          <div class=\"muted\" style=\"margin-top:6px\">Prompt: ${s.personality.prompt||'\u2014'}</div>\n        </div>\n      </div>\n      <div class=\"controls\">\n        <div class=\"left\"><button id=\"back_s\">\u2190 Back</button></div>\n        <div class=\"right\">\n          <button id=\"publish_roster\">Add to Availability Roster</button>\n          <button id=\"save_s\">Save Draft</button>\n          <button id=\"export_s\" class=\"primary\">Export JSON</button>\n          <button id=\"pdf_s\" class=\"success\">Print / PDF</button>\n        </div>\n      </div>\n    `;\n    p.querySelector('#back_s').onclick=()=>{activateStep(STEPS.findIndex(s=>s.key==='builder'));};\n    p.querySelector('#save_s').onclick=()=>State.save();\n    p.querySelector('#export_s').onclick=()=>State.export();\n    p.querySelector('#pdf_s').onclick=()=>window.print();\n    const publishBtn = p.querySelector('#publish_roster');\n    if(publishBtn){\n      if(IS_GUEST_SESSION){\n        publishBtn.disabled = true;\n        publishBtn.title = READ_ONLY_NOTICE;\n        publishBtn.textContent = 'Roster editing disabled for guests';\n      }else{\n        publishBtn.onclick = async ()=>{\n          const name = sanitizeName(State.data?.core?.name);\n          if(!name){ alert('Give your character a name in Core Setup first.'); return; }\n          const key = rosterKey(name);\n          const noteParts = [];\n          if(State.data?.core?.class) noteParts.push(State.data.core.class);\n          const uniName = uni ? uni.name : (DATA.universities.find(u=>u.key===State.data?.university?.key)?.name || '');\n          if(uniName) noteParts.push(uniName);\n          const notes = noteParts.join(' \u2022 ');\n          const status = 'Interested';\n          if(rosterHasKey(key)){\n            const roster = getRosterList();\n            const entry = roster.find(r=>r.key===key) || {name, custom:false};\n            try{\n              await updateRosterDetails(key, entry, status, notes);\n              alert(`${name} is already on the roster. Updated their status and notes.`);\n            }catch(err){\n              alert(`Failed to update roster entry: ${err && err.message ? err.message : 'Request failed.'}`);\n            }\n          } else {\n            const result = await addRosterExtra(name, status, notes);\n            if(!result.ok){ alert(result.msg); return; }\n            alert(`${name} added to the roster.`);\n          }\n        };\n      }\n    }\n    return p;\n  }\n\n  /* =======================\n     BOOT\n  ======================= */\n  function renderAll(){\n    try{\n      renderCurrentPlayerBanner();\n      renderNav();\n      renderPanels();\n      bindHeaderActions();\n    } catch(err){\n      showErrors([`Render failed: ${String(err && err.message || err)}`]);\n      console.error(err);\n    }\n  }\n  function bindHeaderActions(){\n    const s = document.getElementById('btnSave'); if(s) s.onclick=()=>State.save();\n    const l = document.getElementById('btnLoad'); if(l) l.onclick=()=>State.load();\n    const e = document.getElementById('btnExport'); if(e) e.onclick=()=>State.export();\n    const clr=document.getElementById('btnClear');\n    if(clr){ clr.onclick=()=>{\n      if(confirm('Clear all local data for this app?')){\n        LocalDraftStore.clear();\n        localStorage.removeItem('oracleOfflineState');\n        alert('Local data cleared. Reloading\u2026');\n        location.reload();\n      }\n    }}\n  }\n\n  (async function(){\n    const errs = validateConfig();\n    if(errs.length){ showErrors(errs); bindHeaderActions(); return; }\n    try{\n      await SharedState.refresh();\n    }catch(err){\n      console.warn('Initial sync failed', err);\n      NetworkStatus.setError('Unable to reach the shared datastore. Showing cached data if available.');\n    }\n    // Load saved Oracle build for the current player\n    // Only load from remote if no local draft exists (to avoid overwriting unsaved local changes)\n    if(!IS_GUEST_SESSION && CURRENT_PLAYER_KEY){\n      const localDraft = LocalDraftStore.read();\n      if(!localDraft){\n        try{\n          const savedBuild = await loadSavedBuildForPlayer(CURRENT_PLAYER_KEY);\n          if(savedBuild && typeof savedBuild === 'object'){\n            // Hydrate State.data with the saved build\n            State.data = cloneDraftData(savedBuild);\n            LocalDraftStore.write(State.data);\n            console.info('Loaded saved build for player:', CURRENT_PLAYER_KEY);\n          }\n        }catch(err){\n          console.warn('Failed to load saved build for player', err);\n        }\n      }else{\n        // Local draft exists, use it instead of loading from remote\n        State.data = cloneDraftData(localDraft);\n      }\n    }\n    renderAll();\n  })();\n\n  // Optional debug hooks for troubleshooting\n  // Access via browser console: window.ORACLE_DEBUG.State, window.ORACLE_DEBUG.save()\n  window.ORACLE_DEBUG = window.ORACLE_DEBUG || {};\n  window.ORACLE_DEBUG.State = State;\n  window.ORACLE_DEBUG.save = () => State.save();\n"],
  "mappings": "MAAO,SAASA,IAAiB,CAC/B,IAAMC,EAAM,OAAO,YAAc,CAAC,EAC5BC,EAAa,OAAOD,EAAI,YAAe,SAAWA,EAAI,WAAW,KAAK,EAAI,GAChF,GAAGC,EAAW,CACZ,IAAMC,EAAS,CAAE,GAAGF,EAAK,WAAYC,CAAW,EAChD,cAAO,WAAaC,EACbA,CACT,CACA,IAAMC,EAAc,OAAO,QAAW,aAAe,OAAO,UAAY,OAAO,SAAS,OACpF,GAAG,OAAO,SAAS,OAAO,QAAQ,MAAO,EAAE,CAAC,OAC5C,OACJ,QAAQ,KAAK,mFAAoFA,CAAU,EAC3G,IAAMD,EAAS,CAAE,GAAGF,EAAK,WAAYG,CAAW,EAChD,cAAO,WAAaD,EACbA,CACT,CC8DO,SAASE,EAAiBC,EAASC,EAAW,CACnD,GAAI,CAACD,GAAW,CAACC,EAAW,MAAO,GACnC,IAAMC,EAAgB,OAAOD,CAAS,EAAE,KAAK,EAAE,YAAY,EAC3D,OAAKC,GAEW,MAAM,QAAQF,EAAQ,OAAO,EAAIA,EAAQ,QAAU,CAAC,GACrD,KAAKG,GAEN,QACVA,GAAA,YAAAA,EAAQ,OACRA,GAAA,YAAAA,EAAQ,aACRA,GAAA,YAAAA,EAAQ,cACRA,GAAA,YAAAA,EAAQ,QACRA,GAAA,YAAAA,EAAQ,MACRA,GAAA,YAAAA,EAAQ,YACR,EACF,EAAE,KAAK,EAAE,YAAY,IACND,CAChB,EAf0B,EAgB7B,CCzFE,IAAME,GAAaC,GAAgB,EAI7BC,EAAWF,GAAW,WAEtBG,GAAkB,IAAI,CAC1B,IAAMC,EAAc,aACdC,EAAY,QAClB,SAASC,GAAM,CACb,GAAG,CACD,OAAQ,aAAa,QAAQF,CAAW,GAAK,IAAI,KAAK,EAAE,YAAY,CACtE,OAAOG,EAAI,CACT,eAAQ,KAAK,yCAA0CA,CAAG,EACnD,EACT,CACF,CACA,SAASC,GAAY,CACnB,IAAMC,EAAMH,EAAK,EACjB,GAAG,CAACG,EACF,aAAO,SAAS,KAAO,eACjB,IAAI,MAAM,yBAAyB,EAE3C,OAAOA,CACT,CACA,SAASC,GAAO,CACd,GAAG,CAAE,aAAa,WAAWN,CAAW,CAAG,MAAM,CAAC,CACpD,CACA,SAASO,GAAgB,CACvB,IAAMF,EAAMH,EAAK,EACjB,OAAIG,GACWG,GAAc,CAAE,cAAe,EAAK,CAAC,EACtC,KAAKC,GAASA,EAAM,MAAQJ,CAAG,GAAK,IACpD,CACA,SAASK,GAAS,CAChB,OAAOR,EAAK,IAAMD,CACpB,CACA,MAAO,CAAE,OAAQC,EAAM,WAAAE,EAAY,MAAAE,EAAO,eAAAC,EAAgB,QAAAG,EAAS,YAAa,IAAMT,CAAU,CAClG,GAAG,EAEGU,EAAqBZ,EAAe,WAAW,EAC/Ca,EAAmBb,EAAe,QAAQ,EAC1Cc,EAAmB,0GACzB,SAASC,EAAgBC,EAAO,sBAAsB,CACpD,GAAGH,EACD,MAAM,IAAI,MAAM,yBAAyBG,CAAM,KAAKF,CAAgB,EAAE,CAE1E,CAEA,IAAMG,GAAuB,CAC3B,SAAU,CAAC,EACX,aAAc,CAAC,EACf,WAAY,CAAC,EACb,WAAY,CAAC,CACf,EAEA,SAASC,GAAgBR,EAAM,CAC7B,GAAG,CAACA,EAAO,OAAO,KAClB,GAAG,OAAOA,GAAU,SAAS,CAC3B,IAAMS,EAAYC,EAAaV,CAAK,EACpC,OAAIS,EACG,CAAE,IAAKE,EAAUX,CAAK,EAAG,UAAAS,CAAU,EADpB,IAExB,CACA,GAAG,OAAOT,GAAU,SAAU,OAAO,KACrC,IAAMS,EAAYC,EAAaV,EAAM,WAAaA,EAAM,eAAiBA,EAAM,gBAAkBA,EAAM,MAAQA,EAAM,aAAe,EAAE,EAChIY,EAAYZ,EAAM,KAAOA,EAAM,WAAaA,EAAM,YAAcA,EAAM,MAAQA,EAAM,IAAMA,EAAM,WAAaS,EAC7Gb,EAAMe,EAAUC,CAAS,EAC/B,GAAG,CAAChB,GAAO,CAACa,EACV,OAAO,KAET,IAAMI,EAAaH,EAAaV,EAAM,YAAcA,EAAM,aAAeA,EAAM,aAAe,EAAE,EAChG,MAAO,CACL,IAAKJ,GAAOe,EAAUF,CAAS,EAC/B,UAAWA,GAAaI,GAAcjB,GAAO,GAC7C,WAAAiB,CACF,CACF,CAEA,SAASC,GAAiBC,EAAQ,CAChC,GAAG,CAACA,GAAW,OAAOA,GAAY,SAAU,OAAO,KACnD,IAAMC,EAAK,OAAOD,EAAQ,IAAM,EAAE,EAAE,KAAK,EACnCE,EAAQC,EAAiBH,EAAQ,KAAK,IAAMC,EAAK,WAAWA,CAAE,GAAK,WACnEG,EAAKD,EAAiBH,EAAQ,EAAE,EAChCK,EAAO,OAAOL,EAAQ,MAAQ,EAAE,EAAE,KAAK,EACvCM,EAAW,OAAO,SAAS,OAAON,EAAQ,QAAQ,CAAC,EAAI,OAAOA,EAAQ,QAAQ,EAAI,EAClFO,EAAU,MAAM,QAAQP,EAAQ,OAAO,EACzCA,EAAQ,QAAQ,IAAIP,EAAe,EAAE,OAAO,OAAO,EACnD,CAAC,EACL,MAAO,CACL,GAAAQ,EACA,MAAAC,EACA,GAAAE,EACA,KAAAC,EACA,SAAAC,EACA,OAAQ,EAAQN,EAAQ,OACxB,QAAAO,CACF,CACF,CAEA,SAASC,EAAqBC,EAAM,CAClC,IAAMC,EAAO,CACX,SAAU,CAAC,EACX,aAAc,CAAC,EACf,WAAY,CAAC,EACb,WAAY,CAAC,CACf,EAEA,MAAG,CAACD,GAAS,OAAOA,GAAU,WAI3B,MAAM,QAAQA,EAAM,QAAQ,GAC7BA,EAAM,SAAS,QAAST,GAAU,CAChC,IAAMW,EAAQZ,GAAiBC,CAAO,EACnCW,GAASA,EAAM,KAChBA,EAAM,QAAU,MAAM,QAAQX,EAAQ,OAAO,EACzCA,EAAQ,QAAQ,IAAIP,EAAe,EAAE,OAAO,OAAO,EACnD,CAAC,EACLiB,EAAK,SAAS,KAAKC,CAAK,EAE5B,CAAC,EAGA,MAAM,QAAQF,EAAM,YAAY,GACjCA,EAAM,aAAa,QAASG,GAAO,CACjC,GAAG,CAACA,GAAQ,OAAOA,GAAS,SAAU,OACtC,IAAMC,EAAOlB,EAAaiB,EAAK,IAAI,EACnC,GAAG,CAACC,EAAM,OACV,IAAMhC,EAAMe,EAAUgB,EAAK,KAAOC,CAAI,EAClChC,GACJ6B,EAAK,aAAa,KAAK,CACrB,IAAA7B,EACA,KAAAgC,EACA,OAAQV,EAAiBS,EAAK,MAAM,EACpC,MAAOT,EAAiBS,EAAK,KAAK,EAClC,OAAQ,EACV,CAAC,CACH,CAAC,EAGAH,EAAM,YAAc,OAAOA,EAAM,YAAe,UACjD,OAAO,QAAQA,EAAM,UAAU,EAAE,QAAQ,CAAC,CAACK,EAAQC,CAAK,IAAI,CAC1D,IAAMlC,EAAMe,EAAUkB,CAAM,EAC5B,GAAG,CAACjC,GAAO,CAACkC,GAAS,OAAOA,GAAU,SAAU,OAChD,IAAMC,EAASb,EAAiBY,EAAM,MAAM,EACtCE,EAAQd,EAAiBY,EAAM,KAAK,EACpCG,EAAS,EAAQH,EAAM,QAC1BC,GAAUC,GAASC,KACpBR,EAAK,WAAW7B,CAAG,EAAI,CAAE,OAAAmC,EAAQ,MAAAC,EAAO,OAAAC,CAAO,EAEnD,CAAC,EAGAT,EAAM,YAAc,OAAOA,EAAM,YAAe,UACjD,OAAO,QAAQA,EAAM,UAAU,EAAE,QAAQ,CAAC,CAACK,EAAQK,CAAI,IAAI,CACzD,IAAMtC,EAAMe,EAAUkB,CAAM,EAC5B,GAAG,CAACjC,GAAO,CAACsC,GAAQ,OAAOA,GAAS,SAAU,OAC9C,IAAMlC,EAAQ,CAAC,EACZkC,EAAK,QAAOlC,EAAM,MAAQkB,EAAiBgB,EAAK,KAAK,GACrDA,EAAK,aAAYlC,EAAM,WAAakB,EAAiBgB,EAAK,UAAU,IACpEA,EAAK,eAAiBA,EAAK,gBAAkBA,EAAK,QACnDlC,EAAM,cAAgBU,EAAawB,EAAK,eAAiBA,EAAK,gBAAkBA,EAAK,IAAI,GAE3FT,EAAK,WAAW7B,CAAG,EAAII,CACzB,CAAC,GAGIyB,CACT,CAEA,IAAMU,EAAoB,CACxB,IAAK,qBACL,MAAM,CACJ,GAAG,CACD,IAAMC,EAAM,aAAa,QAAQ,KAAK,GAAG,EACzC,GAAG,CAACA,EAAK,OAAO,KAChB,IAAMC,EAAS,KAAK,MAAMD,CAAG,EAC7B,GAAGC,GAAU,OAAOA,GAAW,UAAYA,EAAO,UAAY,GAAKA,EAAO,MACxE,OAAOd,EAAqBc,EAAO,KAAK,CAE5C,OAAO3C,EAAI,CACT,QAAQ,KAAK,4BAA6BA,CAAG,CAC/C,CACA,OAAO,IACT,EACA,MAAM4C,EAAM,CACV,GAAG,CACD,aAAa,QAAQ,KAAK,IAAK,KAAK,UAAU,CAAC,QAAQ,EAAG,MAAAA,CAAK,CAAC,CAAC,CACnE,OAAO5C,EAAI,CACT,QAAQ,KAAK,6BAA8BA,CAAG,CAChD,CACF,EACA,OAAO,CACL,GAAG,CAAE,aAAa,WAAW,KAAK,GAAG,CAAG,MAAM,CAAC,CACjD,CACF,EAEM6C,GAAiB,UAAU,CAC/B,IAAMC,EAAS,SAAS,eAAe,eAAe,EAClDC,EAAU,EACVC,EAAY,GAEhB,SAASC,GAAQ,CACf,GAAIH,EACJ,IAAGE,EAAU,CACXF,EAAO,YAAc,gBAAME,CAAS,GACpCF,EAAO,UAAU,IAAI,OAAO,EAC5BA,EAAO,UAAU,OAAO,SAAS,EACjCA,EAAO,OAAS,GAChB,MACF,CACGC,EAAU,GACXD,EAAO,YAAc,yCACrBA,EAAO,UAAU,IAAI,SAAS,EAC9BA,EAAO,UAAU,OAAO,OAAO,EAC/BA,EAAO,OAAS,KAEhBA,EAAO,OAAS,GAChBA,EAAO,UAAU,OAAO,OAAO,EAC/BA,EAAO,UAAU,OAAO,SAAS,GAErC,CAEA,MAAO,CACL,OAAO,CAAEC,IAAWE,EAAO,CAAG,EAC9B,KAAK,CAAEF,EAAU,KAAK,IAAI,EAAGA,EAAU,CAAC,EAAGE,EAAO,CAAG,EACrD,SAASC,EAAQ,CAAEF,EAAYE,GAAW,0BAA2BD,EAAO,CAAG,EAC/E,YAAY,CAAED,EAAY,GAAIC,EAAO,CAAG,CAC1C,CACF,GAAG,EAEGE,GAAe,UAAU,CAC7B,IAAMC,EAAK,SAAS,eAAe,aAAa,EAChD,SAASC,EAAIH,EAASI,EAAK,OAAO,CAC5BF,IACJA,EAAG,YAAcF,EACjBE,EAAG,QAAQ,KAAOE,EACpB,CACA,MAAO,CACL,KAAKJ,EAAQ,CAAEG,EAAIH,EAAS,MAAM,CAAG,EACrC,QAAQA,EAAQ,CAAEG,EAAIH,EAAS,SAAS,CAAG,EAC3C,MAAMA,EAAQ,CAAEG,EAAIH,EAAS,OAAO,CAAG,CACzC,CACF,GAAG,EAEH,SAASK,GAAYC,EAAK,CAExB,GADG,CAAC7D,GACD,YAAY,KAAK6D,CAAI,EAAG,OAAOA,EAClC,GAAG,CACD,OAAO,IAAI,IAAIA,EAAM7D,CAAQ,EAAE,SAAS,CAC1C,MAAM,CACJ,OAAOA,EAAS,QAAQ,MAAO,EAAE,EAAI6D,CACvC,CACF,CAEA,eAAeC,EAASD,EAAME,EAAQ,CAAC,EAAE,CACvC,IAAMC,EAAMJ,GAAYC,CAAI,EACtBI,EAAO,CAAC,GAAGF,CAAO,EACxBE,EAAK,QAAU,CAAC,GAAIF,EAAQ,SAAS,CAAC,CAAE,EACrCE,EAAK,MAAQ,EAAEA,EAAK,gBAAgB,WAAa,CAACA,EAAK,QAAQ,cAAc,IAC9EA,EAAK,QAAQ,cAAc,EAAI,oBAGjCf,EAAc,MAAM,EACpB,GAAG,CACD,IAAMgB,EAAW,MAAM,MAAMF,EAAKC,CAAI,EACtC,GAAG,CAACC,EAAS,GAAG,CACd,IAAMC,EAAO,MAAMD,EAAS,KAAK,EACjC,MAAM,IAAI,MAAMC,GAAQ,mBAAmBD,EAAS,MAAM,GAAG,CAC/D,CACA,IAAME,EAAcF,EAAS,QAAQ,IAAI,cAAc,GAAK,GACxDG,EAAU,KACd,OAAGD,EAAY,SAAS,kBAAkB,EACxCC,EAAU,MAAMH,EAAS,KAAK,EAE9BG,EAAU,MAAMH,EAAS,KAAK,EAEhChB,EAAc,WAAW,EAClBmB,CACT,OAAOhE,EAAI,CACT,MAAA6C,EAAc,SAAS7C,GAAOA,EAAI,QAAUA,EAAI,QAAU,yBAAyB,EAC7EA,CACR,QAAC,CACC6C,EAAc,IAAI,CACpB,CACF,CAEF,SAASoB,IAA4B,CACnC,IAAMb,EAAK,SAAS,eAAe,uBAAuB,EAC1D,GAAI,CAACA,EAAI,OAGT,IAAMc,EAAY1D,EAClB,GAAI,CAAC0D,EAAW,CACdd,EAAG,UAAY,GACf,MACF,CAEA,IAAMe,EAAcvE,EAAe,eAAe,EAC5CwE,GAAcD,GAAA,YAAAA,EAAa,OAAQD,EAEnCG,EADUzE,EAAe,QAAQ,EACR,QAAUwE,EAEzChB,EAAG,UAAY;AAAA;AAAA,yFAEwEkB,EAAWD,CAAY,CAAC;AAAA;AAAA;AAAA,IAK/G,IAAME,EAAY,SAAS,eAAe,YAAY,EAClDA,IAEFA,EAAU,QAAUC,GAExB,CAEA,SAASA,IAAe,CAEtB5E,EAAe,MAAM,EAErB,OAAO,SAAS,KAAO,cACzB,CAGE,OAAO,UAAY,OAAO,WAAa,CAAC,EACxC,OAAO,UAAU,kBAAoB,gBAAkC,CACrE,IAAMiE,EAAW,MAAMJ,EAAS,aAAc,CAAE,QAAQ,CAAE,OAAO,kBAAmB,CAAE,CAAC,EACvF,eAAQ,KAAK,gDAAiDI,CAAQ,EAC/DA,CACT,EAEA,IAAMY,EAAc,CAClB,KAAM5C,EAAqBhB,EAAoB,EAC/C,QAAS,GACT,SAAUgB,EAAqBhB,EAAoB,EACnD,UAAW,IAAI,IACf,MAAM+B,EAAO8B,EAAO,SAAS,CAC3B,IAAMC,EAAa9C,EAAqBe,CAAK,EAC7C,YAAK,KAAO+B,EACTD,IAAW,UACZjC,EAAkB,MAAMkC,CAAU,EAClC,KAAK,QAAU,KAEf,KAAK,QAAU,GACZD,IAAW,iBACZjC,EAAkB,MAAMkC,CAAU,GAGtC,KAAK,OAAO,EACLA,CACT,EACA,oBAAoBC,EAAK,CACpB,MAAM,QAAQA,CAAI,IACnB,KAAK,SAAS,SAAWA,EAAK,IAAKvD,GAAU,CAC3C,IAAMW,EAAQZ,GAAiBC,CAAO,EACtC,OAAOW,EAAQ,CACb,GAAGA,EACH,QAAS,MAAM,QAAQA,EAAM,OAAO,EAChCA,EAAM,QAAQ,IAAI6C,IAAW,CAAE,GAAGA,CAAO,EAAE,EAC3C,CAAC,CACP,EAAI,IACN,CAAC,EAAE,OAAO,OAAO,EAErB,EACA,oBAAoB,CAClB,KAAK,MAAM,KAAK,SAAU,iBAAiB,CAC7C,EACA,uBAAuB,CACrB,IAAMC,EAASrC,EAAkB,KAAK,EACtC,OAAGqC,GACD,KAAK,MAAMA,EAAQ,eAAe,EAC3B,IAEF,EACT,EACA,MAAM,SAAS,CACb,GAAG,CACD,IAAMd,EAAU,MAAMP,EAAS,aAAc,CAAE,QAAQ,CAAC,OAAS,kBAAkB,CAAE,CAAC,EACtF,GAAG,CAACO,GAAW,OAAOA,GAAY,UAAY,CAACA,EAAQ,MACrD,MAAM,IAAI,MAAM,kCAAkC,EAEpD,YAAK,MAAMA,EAAQ,MAAO,QAAQ,EAC3B,KAAK,IACd,OAAOhE,EAAI,CAET,MADiB,KAAK,sBAAsB,GAE1C,KAAK,mBAAmB,EAEpBA,CACR,CACF,EACA,UAAU+E,EAAG,CACX,GAAG,OAAOA,GAAO,WAAW,CAC1B,KAAK,UAAU,IAAIA,CAAE,EACrB,GAAG,CAAEA,EAAG,KAAK,IAAI,CAAG,OAAO/E,EAAI,CAAE,QAAQ,MAAMA,CAAG,CAAG,CACvD,CACA,MAAO,IAAI,KAAK,UAAU,OAAO+E,CAAE,CACrC,EACA,QAAQ,CACN,KAAK,UAAU,QAASA,GAAK,CAC3B,GAAG,CAAEA,EAAG,KAAK,IAAI,CAAG,OAAO/E,EAAI,CAAE,QAAQ,MAAMA,CAAG,CAAG,CACvD,CAAC,CACH,EACA,iBAAiB,CACf,OAAO,KAAK,KAAK,SAAS,IAAKqB,IAAW,CACxC,GAAGA,EACH,QAAS,MAAM,QAAQA,EAAQ,OAAO,EAClCA,EAAQ,QAAQ,IAAIwD,IAAW,CAAE,GAAGA,CAAO,EAAE,EAC7C,CAAC,CACP,EAAE,CACJ,CACF,EAEMG,EAAU,CACd,MAAM,YAAYC,EAAWjB,EAAQ,CACnCrD,EAAgB,eAAe,EAC/B,IAAMwD,EAAcvE,EAAe,eAAe,EAC5CsF,EAAO,CACX,GAAGlB,EACH,WAAWA,GAAA,YAAAA,EAAS,YAAaxD,EACjC,YAAYwD,GAAA,YAAAA,EAAS,cAAcG,GAAA,YAAAA,EAAa,OAAQ,GACxD,eAAeH,GAAA,YAAAA,EAAS,iBAAiBA,GAAA,YAAAA,EAAS,KACpD,EACMmB,EAAM,MAAM1B,EAAS,iBAAiB,mBAAmBwB,CAAS,CAAC,QAAS,CAChF,OAAO,OACP,KAAM,KAAK,UAAUC,CAAI,CAC3B,CAAC,EACD,OAAGC,GAAOA,EAAI,OACZV,EAAY,MAAMU,EAAI,MAAO,QAAQ,EAEhCA,CACT,EACA,MAAM,aAAaF,EAAWjB,EAAQ,CACpCrD,EAAgB,gBAAgB,EAChC,IAAMuE,EAAO,CACX,GAAGlB,EACH,WAAWA,GAAA,YAAAA,EAAS,YAAaxD,CACnC,EACM2E,EAAM,MAAM1B,EAAS,iBAAiB,mBAAmBwB,CAAS,CAAC,SAAU,CACjF,OAAO,OACP,KAAM,KAAK,UAAUC,CAAI,CAC3B,CAAC,EACD,OAAGC,GAAOA,EAAI,OACZV,EAAY,MAAMU,EAAI,MAAO,QAAQ,EAEhCA,CACT,EACA,MAAM,eAAenB,EAAQ,CAC3BrD,EAAgB,oBAAoB,EACpC,IAAMwE,EAAM,MAAM1B,EAAS,qBAAsB,CAC/C,OAAO,OACP,KAAM,KAAK,UAAUO,CAAO,CAC9B,CAAC,EACD,OAAGmB,GAAOA,EAAI,OACZV,EAAY,MAAMU,EAAI,MAAO,QAAQ,EAEhCA,CACT,EACA,MAAM,kBAAkBjF,EAAK8D,EAAQ,CACnCrD,EAAgB,iBAAiB,EACjC,IAAMwE,EAAM,MAAM1B,EAAS,eAAe,mBAAmBvD,CAAG,CAAC,GAAI,CACnE,OAAO,QACP,KAAM,KAAK,UAAU8D,CAAO,CAC9B,CAAC,EACD,OAAGmB,GAAOA,EAAI,OACZV,EAAY,MAAMU,EAAI,MAAO,QAAQ,EAEhCA,CACT,EACA,MAAM,kBAAkBjF,EAAI,CAC1BS,EAAgB,uBAAuB,EACvC,IAAMwE,EAAM,MAAM1B,EAAS,sBAAsB,mBAAmBvD,CAAG,CAAC,GAAI,CAC1E,OAAO,QACT,CAAC,EACD,OAAGiF,GAAOA,EAAI,OACZV,EAAY,MAAMU,EAAI,MAAO,QAAQ,EAEhCA,CACT,CACF,EAEMC,GAAoB,CACxB,MAAM,CACJ,OAAOX,EAAY,KAAK,YAC1B,CACF,EAEMY,GAAkB,CACtB,MAAM,CACJ,OAAOZ,EAAY,KAAK,UAC1B,CACF,EAEMa,GAAc,CAAE,IAAK,QAAS,IAAK,OAAQ,IAAK,OAAQ,IAAM,SAAU,IAAK,OAAQ,EAE3F,SAAStE,EAAaoB,EAAM,CAC1B,OAAO,OAAOA,GAAA,KAAAA,EAAS,EAAE,EAAE,KAAK,CAClC,CAEA,SAASZ,EAAiBY,EAAM,CAC9B,OAAO,OAAOA,GAAA,KAAAA,EAAS,EAAE,EAAE,KAAK,CAClC,CAEA,SAASnB,EAAUiB,EAAK,CACtB,OAAOlB,EAAakB,CAAI,EAAE,YAAY,CACxC,CAEA,SAASoC,EAAWlC,EAAM,CACxB,OAAO,OAAOA,GAAA,KAAAA,EAAS,EAAE,EAAE,QAAQ,WAAamD,GAAKD,GAAYC,CAAE,GAAGA,CAAE,CAC1E,CAEA,SAASC,GAAWpD,EAAM,CACxB,OAAOkC,EAAWlC,CAAK,CACzB,CAEA,IAAIqD,GAAmB,IAAI,IAE3B,SAASC,GAAaxF,EAAI,CACxB,IAAMyE,EAAa1D,EAAUf,CAAG,EAChC,OAAIyE,EACDc,GAAiB,IAAId,CAAU,EAAU,GACrCS,GAAkB,KAAK,EAAE,KAAK9E,GAASA,EAAM,MAAQqE,CAAU,EAF/C,EAGzB,CAEA,eAAegB,GAAezD,EAAMG,EAAO,GAAIC,EAAM,GAAG,CACtD,GAAG7B,EACD,MAAO,CAAC,GAAG,GAAO,IAAKC,CAAgB,EAEzC,IAAMkF,EAAY5E,EAAakB,CAAI,EACnC,GAAG,CAAC0D,EAAW,MAAO,CAAC,GAAG,GAAO,IAAI,mBAAmB,EACxD,IAAM1F,EAAMe,EAAU2E,CAAS,EAC/B,GAAGF,GAAaxF,CAAG,EAAG,MAAO,CAAC,GAAG,GAAO,IAAI,GAAG0F,CAAS,4BAA4B,EACpF,IAAMC,EAAcrE,EAAiBa,CAAM,EACrCyD,EAAatE,EAAiBc,CAAK,EACzC,GAAG,CACD,aAAM0C,EAAQ,eAAe,CAAE,KAAMY,EAAW,OAAQC,EAAa,MAAOC,CAAW,CAAC,EACjF,CAAC,GAAG,GAAM,IAAA5F,EAAK,KAAM0F,CAAS,CACvC,OAAO5F,EAAI,CACT,MAAO,CAAC,GAAG,GAAO,IAAKA,GAAOA,EAAI,QAAUA,EAAI,QAAU,6BAA6B,CACzF,CACF,CAEA,eAAe+F,GAAoB7F,EAAKI,EAAO+B,EAAQC,EAAO0D,EAAe,CAC3E,GAAGvF,EACD,MAAM,IAAI,MAAMC,CAAgB,EAElC,IAAMuF,EAAWhF,EAAUf,CAAG,EAC9B,GAAG,CAAC+F,EAAU,OACd,IAAMJ,EAAcrE,EAAiBa,CAAM,EACrCyD,EAAatE,EAAiBc,CAAK,EACnCC,EAASyD,GAAkB,KAAO,GAAQ1F,GAASA,EAAM,QAAU,EAAQ0F,EACjF,MAAMhB,EAAQ,kBAAkBiB,EAAU,CACxC,OAAQJ,EACR,MAAOC,EACP,OAAQ,GAAQxF,GAASA,EAAM,QAC/B,KAAMA,GAASA,EAAM,KAAOU,EAAaV,EAAM,IAAI,EAAI,GACvD,OAAAiC,CACF,CAAC,CACH,CAmBA,SAAS2D,GAAcC,EAAK,CAAC,EAAE,CAC7B,IAAMC,EAAgB,EAAQD,EAAK,cAC7BE,EAASC,GAAkB,KAAK,EAChCC,EAAOC,GAAgB,KAAK,EAC5BC,EAAO,CAAC,EAEd,OAAAC,EAAK,OAAO,QAASC,GAAI,CACvB,IAAMC,EAAMC,EAAUF,EAAE,KAAOA,EAAE,IAAI,EAC/BG,EAAWP,EAAKK,CAAG,GAAK,CAAC,EACzBG,EAAQ,CACZ,KAAMJ,EAAE,KACR,IAAAC,EACA,OAAQE,EAAS,QAAUE,EAAiBL,EAAE,MAAM,EACpD,MAAOG,EAAS,OAASE,EAAiBL,EAAE,KAAK,EACjD,OAAQ,GACR,OAAQ,EAAQG,EAAS,MAC3B,EACGC,EAAM,QAAU,CAACX,GAGpBK,EAAK,KAAKM,CAAK,CACjB,CAAC,EAEDV,EAAO,QAASY,GAAO,CACrB,IAAML,EAAMC,EAAUI,EAAK,KAAOA,EAAK,IAAI,EACrCH,EAAWP,EAAKK,CAAG,GAAK,CAAC,EACzBG,EAAQ,CACZ,KAAME,EAAK,KACX,IAAAL,EACA,OAAQE,EAAS,QAAUE,EAAiBC,EAAK,MAAM,EACvD,MAAOH,EAAS,OAASE,EAAiBC,EAAK,KAAK,EACpD,OAAQ,GACR,OAAQ,EAAQH,EAAS,MAC3B,EACGC,EAAM,QAAU,CAACX,GAGpBK,EAAK,KAAKM,CAAK,CACjB,CAAC,EAEMN,EAAK,KAAK,CAACS,EAAEC,IAAID,EAAE,KAAK,cAAcC,EAAE,KAAK,KAAK,CAAC,YAAY,MAAM,CAAC,CAAC,CAChF,CAaA,SAASC,GAAWC,EAAG,CACrB,IAAMC,EAAMC,GAAK,OAAOA,CAAC,EAAE,SAAS,EAAE,GAAG,EACzC,OAAOF,EAAG,YAAY,EAAEC,EAAID,EAAG,SAAS,EAAE,CAAC,EAAEC,EAAID,EAAG,QAAQ,CAAC,EAAE,IAAIC,EAAID,EAAG,SAAS,CAAC,EAAEC,EAAID,EAAG,WAAW,CAAC,EAAEC,EAAID,EAAG,WAAW,CAAC,CAChI,CAEA,SAASG,GAAYC,EAAQ,CAC3B,IAAMC,EAAK,mBAELC,EAAQ,IAAI,KAAKF,EAAQ,KAAO,WAAW,EAC3CG,EAAQ,IAAI,KAAKH,EAAQ,KAAO,WAAW,EAE3CI,EAAM,CACV,kBAAkB,cAAc,wCAAwC,qBAAqB,iBAAiB,eAC9G,OAHU,GAAGJ,EAAQ,EAAE,eAGb,GACV,WAAWA,EAAQ,KAAK,GACxB,mBAAmBA,EAAQ,EAAE,gBAAgBA,EAAQ,QAAQ,GAC7D,gBAAgBC,CAAE,IAAIN,GAAWO,CAAK,CAAC,GACvC,cAAcD,CAAE,IAAIN,GAAWQ,CAAG,CAAC,GACnC,aAAa,eACf,EAAE,KAAK;AAAA,CAAM,EACPE,EAAO,IAAI,KAAK,CAACD,CAAG,EAAG,CAAC,KAAK,eAAe,CAAC,EAC7CE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAO,IAAI,gBAAgBD,CAAI,EACjCC,EAAE,SAAW,GAAGN,EAAQ,MAAM,QAAQ,OAAO,GAAG,CAAC,OACjDM,EAAE,MAAM,EACR,IAAI,gBAAgBA,EAAE,IAAI,CAC5B,CAKA,IAAMC,EAAO,CACX,OAAO,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,EAC1D,cAAc,CAAE,SAAS,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,CAAE,EAC5C,aAAa,CACX,CAAE,IAAI,WAAY,KAAK,WAAY,MAAM,oBAAqB,QAAQ,YAAa,MAAM,eAAgB,UAAU,qBAAsB,QAAQ,0EAA2E,OAAO,CAC/N,EAAE,CAAC,uBAAuB,UAAU,EACpC,EAAE,CAAC,qBAAqB,eAAe,EACvC,EAAE,CAAC,kBAAkB,kBAAkB,EACvC,EAAE,CAAC,aAAa,aAAa,EAC7B,EAAE,CAAC,eAAe,aAAa,CACnC,CAAC,EACD,CAAE,IAAI,WAAY,KAAK,WAAY,MAAM,iBAAkB,QAAQ,WAAY,MAAM,yBAA0B,UAAU,sBAAuB,QAAQ,wEAAyE,OAAO,CACpO,EAAE,CAAC,gBAAgB,aAAa,EAChC,EAAE,CAAC,iBAAiB,eAAe,EACnC,EAAE,CAAC,QAAQ,YAAY,EACvB,EAAE,CAAC,sBAAsB,cAAc,EACvC,EAAE,CAAC,eAAe,mBAAmB,CACzC,CAAC,EACD,CAAE,IAAI,WAAY,KAAK,WAAY,MAAM,gBAAiB,QAAQ,aAAc,MAAM,oBAAqB,UAAU,oBAAqB,QAAQ,iFAAkF,OAAO,CACvO,EAAE,CAAC,WAAW,cAAc,EAC5B,EAAE,CAAC,iBAAiB,aAAa,EACjC,EAAE,CAAC,mBAAmB,OAAO,EAC7B,EAAE,CAAC,gBAAgB,qBAAqB,EACxC,EAAE,CAAC,kBAAkB,UAAU,CACnC,CAAC,EACD,CAAE,IAAI,cAAe,KAAK,cAAe,MAAM,kBAAmB,QAAQ,cAAe,MAAM,oBAAqB,UAAU,iBAAkB,QAAQ,0EAA2E,OAAO,CACtO,EAAE,CAAC,qBAAqB,eAAe,EACvC,EAAE,CAAC,gBAAgB,UAAU,EAC7B,EAAE,CAAC,iBAAiB,UAAU,EAC9B,EAAE,CAAC,aAAa,WAAW,EAC3B,EAAE,CAAC,kBAAkB,6BAAwB,CACjD,CAAC,EACD,CAAE,IAAI,cAAe,KAAK,cAAe,MAAM,eAAgB,QAAQ,cAAe,MAAM,oBAAqB,UAAU,iBAAkB,QAAQ,0EAA2E,OAAO,CACnO,EAAE,CAAC,cAAc,gBAAgB,EACjC,EAAE,CAAC,qBAAqB,kBAAkB,EAC1C,EAAE,CAAC,WAAW,gBAAgB,EAC9B,EAAE,CAAC,SAAS,YAAY,EACxB,EAAE,CAAC,iBAAiB,qBAAqB,CAC7C,CAAC,CACH,EACA,YAAY,CACV,CAAC,IAAI,mBAAoB,KAAK,mBAAoB,OAAO,CAAC,UAAU,UAAU,EAAG,MAAM,CAAC,EAAG,UAAU,cAAe,KAAK,CAAC,UAAU,SAAS,UAAU,eAAe,SAAS,EAAG,KAAK,gCAAgC,EACvN,CAAC,IAAI,mBAAoB,KAAK,mBAAoB,OAAO,CAAC,aAAa,aAAa,EAAG,MAAM,CAAC,oBAAoB,EAAG,UAAU,IAAK,KAAK,CAAC,UAAU,8BAA8B,SAAS,EAAG,KAAK,gCAAgC,EACnO,CAAC,IAAI,mBAAoB,KAAK,mBAAoB,OAAO,CAAC,SAAS,QAAQ,EAAG,MAAM,CAAC,iBAAiB,EAAG,UAAU,IAAK,KAAK,CAAC,UAAU,SAAS,qBAAqB,SAAS,EAAG,KAAK,mCAAmC,EAC1N,CAAC,IAAI,sBAAuB,KAAK,sBAAuB,OAAO,CAAC,eAAe,YAAY,EAAG,MAAM,CAAC,EAAG,UAAU,IAAK,KAAK,CAAC,UAAU,cAAc,SAAS,EAAG,KAAK,mCAAmC,EACzM,CAAC,IAAI,sBAAuB,KAAK,sBAAuB,OAAO,CAAC,SAAS,UAAU,EAAG,MAAM,CAAC,eAAe,EAAG,UAAU,IAAK,KAAK,CAAC,gBAAgB,WAAW,gBAAgB,SAAS,EAAG,KAAK,mCAAmC,CACrO,EACA,MAAM,CACJ,mBAAmB,CACjB,KAAK,sBACL,KAAK,+MACP,CACF,EACA,iBAAiB,CACf,CAAC,IAAI,iBAAkB,KAAK,yBAA0B,OAAO,CAAC,YAAY,SAAS,CAAC,EACpF,CAAC,IAAI,eAAgB,KAAK,wCAAyC,OAAO,CAAC,cAAc,iBAAiB,CAAC,EAC3G,CAAC,IAAI,cAAe,KAAK,mBAAoB,OAAO,CAAC,YAAY,eAAe,CAAC,EACjF,CAAC,IAAI,iBAAkB,KAAK,kCAAmC,OAAO,CAAC,SAAS,SAAS,CAAC,EAC1F,CAAC,IAAI,eAAgB,KAAK,gCAAiC,OAAO,CAAC,SAAS,UAAU,CAAC,EACvF,CAAC,IAAI,gBAAiB,KAAK,qCAAsC,OAAO,CAAC,UAAU,YAAY,CAAC,EAChG,CAAC,IAAI,aAAc,KAAK,wBAAyB,OAAO,CAAC,aAAa,aAAa,CAAC,EACpF,CAAC,IAAI,WAAY,KAAK,gBAAiB,OAAO,CAAC,YAAY,cAAc,CAAC,EAC1E,CAAC,IAAI,cAAe,KAAK,qBAAsB,OAAO,CAAC,YAAY,aAAa,CAAC,EACjF,CAAC,IAAI,OAAQ,KAAK,aAAc,OAAO,CAAC,kBAAkB,aAAa,CAAC,EACxE,CAAC,IAAI,QAAS,KAAK,mBAAoB,OAAO,CAAC,aAAa,YAAY,CAAC,EACzE,CAAC,IAAI,QAAS,KAAK,yBAA0B,OAAO,CAAC,SAAS,WAAW,CAAC,EAC1E,CAAC,IAAI,eAAgB,KAAK,eAAgB,OAAO,CAAC,YAAY,UAAU,CAAC,EACzE,CAAC,IAAI,YAAa,KAAK,YAAa,OAAO,CAAC,kBAAkB,aAAa,CAAC,EAC5E,CAAC,IAAI,YAAa,KAAK,8BAA+B,OAAO,CAAC,gBAAgB,SAAS,CAAC,EACxF,CAAC,IAAI,QAAS,KAAK,yBAA0B,OAAO,CAAC,UAAU,UAAU,CAAC,CAC5E,EACA,KAAK,CACH,CAAC,IAAI,aAAc,KAAK,aAAc,OAAO,CAAC,SAAS,SAAS,CAAC,EACjE,CAAC,IAAI,WAAY,KAAK,mBAAiB,OAAO,CAAC,UAAU,YAAY,CAAC,EACtE,CAAC,IAAI,UAAW,KAAK,mBAAoB,OAAO,CAAC,cAAc,WAAW,CAAC,EAC3E,CAAC,IAAI,UAAW,KAAK,UAAW,OAAO,CAAC,YAAY,cAAc,CAAC,EACnE,CAAC,IAAI,kBAAmB,KAAK,0BAA2B,OAAO,CAAC,cAAc,WAAW,CAAC,EAC1F,CAAC,IAAI,QAAS,KAAK,cAAe,OAAO,CAAC,aAAa,YAAY,CAAC,EACpE,CAAC,IAAI,UAAW,KAAK,iBAAkB,OAAO,CAAC,SAAS,UAAU,CAAC,EACnE,CAAC,IAAI,OAAQ,KAAK,aAAc,OAAO,CAAC,SAAS,eAAe,CAAC,EACjE,CAAC,IAAI,aAAc,KAAK,oBAAqB,OAAO,CAAC,YAAY,YAAY,CAAC,CAChF,EACA,OAAO,CACJ,CAAE,KAAM,QAAgB,OAAQ,MAAO,IAAK,UAAW,EAE5D,CAAE,KAAM,UAAgB,OAAQ,MAAO,IAAK,WAAY,EACxD,CAAE,KAAM,OAAgB,OAAQ,UAAW,IAAK,UAAW,EAC3D,CAAE,KAAM,QAAgB,OAAQ,UAAW,IAAK,WAAY,EAC5D,CAAE,KAAM,UAAgB,OAAQ,UAAW,IAAK,UAAW,EAC3D,CAAE,KAAM,QAAgB,OAAQ,UAAW,IAAK,WAAY,EAC5D,CAAE,KAAM,aAAgB,OAAQ,MAAO,IAAK,QAAS,EACrD,CAAE,KAAM,OAAgB,OAAQ,MAAO,IAAK,UAAW,EACvD,CAAE,KAAM,SAAgB,OAAQ,MAAO,IAAK,UAAW,EACvD,CAAE,KAAM,MAAgB,OAAQ,MAAO,IAAK,WAAY,EACxD,CAAE,KAAM,SAAgB,OAAQ,MAAO,IAAK,YAAa,EACzD,CAAE,KAAM,UAAgB,OAAQ,MAAO,IAAK,YAAa,EACzD,CAAE,KAAM,SAAgB,OAAQ,UAAW,IAAK,UAAW,EAC3D,CAAE,KAAM,UAAgB,OAAQ,UAAW,IAAK,YAAa,EAC7D,CAAE,KAAM,SAAgB,OAAQ,UAAW,IAAK,YAAa,EAC7D,CAAE,KAAM,QAAgB,OAAQ,MAAO,IAAK,WAAY,EACxD,CAAE,KAAM,OAAgB,OAAQ,MAAO,IAAK,UAAW,EACvD,CAAE,KAAM,QAAgB,OAAQ,UAAW,IAAK,WAAY,EAC5D,CAAE,KAAM,UAAgB,OAAQ,MAAO,IAAK,UAAW,EACvD,CAAE,KAAM,SAAgB,OAAQ,UAAW,IAAK,YAAa,EAC7D,CAAE,KAAM,QAAgB,OAAQ,UAAW,IAAK,WAAY,EAC5D,CAAE,KAAM,QAAgB,OAAQ,UAAW,IAAK,WAAY,EAC5D,CAAE,KAAM,OAAgB,OAAQ,MAAO,IAAK,UAAW,EACvD,CAAE,KAAM,UAAgB,OAAQ,MAAO,IAAK,eAAgB,EAC5D,CAAE,KAAM,OAAgB,OAAQ,MAAO,IAAK,YAAa,EACzD,CAAE,KAAM,UAAgB,OAAQ,UAAW,IAAK,aAAc,CAC5D,EACA,SAAS,CAAC,CACZ,EAGAA,EAAK,OAAS,CAAC,GAAGA,EAAK,MAAM,EAAE,KAAK,CAACD,EAAEE,IAAIF,EAAE,KAAK,cAAcE,EAAE,KAAK,IAAI,CAAC,EAC5EC,GAAmB,IAAI,IAAIF,EAAK,OAAO,IAAIG,GAAGC,EAAUD,EAAE,KAAOA,EAAE,IAAI,CAAC,CAAC,EAEzEE,EAAY,mBAAmB,EAG/B,IAAMC,GAAc,CAClB,OAAQ,CAAE,MAAO,EACjB,aAAc,CAAE,QAAW,CAAC,YAAY,CAAE,CAC5C,EAKA,SAASC,IAAgB,CACvB,IAAMC,EAAO,CAAC,EAEd,GAAG,CACD,GAAG,CAAC,MAAM,QAAQR,EAAK,QAAQ,EAAGQ,EAAO,KAAK,2CAA2C,MACrF,CACF,IAAMC,EAAI,IAAI,IACdT,EAAK,SAAS,QAAQ,CAACU,EAAEC,IAAM,CAC7B,GAAG,CAACD,GAAK,OAAOA,GAAI,SAAS,CAAEF,EAAO,KAAK,YAAYG,CAAG,oBAAoB,EAAG,MAAQ,CACrFD,EAAE,IAAIF,EAAO,KAAK,YAAYG,CAAG,oBAAoB,EACtDD,EAAE,KAAQD,EAAI,IAAIC,EAAE,EAAE,EAAGF,EAAO,KAAK,yBAAyBE,EAAE,EAAE,EAAE,EAAQD,EAAI,IAAIC,EAAE,EAAE,GACvF,sBAAsB,KAAK,OAAOA,EAAE,MAAM,EAAE,CAAC,GAAGF,EAAO,KAAK,GAAGE,EAAE,OAAOA,EAAE,IAAK,WAAWC,CAAI,sBAAsBD,EAAE,IAAI,GAAG,EAC9H,OAAOA,EAAE,UAAa,UAAUF,EAAO,KAAK,GAAGE,EAAE,OAAOA,EAAE,IAAK,WAAWC,CAAI,4BAA4B,CAC/G,CAAC,CACH,CACF,MAAM,CAAEH,EAAO,KAAK,uCAAuC,CAAG,CAE9D,GAAG,CAAM,MAAM,QAAQR,EAAK,MAAM,GAAGQ,EAAO,KAAK,yCAAyC,CAAG,MACxF,CAAEA,EAAO,KAAK,qCAAqC,CAAG,CAE3D,OAAOA,CACT,CAEA,SAASI,GAAWJ,EAAO,CACzB,GAAG,CAACA,GAAU,CAACA,EAAO,OAAQ,OAC9B,IAAMK,EAAK,SAAS,cAAc,MAAM,EAClCC,EAAI,SAAS,cAAc,KAAK,EACtCA,EAAI,UAAU,QACdA,EAAI,MAAM,OAAO,oBACjBA,EAAI,MAAM,WAAW,UACrBA,EAAI,UAAY;AAAA;AAAA;AAAA,YAGRN,EAAO,IAAIO,GAAG,OAAOA,EAAE,QAAQ,KAAK,MAAM,EAAE,QAAQ,KAAK,MAAM,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;AAAA,MAEzFF,EAAK,QAAQC,CAAG,CAClB,CAEA,OAAO,iBAAiB,QAAU,GAAI,CACpC,IAAMD,EAAK,SAAS,cAAc,MAAM,EACxC,GAAG,CAACA,EAAM,OACV,IAAMC,EAAI,SAAS,cAAc,KAAK,EACtCA,EAAI,UAAU,QACdA,EAAI,MAAM,OAAO,oBACjBA,EAAI,MAAM,WAAW,UACrBA,EAAI,UAAU,mCAAmC,OAAO,EAAE,SAAS,eAAe,CAAC,GACnFD,EAAK,QAAQC,CAAG,CAClB,CAAC,EAKD,IAAME,EAAkB,CACtB,IAAK,mBACL,MAAM,CACJ,GAAG,CACD,IAAMC,EAAM,aAAa,QAAQ,KAAK,GAAG,EACzC,OAAIA,EACG,KAAK,MAAMA,CAAG,EADL,IAElB,OAAOC,EAAI,CACT,eAAQ,KAAK,0BAA2BA,CAAG,EACpC,IACT,CACF,EACA,MAAMC,EAAK,CACT,GAAG,CACD,aAAa,QAAQ,KAAK,IAAK,KAAK,UAAUA,CAAI,CAAC,CACrD,OAAOD,EAAI,CACT,QAAQ,KAAK,2BAA4BA,CAAG,CAC9C,CACF,EACA,OAAO,CACL,GAAG,CAAE,aAAa,WAAW,KAAK,GAAG,CAAG,OAAOA,EAAI,CAAE,QAAQ,KAAK,2BAA4BA,CAAG,CAAG,CACtG,CACF,EAEA,SAASE,EAAeD,EAAK,CAC3B,GAAG,CACD,OAAO,KAAK,MAAM,KAAK,UAAUA,GAAQ,CAAC,CAAC,CAAC,CAC9C,OAAOD,EAAI,CACT,eAAQ,KAAK,qBAAsBA,CAAG,EAC/B,CAAC,CACV,CACF,CAkBA,eAAeG,GAAwBC,EAAW,CAChD,GAAI,CAACA,EACH,eAAQ,KAAK,gDAAgD,EACtD,KAET,GAAI,CACF,IAAMC,EAAU,mBAAmBD,CAAS,EACtCE,EAAW,MAAM,MAAMC,GAAY,eAAeF,CAAO,EAAE,EAAG,CAClE,QAAS,CAAE,OAAQ,kBAAmB,CACxC,CAAC,EACD,GAAIC,EAAS,SAAW,IAEtB,OAAO,KAET,GAAI,CAACA,EAAS,GAAI,CAChB,IAAME,EAAO,MAAMF,EAAS,KAAK,EACjC,eAAQ,MAAM,kCAAmCE,CAAI,EAC9C,IACT,CAEA,OADa,MAAMF,EAAS,KAAK,CAEnC,OAASG,EAAK,CACZ,eAAQ,MAAM,iCAAkCA,CAAG,EAC5C,IACT,CACF,CAEA,eAAeC,GAAmBN,EAAWO,EAAO,CAClD,GAAI,CAACP,EACH,eAAQ,KAAK,2CAA2C,EACjD,GAET,GAAI,CAACO,GAAS,OAAOA,GAAU,SAC7B,eAAQ,KAAK,0CAA0C,EAChD,GAET,GAAI,CACF,IAAMN,EAAU,mBAAmBD,CAAS,EACtCE,EAAW,MAAM,MAAMC,GAAY,eAAeF,CAAO,EAAE,EAAG,CAClE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAUM,CAAK,CAC5B,CAAC,EACD,GAAI,CAACL,EAAS,GAAI,CAChB,IAAME,EAAO,MAAMF,EAAS,KAAK,EACjC,eAAQ,MAAM,6BAA8BE,CAAI,EACzC,EACT,CACA,MAAO,EACT,OAASC,EAAK,CACZ,eAAQ,MAAM,4BAA6BA,CAAG,EACvC,EACT,CACF,CAEA,IAAMG,EAAQ,CACZ,KAAK,CACH,KAAK,CAAC,QAAQ,YAAY,EAC1B,KAAK,CAAE,WAAW,GAAI,KAAK,GAAI,KAAK,GAAI,MAAM,GAAI,WAAW,GAAI,MAAM,EAAG,cAAc,WAAY,UAAU,CAAC,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,EAAG,UAAU,OAAO,EAC3K,WAAW,CAAE,IAAI,GAAI,aAAa,KAAM,EACxC,MAAM,CAAC,EACP,OAAO,CAAE,IAAI,KAAM,MAAM,CAAC,EAAG,YAAY,CAAC,CAAE,EAC5C,YAAY,CAAE,OAAO,GAAI,MAAM,GAAI,KAAK,GAAI,MAAM,GAAI,KAAK,GAAI,OAAO,EAAG,EACzE,MAAM,CAAE,MAAM,GAAI,aAAa,EAAG,QAAQ,CAAC,CAAE,CAC/C,EACA,SAAU,CAAC,EACX,MAAM,MAAM,CACV,IAAMC,EAAWC,EAAe,KAAK,IAAI,EAIzC,OAHAC,EAAgB,MAAMF,CAAQ,EAC9BG,EAAY,KAAK,sBAAsB,EAEnCC,GAeJD,EAAY,KAAK,0EAA0E,EACpF,KAbLN,GAAmBQ,EAAoBL,CAAQ,EAAE,KAAKM,GAAM,CACvDA,GACD,QAAQ,KAAK,iDAAiD,EAC9DH,EAAY,QAAQ,wDAAwD,IAE5E,QAAQ,KAAK,2BAA2B,EACxCA,EAAY,KAAK,+DAA+D,EAEpF,CAAC,EACM,GAKX,EACA,MAAM,MAAM,CAEV,IAAMI,EAAaL,EAAgB,KAAK,EACxC,GAAGK,EACD,YAAK,KAAON,EAAeM,CAAU,EACrCC,GAAU,EACVL,EAAY,KAAK,0CAA0C,EACpD,GAKT,GAAG,CAACC,EAAiB,CACnB,IAAMK,EAAa,MAAMnB,GAAwBe,CAAkB,EACnE,GAAGI,GAAc,OAAOA,GAAe,SACrC,YAAK,KAAOR,EAAeQ,CAAU,EACrCP,EAAgB,MAAM,KAAK,IAAI,EAC/BM,GAAU,EACVL,EAAY,QAAQ,wCAAwC,EACrD,EAGX,CAEA,OAAAA,EAAY,MAAM,sBAAsB,EACxC,MAAM,0DAA0D,EACzD,EACT,EACA,QAAQ,CAAE,IAAMO,EAAK,IAAI,KAAK,CAAC,KAAK,UAAU,CAAC,UAAU,KAAK,KAAM,SAAS,KAAK,QAAQ,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,KAAK,kBAAkB,CAAC,EAASC,EAAI,IAAI,gBAAgBD,CAAI,EAAS,EAAE,SAAS,cAAc,GAAG,EAAG,EAAE,KAAKC,EAAK,EAAE,SAAS,kBAAkB,KAAK,KAAK,KAAK,MAAM,aAAa,YAAY,EAAE,QAAQ,cAAc,GAAG,CAAC,QAAS,EAAE,MAAM,EAAG,IAAI,gBAAgBA,CAAG,CAAG,CAC9W,EAEAC,EAAY,UAAU,IAAI,CA5/B5B,IAAAC,EA8/BI,GADAd,EAAM,SAAWa,EAAY,gBAAgB,GAC1CC,EAAAd,GAAA,YAAAA,EAAO,OAAP,MAAAc,EAAa,KAAK,CACnB,IAAMC,EAAcC,EAAe,eAAe,EAC/CD,GAAe,CAACf,EAAM,KAAK,KAAK,aACjCA,EAAM,KAAK,KAAK,WAAae,EAAY,KAE7C,CACF,CAAC,EAOH,SAASE,IAAkB,CA3gC3B,IAAAH,EAAAI,EAAAC,EA6gCE,IAAMC,IAAON,EAAAd,EAAM,OAAN,YAAAc,EAAY,OAAQ,CAAC,EAC5BO,IAAMH,EAAAlB,EAAM,OAAN,YAAAkB,EAAY,aAAc,CAAC,EACjCI,EAAeF,EAAK,MAAQA,EAAK,KAAK,KAAK,EAAE,OAAS,EAExDG,EAAmB,GACvB,GAAID,EAAc,CAChB,IAAME,EAAWC,EAAWL,EAAK,MAAQ,EAAE,EACrCM,EAAYD,EAAWL,EAAK,OAAS,UAAU,EAC/CO,EAAYP,EAAK,OAAS,IAC1BQ,EAASP,EAAI,KAAO,GACpBQ,EAAUD,IAAWT,GAAAW,EAAK,cAAgB,CAAC,GAAG,KAAKC,GAAKA,EAAE,MAAQH,CAAM,IAAnD,YAAAT,EAAsD,OAAQS,EAAU,aACnGL,EAAmB;AAAA,4CACqBC,CAAQ;AAAA,sCACdE,CAAS,iBAAYC,CAAS;AAAA,sCAC9BF,EAAWI,CAAO,CAAC;AAAA;AAAA,KAGvD,MACEN,EAAmB;AAAA;AAAA;AAAA;AAAA,MAQrB,IAAMS,EAAWhC,EAAM,UAAY,CAAC,EAChCiC,EAAgB,KACpB,QAAWC,KAAKF,EACd,GAAI1B,GAAsB6B,EAAiBD,EAAG5B,CAAkB,EAAG,CACjE2B,EAAgBC,EAChB,KACF,CAGF,IAAIE,EAAiB,GACrB,GAAIH,EAAe,CACjB,IAAMI,GAAUJ,EAAc,SAAW,CAAC,GAAG,OAC7CG,EAAiB;AAAA,4CACuBX,EAAWQ,EAAc,KAAK,CAAC;AAAA,sCACrCR,EAAWQ,EAAc,IAAI,CAAC,eAAUR,EAAWQ,EAAc,IAAM,KAAK,CAAC;AAAA,gDACnEI,CAAM,IAAIJ,EAAc,QAAQ;AAAA;AAAA,KAG9E,MACEG,EAAiB;AAAA;AAAA;AAAA;AAAA,MAOnB,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA,QAKDb,CAAgB;AAAA;AAAA;AAAA;AAAA,QAIhBa,CAAc;AAAA;AAAA;AAAA;AAAA,CAKtB,CAGA,SAASE,GAAiBC,EAAW,CACnCA,EAAU,iBAAiB,kBAAkB,EAAE,QAAQC,GAAO,CAC5DA,EAAI,QAAU,IAAM,CAClB,IAAMC,EAASD,EAAI,QAAQ,IAC3B,GAAI,CAACE,EAAO,OACZ,IAAMC,EAAMD,EAAM,UAAUR,GAAKA,EAAE,MAAQO,CAAM,EAC7CE,GAAO,GACTC,EAAaD,EAAK,EAAI,CAE1B,CACF,CAAC,CACH,CAEA,SAASE,IAAa,CACpB,IAAMC,EAAI9C,EAAM,KAAK,MAAQ,CAAC,EACxBqB,EAAMrB,EAAM,KAAK,YAAc,CAAC,EACtC,MAAO,GACJ8C,EAAE,MAAQA,EAAE,KAAK,KAAK,EAAE,QAAU,GAClCA,EAAE,OAASA,EAAE,MAAM,KAAK,GACxBA,EAAE,OAAS,OAAO,SAAS,CAACA,EAAE,KAAK,GACnCzB,EAAI,KAAOA,EAAI,IAAI,KAAK,EAE7B,CAIA,SAAS0B,GAAmBR,EAAWS,EAAK,CAAC,SAAS,EAAK,EAAE,CAC3D,GAAM,CAAC,SAAAC,EAAS,EAAK,EAAID,EACzBT,EAAU,UAAY,GACtB,IAAMW,EAASrC,EAAY,KAAK,YAAc,CAAC,EAE/Cb,EAAM,SACH,MAAM,EACN,KAAK,CAACmD,EAAEC,IAAID,EAAE,KAAK,cAAcC,EAAE,IAAI,CAAC,EACxC,QAAQlB,GAAG,CACV,IAAMG,GAAUH,EAAE,SAAS,CAAC,GAAG,OACzBmB,EAAOhB,GAAQH,EAAE,SAEjBoB,EAAkBhD,EAAqB6B,EAAiBD,EAAG5B,CAAkB,EAAI,GACjFiD,EAASlB,GACV,MAAM,QAAQH,EAAE,OAAO,EAAIA,EAAE,QAAU,CAAC,GAAG,IAAIsB,GAAQ,CACtD,IAAMJ,EAAII,GAAUA,EAAO,IAAMN,EAAOM,EAAO,GAAG,EAAI,KAClDC,EAAQ,GACZ,GAAGL,EAAE,CACH,IAAMM,EAAajC,EAAW2B,EAAE,OAAS,GAAG,EACtCO,EAAWlC,EAAW2B,EAAE,YAAc,GAAG,EAC/CK,EAAQ,+BAA0BC,CAAU,WAAMC,CAAQ,SAC5D,CACA,IAAMC,EAAQnC,EAAW+B,IAAWA,EAAO,WAAaA,EAAO,MAAQA,EAAO,YAAc,SAAS,EAIrG,MAAO,eAFiBK,EAAUL,GAAUA,EAAO,GAAG,IAAMlD,EACxB,uBAAyB,MAC9B,WAAWsD,CAAK,UAAUH,CAAK,QAChE,CAAC,EAAE,KAAK,EAAE,EACV,4CAGAK,EAAY,GAChB,GAAI,CAACb,EACH,GAAIK,EAEFQ,EAAY,0BAA0BC,GAAW7B,EAAE,EAAE,CAAC,mDACjD,CAEL,IAAM8B,EAAgB,CAACnB,GAAW,GAAKQ,EAAQ,WAAa,GAC5DS,EAAY,oBAAoBC,GAAW7B,EAAE,EAAE,CAAC,qBAAqB8B,CAAY,4BACnF,CAIF,IAAMC,EAAY/B,EAAE,MAAQ,8CAA8CT,EAAWS,EAAE,KAAK,CAAC,SAAW,GAClGgC,EAAYhC,EAAE,MAAQ,8CAA8CT,EAAWS,EAAE,KAAK,CAAC,SAAW,GAClGiC,EAAkBjC,EAAE,OAAS,qDAAkD,GAC/EkC,EAAkBd,EAAkB,qDAAkD,GAEtFe,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAYf,EAAkB,oBAAsB,OACzDe,EAAK,UAAY;AAAA;AAAA;AAAA,sBAGD5C,EAAWS,EAAE,KAAK,CAAC,aAAaiC,CAAe,IAAIC,CAAe;AAAA,iCACvD3C,EAAWS,EAAE,IAAI,CAAC,eAAUT,EAAWS,EAAE,IAAM,EAAE,CAAC,qBAAgBG,CAAM,IAAIH,EAAE,QAAQ;AAAA,cACzG+B,CAAS;AAAA,cACTC,CAAS;AAAA;AAAA,cAER,CAACjB,GAAY,CAACK,GAAmB,CAACT,GAAW,EAAK,kHAAoH,EAAE;AAAA,cACxK,CAACI,GAAY,CAACK,GAAmBD,EAAQ,wEAA0E,EAAE;AAAA;AAAA;AAAA,cAGtHS,CAAS;AAAA,gCACS5B,EAAE,EAAE;AAAA;AAAA;AAAA,mDAGeqB,CAAM;AAAA,QAEnDhB,EAAU,YAAY8B,CAAI,CAC5B,CAAC,CACL,CAEA,SAASC,GAAkBC,EAAK,CAC9B,IAAMC,EAAOD,EAAK,cAAc,cAAc,EACxCE,EAAWF,EAAK,cAAc,cAAc,EAC5CG,EAAcH,EAAK,cAAc,gBAAgB,EACjDI,EAAiBJ,EAAK,cAAc,mBAAmB,EACvDK,EAAeL,EAAK,cAAc,iBAAiB,EACnDM,EAAON,EAAK,cAAc,cAAc,EACxCO,EAAaP,EAAK,cAAc,kBAAkB,EAClDQ,EAASR,EAAK,cAAc,gBAAgB,EAClD,GAAG,CAACC,GAAQ,CAACC,GAAY,CAACI,EAAM,OAEhC,IAAIG,EAAc,EACZC,EAAeT,EAAK,cAAc,uBAAuB,EACzDU,EAAmB7E,EAEnB8E,EAAW,CAACC,EAASC,EAAK,YAAY,CAC1C,GAAIN,EACJ,IAAG,CAAE,OAAO,aAAaC,CAAW,CAAG,MAAM,CAAC,CAC9CD,EAAO,YAAcK,EACrBL,EAAO,QAAQ,KAAOM,EACtBN,EAAO,OAAS,GAChBC,EAAc,OAAO,WAAW,IAAI,CAAED,EAAO,OAAS,EAAM,EAAG,IAAI,EACrE,EAMA,GAJGA,IACDA,EAAO,OAAS,IAGfG,EAAiB,CAClB,CAACT,EAAUC,EAAaC,EAAgBC,CAAY,EAAE,QAASU,GAAU,CACpEA,IACDA,EAAQ,SAAW,GACnBA,EAAQ,aAAa,gBAAiB,MAAM,EAEhD,CAAC,EACEL,IACDA,EAAa,SAAW,GACxBA,EAAa,MAAQM,EACrBN,EAAa,YAAc,gCAE7B,IAAMO,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,UAAY,QACjBA,EAAK,YAAcD,EACnBf,EAAK,YAAYgB,CAAI,CACvB,CAEA,IAAMC,EAAeC,GAAM,CACzB,GAAG,CAED,OADa,IAAI,KAAKA,CAAG,EACb,eAAe,OAAW,CACpC,MAAM,QAAS,IAAI,UACnB,KAAK,UAAW,OAAO,SACzB,CAAC,CACH,MAAM,CACJ,OAAOA,CACT,CACF,EAEMC,EAAgBC,GAAWA,EAAQ,MAAM,EAAE,KAAK,CAACzC,EAAGC,IAAI,CAC5D,IAAMyC,EAAQ,IAAI,MAAK1C,GAAA,YAAAA,EAAG,YAAa,CAAC,EAAE,QAAQ,EAElD,OADc,IAAI,MAAKC,GAAA,YAAAA,EAAG,YAAa,CAAC,EAAE,QAAQ,EACnCyC,CACjB,CAAC,EAEKC,EAAoBC,GAAQ,CArvCpC,IAAAjF,EAAAI,GAAAC,GAAA6E,GAAAC,GAAAC,GAAAC,GAsvCI,GAAG,CAACJ,GAAS,OAAOA,GAAU,SAAU,OAAO,KAC/C,IAAMK,IAAUlF,IAAAJ,EAAAiF,EAAM,KAAN,KAAAjF,EAAYiF,EAAM,aAAlB,KAAA7E,GAAgC,IAAI,SAAS,EAAE,KAAK,EAC9DmF,IAAaL,IAAA7E,GAAA4E,EAAM,UAAN,KAAA5E,GAAiB4E,EAAM,OAAvB,KAAAC,GAA+B,IAAI,SAAS,EAAE,KAAK,EACtE,GAAG,CAACK,EACF,OAAO,KAET,IAAMC,EAAaC,GAAiBN,GAAAF,EAAM,aAAN,KAAAE,GAAoBF,EAAM,WAAW,EACnES,EAAgBD,GAAiBL,GAAAH,EAAM,gBAAN,KAAAG,GAAuBH,EAAM,cAAc,EAC5EU,EAAYF,GAAiBJ,GAAAJ,EAAM,YAAN,KAAAI,GAAmBJ,EAAM,UAAU,EAClEW,EAAYX,EAAM,WAAaA,EAAM,YAAcA,EAAM,MAC7D,GAAGW,EAAU,CACX,IAAMC,GAAQ,IAAI,KAAKD,CAAS,EAChCA,EAAY,OAAO,MAAMC,GAAM,QAAQ,CAAC,EAAI,IAAI,KAAK,EAAE,YAAY,EAAIA,GAAM,YAAY,CAC3F,MACED,EAAY,IAAI,KAAK,EAAE,YAAY,EAGrC,MAAO,CACL,GAFSN,GAAU,SAAS,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GAGhF,WAAAE,EACA,cAAAE,EACA,UAAAC,EACA,QAASJ,EACT,UAAAK,CACF,CACF,EAEME,EAAQ,CACZ,SAAU,CAAC,EACX,QAAS,EACX,EAEMC,EAAejB,GAAU,CAC7B,IAAMkB,EAAO,IAAI,IACXC,EAAU,CAAC,EACjB,OAACnB,GAAW,CAAC,GAAG,QAASoB,GAAQ,CAC/B,IAAMC,EAAaD,GAASA,EAAM,QAAUA,EAAQlB,EAAiBkB,CAAK,EACvE,CAACC,GAAc,CAACA,EAAW,SAG3BH,EAAK,IAAIG,EAAW,EAAE,IAGzBH,EAAK,IAAIG,EAAW,EAAE,EACtBF,EAAQ,KAAKE,CAAU,EACzB,CAAC,EACDL,EAAM,SAAWjB,EAAaoB,CAAO,EAC9BH,EAAM,QACf,EAEMM,EAAa,IAAI,CACrB,GAAGN,EAAM,QAAQ,CACf/B,EAAK,UAAY,sDACjB,MACF,CACA,GAAG,CAAC+B,EAAM,SAAS,OAAO,CACxB/B,EAAK,UAAY,0EACjB,MACF,CACAA,EAAK,UAAY,GACjB+B,EAAM,SAAS,QAASI,GAAQ,CAC9B,GAAG,CAACA,GAAS,CAACA,EAAM,QAAS,OAC7B,IAAMG,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,eACjBA,EAAK,QAAQ,QAAUH,EAAM,QAAU,OAAS,QAEhD,IAAMI,EAAO,SAAS,cAAc,GAAG,EAIvC,GAHAA,EAAK,YAAcJ,EAAM,QACzBG,EAAK,YAAYC,CAAI,EAElBJ,EAAM,YAAcA,EAAM,eAAiBA,EAAM,UAAU,CAC5D,IAAMK,EAAO,SAAS,cAAc,KAAK,EAEzC,GADAA,EAAK,UAAY,eACdL,EAAM,WAAW,CAClB,IAAMM,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,YAAc,WAAWN,EAAM,UAAU,GAC9CK,EAAK,YAAYC,CAAI,CACvB,CACA,GAAGN,EAAM,cAAc,CACrB,IAAMM,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,YAAc,cAAcN,EAAM,aAAa,GACpDK,EAAK,YAAYC,CAAI,CACvB,CACA,GAAGN,EAAM,UAAU,CACjB,IAAMM,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,YAAc,YAAYN,EAAM,SAAS,GAC9CK,EAAK,YAAYC,CAAI,CACvB,CACAH,EAAK,YAAYE,CAAI,CACvB,CAEA,IAAMV,EAAQ,SAAS,cAAc,MAAM,EAC3CA,EAAM,SAAWK,EAAM,UACvBL,EAAM,YAAclB,EAAYuB,EAAM,SAAS,EAC/CG,EAAK,YAAYR,CAAK,EAEtB,IAAMY,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,KAAO,SACdA,EAAO,UAAY,SAChBP,EAAM,SACPO,EAAO,YAAc,gBACrBA,EAAO,SAAW,IACXrC,GACPqC,EAAO,YAAc,SACrBA,EAAO,SAAW,GAClBA,EAAO,MAAQhC,IAEfgC,EAAO,YAAc,SACrBA,EAAO,iBAAiB,QAAS,IAAI,CAC9BC,EAAaR,CAAK,CACzB,CAAC,GAEHG,EAAK,YAAYI,CAAM,EAEvB1C,EAAK,YAAYsC,CAAI,CACvB,CAAC,CACH,EAEMM,EAAgB,MAAO,CAAE,OAAAC,EAAS,EAAM,EAAI,CAAC,IAAI,CACrDd,EAAM,QAAU,GAChBM,EAAW,EACX,GAAG,CACD,IAAMS,EAAU,MAAMC,EAAS,gBAAiB,CAAE,QAAQ,CAAE,OAAO,kBAAmB,CAAE,CAAC,EACnFC,EAAO,MAAM,QAAQF,GAAA,YAAAA,EAAS,QAAQ,EAAIA,EAAQ,SAAW,CAAC,EACpEd,EAAYgB,EAAK,IAAI/B,CAAgB,EAAE,OAAO,OAAO,CAAC,EAClD4B,GACFvC,EAAS,oBAAqB,MAAM,CAExC,OAAOtF,EAAI,CACT,MAAI6H,GACFvC,EAAStF,GAAOA,EAAI,QAAUA,EAAI,QAAU,2BAA4B,OAAO,EAE3EA,CACR,QAAC,CACC+G,EAAM,QAAU,GAChBM,EAAW,CACb,CACF,EAEMM,EAAe,MAAOR,GAAQ,CAClC,GAAG9B,EAAiB,CAClBC,EAASI,EAAkB,OAAO,EAClC,MACF,CAGA,GAFG,CAACyB,GAAS,CAACA,EAAM,IAEjB,EADS,OAAO,SAAY,WAAc,QAAQ,sBAAsB,EAAI,IACvE,OACR,IAAMc,EAAWlB,EAAM,SAAS,MAAM,EACtCC,EAAYiB,EAAS,OAAQX,GAAQA,EAAK,KAAOH,EAAM,EAAE,CAAC,EAC1DE,EAAW,EACX/B,EAAS,yBAAqB,MAAM,EACpC,GAAG,CACD,MAAMyC,EAAS,iBAAiB,mBAAmBZ,EAAM,EAAE,CAAC,GAAI,CAAE,OAAO,QAAS,CAAC,EACnF7B,EAAS,mBAAoB,MAAM,CACrC,OAAOtF,EAAI,CACTgH,EAAYiB,CAAQ,EACpBZ,EAAW,EACX/B,EAAStF,GAAOA,EAAI,QAAUA,EAAI,QAAU,4BAA6B,OAAO,CAClF,CACF,EAEA2E,EAAK,iBAAiB,SAAU,MAAOuD,GAAQ,CAE7C,GADAA,EAAM,eAAe,EAClB7C,EAAiB,CAClBC,EAASI,EAAkB,OAAO,EAClC,MACF,CACA,IAAMc,GAAa5B,EAAS,OAAS,IAAI,KAAK,EAC9C,GAAG,CAAC4B,EAAU,CACZlB,EAAS,4BAA6B,OAAO,EAC7C,MACF,CAEA,IAAMmB,EAAa5B,EAAc6B,EAAiB7B,EAAY,KAAK,EAAI,GACjE8B,EAAgB7B,EAAiB4B,EAAiB5B,EAAe,KAAK,EAAI,GAC1E8B,EAAY7B,EAAe2B,EAAiB3B,EAAa,KAAK,EAAI,GAElEkD,EAAWlB,EAAM,SAAS,MAAM,EAChCoB,EAAa,CACjB,GAAI,WAAW,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GACnE,WAAA1B,EACA,cAAAE,EACA,UAAAC,EACA,QAASJ,EACT,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,QAAS,EACX,EAEAQ,EAAY,CAACmB,EAAY,GAAGF,CAAQ,CAAC,EACrCZ,EAAW,EACX/B,EAAS,wBAAoB,MAAM,EAChCF,IACDA,EAAa,SAAW,IAG1B,GAAG,CACD,IAAMvF,EAAW,MAAMkI,EAAS,gBAAiB,CAC/C,OAAO,OACP,KAAM,KAAK,UAAU,CACnB,WAAAtB,EACA,cAAAE,EACA,UAAAC,EACA,QAASJ,CACX,CAAC,CACH,CAAC,EACK4B,EAAQnC,EAAiBpG,GAAYA,EAAS,OAAO,EAC3D,GAAG,CAACuI,EACF,MAAM,IAAI,MAAM,kCAAkC,EAEpDpB,EAAY,CAACoB,EAAO,GAAGH,CAAQ,CAAC,EAChCZ,EAAW,EACRzC,IAAWA,EAAS,MAAQ,IAC5BC,IAAcA,EAAY,MAAQ,IAClCC,IAAiBA,EAAe,MAAQ,IACxCC,IAAeA,EAAa,MAAQ,IACvCO,EAAS,kBAAmB,SAAS,CACvC,OAAOtF,EAAI,CACTgH,EAAYiB,CAAQ,EACpBZ,EAAW,EACRrH,GAAOA,EAAI,QACZsF,EAAStF,EAAI,QAAS,OAAO,EAE7BsF,EAAS,0BAA2B,OAAO,CAE/C,QAAC,CACIF,IACDA,EAAa,SAAW,GAE5B,CACF,CAAC,EAEEH,GACDA,EAAW,iBAAiB,QAAUiD,GAAQ,CAC5CA,EAAM,eAAe,EACrBN,EAAc,EAAE,MAAO5H,GAAM,CACxBA,GAAOA,EAAI,QACZsF,EAAStF,EAAI,QAAS,OAAO,EAE7BsF,EAAS,8BAA+B,OAAO,CAEnD,CAAC,CACH,CAAC,EAGH+B,EAAW,EACXO,EAAc,CAAE,OAAQ,EAAK,CAAC,EAAE,MAAO5H,GAAM,CACxCA,GAAOA,EAAI,QACZsF,EAAStF,EAAI,QAAS,OAAO,EAE7BsF,EAAS,2BAA4B,OAAO,CAEhD,CAAC,CACH,CAEA,eAAe+C,GAAkB3D,EAAK,SAAS,CAp/C/C,IAAAzD,EAq/CE,IAAMyB,GAAYzB,EAAAyD,GAAA,YAAAA,EAAM,gBAAN,YAAAzD,EAAA,KAAAyD,EAAsB,cACxC,GAAIhC,EAEJ,CAAAA,EAAU,UAAY,4CAEtB,GAAG,CACD,IAAM7C,EAAW,MAAM,MAAM,0BAA2B,CAAC,MAAM,UAAU,CAAC,EAC1E,GAAG,CAACA,EAAS,GAAI,MAAM,IAAI,MAAM,mBAAmBA,EAAS,MAAM,EAAE,EAErE,IAAMyI,EAAS,MAAMzI,EAAS,KAAK,EACnC,GAAG,CAAC,MAAM,QAAQyI,CAAM,GAAK,CAACA,EAAO,OAAO,CAC1C5F,EAAU,UAAY,qEACtB,MACF,CAEA,IAAM6F,EAAO,SAAS,uBAAuB,EAC7CD,EAAO,QAASE,GAAQ,CArgD5B,IAAAvH,EAsgDM,GAAG,CAACuH,GAAS,OAAOA,GAAU,SAAU,OACxC,IAAMhE,EAAO,SAAS,cAAc,SAAS,EAC7CA,EAAK,UAAY,aAEjB,IAAMiE,EAAQ,SAAS,cAAc,IAAI,EACzCA,EAAM,YAAcD,EAAM,OAAS,WAAUvH,EAAAuH,EAAM,KAAN,KAAAvH,EAAY,GAAG,GAC5DuD,EAAK,YAAYiE,CAAK,EAEtB,IAAMjB,EAAO,SAAS,cAAc,KAAK,EAGzC,GAFAA,EAAK,UAAY,aAEd,OAAOgB,EAAM,IAAO,YAAY,CACjC,IAAME,EAAS,SAAS,cAAc,MAAM,EAC5CA,EAAO,YAAc,MAAMF,EAAM,EAAE,GACnChB,EAAK,YAAYkB,CAAM,CACzB,CAEA,GAAGF,EAAM,OAAO,CACd,IAAMG,EAAa,SAAS,cAAc,MAAM,EAChDA,EAAW,YAAc,WAAWH,EAAM,MAAM,GAChDhB,EAAK,YAAYmB,CAAU,CAC7B,CAMA,GAJGnB,EAAK,WAAW,QACjBhD,EAAK,YAAYgD,CAAI,EAGpBgB,EAAM,MAAM,CACb,IAAMI,EAAQ,SAAS,cAAc,GAAG,EACxCA,EAAM,UAAY,cAClBA,EAAM,YAAcJ,EAAM,MAC1BhE,EAAK,YAAYoE,CAAK,CACxB,CAEAL,EAAK,YAAY/D,CAAI,CACvB,CAAC,EAED9B,EAAU,UAAY,GACtBA,EAAU,YAAY6F,CAAI,CAC5B,OAAOvI,EAAI,CACT,QAAQ,MAAM,qBAAsBA,CAAG,EACvC0C,EAAU,UAAY,6EACxB,EACF,CAEE,SAASmG,IAAe,CACtB,OAAO7H,EAAY,KAAK,YAAc,CAAC,CACzC,CA2BF,IAAM8H,EAAQ,CACZ,CAAC,IAAI,QAAa,MAAM,UAAoB,KAAK,oBAAoB,EACrE,CAAC,IAAI,UAAa,MAAM,oBAAoB,KAAK,wBAAwB,EACzE,CAAC,IAAI,OAAa,MAAM,iBAAoB,KAAK,gBAAgB,EACjE,CAAC,IAAI,UAAa,MAAM,mBAAoB,KAAK,mBAAmB,CACtE,EAIMC,GAAc,EAElB,SAASC,IAAiB,CACxB,IAAMC,EAAM,SAAS,eAAe,SAAS,EAC7C,GAAG,CAACA,EAAK,OACT,IAAMC,EAASD,EAAI,cAAc,8BAA8B,EAC5DC,GACDA,EAAO,MAAM,CAEjB,CAEA,SAASC,EAAaC,EAAKC,EAAW,GAAM,CACvC,OAAO,MAAMD,CAAG,GAAKA,EAAM,GAAKA,GAAON,EAAM,SAGhDC,GAAcK,EACdE,GAAa,EACbC,GAAU,EACPF,GACDL,GAAgB,EAEpB,CAEA,SAASQ,GAAkBC,EAAM,CAC/B,IAAMC,EAASD,EAAM,OACrB,GAAG,CAACC,GAAUA,EAAO,aAAa,MAAM,IAAM,MAAQ,OACtD,IAAMC,EAAMF,EAAM,IACZG,EAAe,OAAOF,EAAO,QAAQ,OAAS,GAAG,EACnDG,EAAY,KACbF,IAAQ,cAAgBA,IAAQ,YACjCE,GAAaD,EAAe,GAAKd,EAAM,OAC/Ba,IAAQ,aAAeA,IAAQ,UACvCE,GAAaD,EAAe,EAAId,EAAM,QAAUA,EAAM,OAC9Ca,IAAQ,OAChBE,EAAY,EACJF,IAAQ,QAChBE,EAAYf,EAAM,OAAS,GAE1Be,IAAc,OACfJ,EAAM,eAAe,EACrBN,EAAaU,EAAW,EAAI,EAEhC,CAEA,SAASN,IAAW,CAClB,IAAMN,EAAM,SAAS,eAAe,SAAS,EAC7C,GAAG,CAACA,EAAK,OAET,IAAMa,EAAiBb,EAAI,WAC3BA,EAAI,UAAY,GAChBA,EAAI,aAAa,OAAQ,SAAS,EAClCA,EAAI,aAAa,aAAc,yBAAyB,EAExD,IAAMc,EAAY,SAAS,uBAAuB,EA8BlD,GA7BAjB,EAAM,QAAQ,CAACkB,EAAGZ,IAAM,CACtB,IAAMa,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,KAAO,SACdA,EAAO,GAAK,YAAYD,EAAE,GAAG,GAC7BC,EAAO,UAAY,YACnBA,EAAO,QAAQ,KAAOD,EAAE,IACxBC,EAAO,QAAQ,MAAQ,OAAOb,CAAG,EACjCa,EAAO,aAAa,OAAQ,KAAK,EACjCA,EAAO,aAAa,gBAAiB,SAASD,EAAE,GAAG,EAAE,EACrD,IAAME,EAAWd,IAAQL,GACzBkB,EAAO,aAAa,gBAAiBC,EAAW,OAAS,OAAO,EAChED,EAAO,aAAa,WAAYC,EAAW,IAAM,IAAI,EACrD,IAAMC,EAAOH,EAAE,KAAO,UAAUI,EAAWJ,EAAE,IAAI,CAAC,WAAa,GAC/DC,EAAO,UAAY;AAAA,oCACWb,EAAM,CAAC;AAAA,yCACFgB,EAAWJ,EAAE,KAAK,CAAC,UAAUG,CAAI;AAAA,QAEpEF,EAAO,iBAAiB,QAAS,IAAI,CACnCd,EAAaC,EAAK,EAAI,CACxB,CAAC,EACDW,EAAU,YAAYE,CAAM,CAC9B,CAAC,EACDhB,EAAI,YAAYc,CAAS,EAErBd,EAAI,QAAQ,YACdA,EAAI,iBAAiB,UAAWO,EAAiB,EACjDP,EAAI,QAAQ,UAAY,QAGvBA,EAAI,YAAcA,EAAI,YAAc,EAAE,CACvC,IAAMC,EAASD,EAAI,cAAc,8BAA8B,EAC/D,GAAGC,EACD,GAAG,CACDA,EAAO,eAAe,CAAC,MAAM,UAAW,OAAO,QAAQ,CAAC,CAC1D,MAAM,CAEN,CAEJ,MACED,EAAI,WAAaa,EAGnB,IAAMO,EAAM,SAAS,eAAe,UAAU,EACxCC,EAAKC,GAAe,EAC1BF,EAAM,YAAcC,EAAK,OAAQ,gBAAMA,EAAK,MAAM,gBAAgBA,EAAK,OAAO,EAAE,IAAI,EAAE,GAAK,kBAC7F,CAEA,SAAShB,IAAc,CACrB,IAAMkB,EAAK,SAAS,eAAe,QAAQ,EAC3C,GAAG,CAACA,EAAI,OACRA,EAAG,UAAU,GACb,IAAMC,EAAO3B,EAAMC,EAAW,EAAE,IAC5B2B,EAAU,KACXD,IAAO,YAAWC,EAAUC,GAAa,GACzCF,IAAO,YAAWC,EAAUE,GAAa,GACzCH,IAAO,UAASC,EAAUG,GAAW,GACrCJ,IAAO,SAAQC,EAAUI,GAAU,GACnCJ,IACDA,EAAQ,GAAK,SAASD,CAAI,GAC1BC,EAAQ,aAAa,OAAO,UAAU,EACtCA,EAAQ,aAAa,kBAAmB,YAAYD,CAAI,EAAE,EAC1DC,EAAQ,aAAa,WAAW,GAAG,EACnCF,EAAG,YAAYE,CAAO,EAG1B,CAKF,SAASG,IAAY,CACnB,IAAME,EAAI,SAAS,cAAc,KAAK,EACtCA,EAAE,UAAY,QAGd,IAAMC,EAAgBC,GAAgB,EAEtC,OAAAF,EAAE,UAAYC,EAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAsM9BE,GAAkBH,CAAC,EACnBI,GAAkBJ,CAAC,EACnBK,GAAiBL,CAAC,EACXA,CACT,CAME,SAASJ,IAAc,CACrB,IAAMI,EAAI,SAAS,cAAc,KAAK,EACtCA,EAAE,UAAY,QACdA,EAAE,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+EA+EmDM,EAAK,KAAK,IAAIC,GAAG,kBAAkBA,EAAE,GAAG,KAAKA,EAAE,IAAI,WAAW,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA2CzI,SAASC,EAAUC,EAASC,EAAI,CAC9B,IAAM/B,EAASqB,EAAE,cAAc,oBAAoBS,CAAO,IAAI,EAC3D9B,IACDA,EAAO,YAAc+B,EAEzB,CAGA,IAAMC,EAAWX,EAAE,cAAc,aAAa,EAC9CM,EAAK,OAAO,QAAQ,GAAG,CAAE,IAAMM,EAAE,SAAS,cAAc,QAAQ,EAAGA,EAAE,MAAM,EAAGA,EAAE,YAAY,EAAGD,EAAS,YAAYC,CAAC,CAAG,CAAC,EAEzH,IAAMC,EAAMb,EAAE,cAAc,cAAc,EAC1C,SAASc,GAAmB,CAC1BD,EAAI,UAAU,GACd,IAAME,EAAIf,EAAE,cAAc,iBAAiB,EAAE,MACvCgB,EAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,KAAK,EACtD,GAAGD,IAAI,WAAW,CAChB,IAAME,EAAMX,EAAK,cAAc,SAAS,MAAM,EAC9CU,EAAU,QAASE,GAAK,CACtB,IAAMC,EAAE,SAAS,cAAc,KAAK,EAAGA,EAAE,UAAU,OACnDA,EAAE,UAAU,UAAUD,CAAE,4BAA4BA,CAAE,KAAKD,EAAI,IAAIG,GAAG,kBAAkBA,CAAC,KAAKA,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC,YACpHP,EAAI,YAAYM,CAAC,CACnB,CAAC,CACH,MACEH,EAAU,QAAQE,GAAI,CACpB,IAAMC,EAAE,SAAS,cAAc,KAAK,EAAGA,EAAE,UAAU,OACnDA,EAAE,UAAU,UAAUD,CAAE,qEAAqEA,CAAE,OAC/FL,EAAI,YAAYM,CAAC,CACnB,CAAC,CAEL,CACAnB,EAAE,cAAc,iBAAiB,EAAE,iBAAiB,SAAUc,CAAiB,EAC/EA,EAAkB,EAElB,IAAM7B,EAAIoC,EAAM,KAAK,KACrBrB,EAAE,cAAc,cAAc,EAAE,MAAQf,EAAE,YAAc,GACxDe,EAAE,cAAc,YAAY,EAAE,MAAQf,EAAE,KACxCe,EAAE,cAAc,YAAY,EAAE,MAAQf,EAAE,KACxCe,EAAE,cAAc,aAAa,EAAE,MAAQf,EAAE,MACzCe,EAAE,cAAc,kBAAkB,EAAE,MAAQf,EAAE,WAC9Ce,EAAE,cAAc,aAAa,EAAE,MAAQf,EAAE,MACzCe,EAAE,cAAc,iBAAiB,EAAE,MAAQf,EAAE,cAC7Ce,EAAE,cAAc,YAAY,EAAE,MAAQf,EAAE,UACxC6B,EAAkB,EAClB,IAAME,EAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,KAAK,EACtDA,EAAU,QAAQE,GAAI,CAtlE1B,IAAAI,EAAAC,EAulEM,IAAM9B,EAAKoB,EAAI,cAAc,aAAaK,CAAE,IAAI,EAC7CzB,IAAKA,EAAG,OAAQ8B,GAAAD,EAAArC,EAAE,YAAF,YAAAqC,EAAcJ,KAAd,KAAAK,EAAqB9B,EAAG,MAC7C,CAAC,EAEDO,EAAE,cAAc,YAAY,EAAE,QAAU,IAAI,CAC1C,IAAMwB,EAAQ,CAAC,EACfR,EAAU,QAAQE,GAAI,CACpB,IAAMzB,EAAKoB,EAAI,cAAc,aAAaK,CAAE,IAAI,EAChDM,EAAMN,CAAE,EAAI,SAASzB,EAAG,MAAM,EAAE,CAClC,CAAC,EACD4B,EAAM,KAAK,KAAO,CAChB,WAAYrB,EAAE,cAAc,cAAc,EAAE,MAAM,KAAK,EACvD,KAAMA,EAAE,cAAc,YAAY,EAAE,MAAM,KAAK,EAC/C,KAAMA,EAAE,cAAc,YAAY,EAAE,MAAM,KAAK,EAC/C,MAAOA,EAAE,cAAc,aAAa,EAAE,MAAM,KAAK,EACjD,WAAYA,EAAE,cAAc,kBAAkB,EAAE,MAAM,KAAK,EAC3D,MAAO,SAASA,EAAE,cAAc,aAAa,EAAE,MAAM,EAAE,EACvD,cAAeA,EAAE,cAAc,iBAAiB,EAAE,MAClD,UAAWwB,EACX,UAAWxB,EAAE,cAAc,YAAY,EAAE,KAC3C,EACAQ,EAAU,OAAO,qBAAqB,EAEtCa,EAAM,KAAK,EAAE,MAAMI,GAAO,QAAQ,MAAM,+BAAgCA,CAAG,CAAC,CAC9E,EAGA,IAAMC,EAAI1B,EAAE,cAAc,MAAM,EAC1B2B,EAAc3B,EAAE,cAAc,gBAAgB,EAEpD,SAAS4B,GAAoB,CAC3BD,EAAY,UAAY,GACxBrB,EAAK,aAAa,QAAQuB,GAAG,CAC3B,IAAMC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,eACjBA,EAAK,aAAa,OAAQ,OAAO,EACjCA,EAAK,aAAa,WAAY,GAAG,EACjCA,EAAK,aAAa,eAAgBJ,EAAI,QAAUG,EAAE,IAAM,OAAS,OAAO,EACxEC,EAAK,aAAa,gBAAiBJ,EAAI,QAAUG,EAAE,IAAM,OAAS,OAAO,EACzEC,EAAK,aAAa,WAAYD,EAAE,GAAG,EACnCC,EAAK,UAAY;AAAA,2CACkBzC,EAAWwC,EAAE,IAAI,CAAC;AAAA,6CAChBxC,EAAWwC,EAAE,SAAWA,EAAE,KAAK,CAAC;AAAA,gDAC7BxC,EAAWwC,EAAE,OAAO,CAAC;AAAA,UAE7DC,EAAK,iBAAiB,QAAS,IAAKC,EAAcF,EAAE,GAAG,CAAC,EACxDC,EAAK,iBAAiB,UAAYE,GAAI,EACjCA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,OAChCA,EAAE,eAAe,EACjBD,EAAcF,EAAE,GAAG,EAEvB,CAAC,EACDF,EAAY,YAAYG,CAAI,CAC9B,CAAC,CACH,CAEA,SAASC,EAAcnD,EAAI,CACzB8C,EAAI,MAAQ9C,EAEZ+C,EAAY,iBAAiB,eAAe,EAAE,QAAQG,GAAM,CAC1D,IAAMG,EAAaH,EAAK,aAAa,UAAU,IAAMlD,EACrDkD,EAAK,aAAa,eAAgBG,EAAa,OAAS,OAAO,EAC/DH,EAAK,aAAa,gBAAiBG,EAAa,OAAS,OAAO,CAClE,CAAC,EACDC,EAAS,CACX,CAEA,SAASA,GAAU,CACjB,IAAMtD,EAAM8C,EAAI,MAAaS,EAAInC,EAAE,cAAc,WAAW,EAC5D,GAAG,CAACpB,EAAI,CAAEuD,EAAI,UAAU,4EAA6E,MAAQ,CAC7G,IAAMN,EAAIvB,EAAK,aAAa,KAAK8B,GAAGA,EAAE,MAAMxD,CAAG,EACzCyD,EAAY,OAAO,QAAQR,EAAE,MAAM,EAAE,IAAI,CAAC,CAACS,EAAIC,CAAI,IAAI,WAAWD,CAAG,YAAYC,EAAK,KAAK,IAAI,CAAC,YAAY,EAAE,KAAK,EAAE,EAC3HJ,EAAI,UAAY;AAAA;AAAA;AAAA,kDAG4BN,EAAE,KAAK;AAAA,yEACgBA,EAAE,KAAK;AAAA,2EACLA,EAAE,OAAO;AAAA,6EACPA,EAAE,SAAS;AAAA;AAAA;AAAA;AAAA,+FAIOQ,CAAS;AAAA;AAAA;AAAA,6EAG3B/B,EAAK,MAAM,mBAAmB,IAAI,WAAMA,EAAK,MAAM,mBAAmB,IAAI;AAAA,OAEnJ,CAGAoB,EAAI,MAAQL,EAAM,KAAK,WAAW,KAAO,GACzCrB,EAAE,cAAc,gBAAgB,EAAE,MAAQqB,EAAM,KAAK,WAAW,cAAgB,MAChFO,EAAmB,EACnBM,EAAS,EAETlC,EAAE,cAAc,kBAAkB,EAAE,QAAU,IAAI,CAEhD,GADAqB,EAAM,KAAK,WAAW,CAAE,IAAKK,EAAI,MAAO,aAAc1B,EAAE,cAAc,gBAAgB,EAAE,KAAM,EAC3F,CAACqB,EAAM,KAAK,WAAW,IAAI,CAAE,MAAM,6BAA6B,EAAG,MAAQ,CAC1EA,EAAM,KAAK,MAAM,KAAKmB,GAAGA,EAAE,OAAO,qBAAqB,EAGzDnB,EAAM,KAAK,MAAQA,EAAM,KAAK,MAAM,IAAImB,GAAIA,EAAE,OAAO,sBAAuB,CAAC,GAAGA,EAAG,QAASnB,EAAM,KAAK,WAAW,YAAa,EAAGmB,CAAC,EAFnInB,EAAM,KAAK,MAAM,KAAK,CAAC,KAAK,sBAAuB,QAASA,EAAM,KAAK,WAAW,YAAa,CAAC,EAIlGb,EAAU,aAAa,mBAAmB,EAE1Ca,EAAM,KAAK,EAAE,MAAMI,GAAO,QAAQ,MAAM,kDAAmDA,CAAG,CAAC,CACjG,EAGA,IAAMgB,EAAWzC,EAAE,cAAc,WAAW,EAC5C,SAAS0C,GAAW,CAClBD,EAAS,UAAU,GACnBnC,EAAK,iBAAiB,QAAQqC,GAAG,CAC/B,IAAMC,EAAG,QAAQD,EAAE,GAAG,GAChBxB,EAAE,SAAS,cAAc,OAAO,EAAGA,EAAE,UAAU,OAAQA,EAAE,MAAM,OAAO,UAC5EA,EAAE,UAAU,gDAAgDyB,CAAE,eAAeD,EAAE,GAAG,qBAAqBA,EAAE,IAAI,iDAAiDA,EAAE,OAAO,KAAK,KAAK,CAAC,qBAClLF,EAAS,YAAYtB,CAAC,CACxB,CAAC,CACH,CACAuB,EAAU,EAEV,IAAMG,EAAS7C,EAAE,cAAc,MAAM,EACrC6C,EAAO,MAAQxB,EAAM,KAAK,OAAO,KAAO,IACvCA,EAAM,KAAK,OAAO,OAAO,CAAC,GAAG,QAAQyB,GAAG,CAAE,IAAMrD,EAAKgD,EAAS,cAAc,cAAcK,CAAC,IAAI,EAAMrD,IAAIA,EAAG,QAAQ,GAAM,CAAC,EAE5H,SAASsD,GAAY,CACnB,IAAMC,EAASH,EAAO,OAAS,KACzBI,EAAc,CAAC,GAAGR,EAAS,iBAAiB,gCAAgC,CAAC,EAAE,IAAIL,GAAGA,EAAE,QAAQ,GAAG,EACnGc,EAAWF,EAAO,EAAE,EAC1B,GAAGC,EAAY,OAAOC,EAAS,CAC7B,IAAMC,EAAOF,EAAY,IAAI,EAC7BR,EAAS,cAAc,cAAcU,CAAI,IAAI,EAAE,QAAQ,EACzD,CACA,IAAMC,EAAM9C,EAAK,KAAK,KAAKC,GAAGA,EAAE,MAAMyC,CAAM,EACtCK,EAAQ/C,EAAK,iBAAiB,OAAOqC,GAAGM,EAAY,SAASN,EAAE,GAAG,CAAC,EACnEW,EAAM,CAAC,EACb,OAAGF,GAAKE,EAAM,KAAK,0BAA0BF,EAAI,IAAI,eAAUA,EAAI,OAAO,KAAK,KAAK,CAAC,SAAS,EAC9FC,EAAM,QAAQV,GAAGW,EAAM,KAAK,2BAA2BX,EAAE,IAAI,eAAUA,EAAE,OAAO,KAAK,KAAK,CAAC,SAAS,CAAC,EACrG3C,EAAE,cAAc,gBAAgB,EAAE,UAAYsD,EAAM,OAAQA,EAAM,KAAK,GAAG,EAAG,kFACtE,CAAE,IAAKN,EAAQ,MAAOC,CAAY,CAC3C,CAEAJ,EAAO,iBAAiB,SAAUE,CAAU,EAC5CN,EAAS,iBAAiB,SAAUM,CAAU,EAC9CA,EAAW,EAEX/C,EAAE,cAAc,cAAc,EAAE,QAAU,IAAI,CAC5C,GAAM,CAAC,IAAAoD,EAAK,MAAAC,CAAK,EAAIN,EAAW,EAChC1B,EAAM,KAAK,OAAO,IAAM+B,EACxB/B,EAAM,KAAK,OAAO,MAAQgC,EAC1B7C,EAAU,SAAS,iBAAiB,EAEpCa,EAAM,KAAK,EAAE,MAAMI,GAAO,QAAQ,MAAM,8CAA+CA,CAAG,CAAC,CAC7F,EAGA,IAAM8B,EAAe,CACnB,CAAC,EAAE,WAAY,KAAK,oEAAoE,EACxF,CAAC,EAAE,WAAY,KAAK,qEAAqE,EACzF,CAAC,EAAE,WAAY,KAAK,kEAAkE,EACtF,CAAC,EAAE,cAAe,KAAK,8DAA8D,EACrF,CAAC,EAAE,cAAe,KAAK,kEAAwD,CACjF,EACMC,EAAWxD,EAAE,cAAc,aAAa,EAC9C,OAAAuD,EAAa,QAAQE,GAAG,CACtB,IAAMC,EAAE,SAAS,cAAc,QAAQ,EAAGA,EAAE,UAAU,OAAQA,EAAE,KAAK,SACrEA,EAAE,UAAY,SAASD,EAAE,CAAC,mCAA8BA,EAAE,IAAI,UAC9DC,EAAE,QAAQ,IAAI,CAAErC,EAAM,KAAK,YAAY,OAASoC,EAAE,KAAM,MAAM,KAAKD,EAAW,QAAQ,EAAE,QAAQpB,GAAGA,EAAE,UAAU,OAAO,SAAS,CAAC,EAAGsB,EAAE,UAAU,IAAI,SAAS,CAAG,EAC/JF,EAAW,YAAYE,CAAC,EACrBrC,EAAM,KAAK,YAAY,SAASoC,EAAE,MAAMC,EAAE,UAAU,IAAI,SAAS,CACtE,CAAC,EAED1D,EAAE,cAAc,SAAS,EAAE,MAAQqB,EAAM,KAAK,YAAY,QAAQ,GAClErB,EAAE,cAAc,QAAQ,EAAE,MAAQqB,EAAM,KAAK,YAAY,OAAO,GAChErB,EAAE,cAAc,OAAO,EAAE,MAAQqB,EAAM,KAAK,YAAY,MAAM,GAC9DrB,EAAE,cAAc,OAAO,EAAE,MAAQqB,EAAM,KAAK,YAAY,MAAM,GAE9DrB,EAAE,cAAc,mBAAmB,EAAE,QAAQ,IAAI,CAC/CqB,EAAM,KAAK,YAAY,CACrB,OAAQrB,EAAE,cAAc,SAAS,EAAE,MAAM,KAAK,EAC9C,MAAOA,EAAE,cAAc,QAAQ,EAAE,MAAM,KAAK,EAC5C,KAAMA,EAAE,cAAc,OAAO,EAAE,MAAM,KAAK,EAC1C,KAAMA,EAAE,cAAc,OAAO,EAAE,MAAM,KAAK,EAC1C,OAAQqB,EAAM,KAAK,YAAY,QAAQ,EACzC,EACAb,EAAU,cAAc,oBAAoB,EAE5Ca,EAAM,KAAK,EAAE,MAAMI,GAAO,QAAQ,MAAM,mDAAoDA,CAAG,CAAC,CAClG,EAEAzB,EAAE,cAAc,eAAe,EAAE,QAAU,IAAI,CAAE5B,EAAaL,EAAM,UAAUkB,GAAGA,EAAE,MAAM,OAAO,CAAC,CAAG,EACpGe,EAAE,cAAc,eAAe,EAAE,QAAU,IAAI,CAAE5B,EAAaL,EAAM,UAAUkB,GAAGA,EAAE,MAAM,MAAM,CAAC,CAAG,EAE5Fe,CACT,CACE,SAASD,IAAW,CACtB,IAAMC,EAAE,SAAS,cAAc,KAAK,EAAGA,EAAE,UAAU,QACnDA,EAAE,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,MAKV2D,EAAmB,qIAAuI,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQhK,IAAMC,EAAO5D,EAAE,cAAc,YAAY,EACzC,OAAA6D,GAAmBD,EAAM,CAAC,SAAUD,CAAgB,CAAC,EAGrDC,EAAK,iBAAiB,QAAUE,GAAK,CA7yEvC,IAAAxC,EA8yEI,IAAMyC,EAASD,EAAG,OAAO,QAAQ,yBAAyB,EAC1D,GAAGC,EAAO,CACR,GAAGJ,EAAiB,CAClB,MAAMK,CAAgB,EACtB,MACF,CACA,IAAMpB,EAAKmB,EAAO,aAAa,SAAS,EAClC9E,GAAKoC,EAAM,UAAU,CAAC,GAAG,KAAKe,GAAGA,EAAE,KAAKQ,CAAE,EAC1CqB,GAAQ5C,EAAM,KAAK,KAAK,MAAM,IAAI,KAAK,EAC7C,GAAG,CAAC4C,EAAK,CAAE,MAAM,uCAAuC,EAAG,MAAQ,CACnE,GAAIC,GAAY,OAAO,SAASD,CAAI,EAAG,CAAE,MAAM,GAAGA,CAAI,4BAA4B,EAAG,MAAQ,CAC7F,IAAKC,GAAY,aAAaD,CAAI,GAAG,CAAC,GAAG,SAAShF,EAAE,IAAI,EAAG,CAAE,MAAM,GAAGgF,CAAI,wBAAwBhF,EAAE,IAAI,GAAG,EAAG,MAAQ,CACtH,IAAMkF,EAAU,MAAM,QAAQlF,EAAE,OAAO,EAAIA,EAAE,QAAU,CAAC,EACxD,GAAGkF,EAAQ,KAAKC,GAAUC,EAAaD,GAAUA,EAAO,SAAS,IAAMC,EAAaJ,CAAI,CAAC,EAAE,CACzF,MAAM,4CAA4C,EAClD,MACF,CACA,GAAGE,EAAQ,KAAKC,GAAUE,EAAUF,GAAUA,EAAO,GAAG,IAAMG,CAAkB,EAAE,CAChF,MAAM,sDAAsD,EAC5D,MACF,CACA,GAAGJ,EAAQ,QAAQlF,EAAE,SAAS,CAAE,MAAM,uBAAuB,EAAG,MAAQ,CAExE,IAAMuF,IAAWlD,EAAAhB,EAAK,aAAa,KAAKuB,GAAGA,EAAE,MAAMR,EAAM,KAAK,WAAW,GAAG,IAA3D,YAAAC,EAA8D,OAAO,GAChFmD,EAASC,GAAc,EAC7B,GAAGF,EACD,QAAUJ,KAAUD,EAAQ,CAC1B,IAAMT,EAAIU,GAAUA,EAAO,IAAMK,EAAOL,EAAO,GAAG,EAAI,KACtD,GAAGV,GAAKA,EAAE,aAAec,EAAQ,CAC/B,MAAM,WAAWA,CAAO,6EAA6E,EACrG,MACF,CACF,CAEF,IAAMG,EAAQtD,EAAM,KAAK,KAAK,OAAS,GACjCuD,EAAcC,EAAe,eAAe,EAClDC,EAAQ,YAAYlC,EAAI,CACtB,KAAAqB,EACA,cAAeA,EACf,UAAWM,EACX,WAAYK,GAAA,YAAAA,EAAa,KACzB,MAAM,CAAE,MAAOD,EAAO,WAAYH,CAAQ,CAC5C,CAAC,EACE,KAAK,IAAI,CACRX,GAAmBD,EAAM,CAAC,SAAUD,CAAgB,CAAC,EACrD,MAAM,SAASM,CAAI,OAAOhF,EAAE,KAAK,GAAG,CACtC,CAAC,EACA,MAAOwC,GAAM,CACZ,MAAM,kBAAkBxC,EAAE,KAAK,KAAKwC,GAAOA,EAAI,QAAUA,EAAI,QAAU,iBAAiB,EAAE,CAC5F,CAAC,EACH,MACF,CAEA,IAAMsD,EAAWjB,EAAG,OAAO,QAAQ,uBAAuB,EAC1D,GAAGiB,EAAS,CACV,GAAGpB,EAAiB,CAClB,MAAMK,CAAgB,EACtB,MACF,CACA,IAAMpB,EAAKmC,EAAS,aAAa,eAAe,EAC1C9F,GAAKoC,EAAM,UAAU,CAAC,GAAG,KAAKe,GAAGA,EAAE,KAAKQ,CAAE,EAChD,GAAG,CAAC3D,EAAE,CACJ,MAAM,oBAAoB,EAC1B,MACF,CACA,GAAG,CAAC,QAAQ,SAASA,EAAE,KAAK,0CAA0C,EACpE,OAEF6F,EAAQ,aAAalC,EAAI,CACvB,UAAW2B,CACb,CAAC,EACE,KAAK,IAAI,CACRV,GAAmBD,EAAM,CAAC,SAAUD,CAAgB,CAAC,EACrD,MAAM,iBAAiB1E,EAAE,KAAK,GAAG,CACnC,CAAC,EACA,MAAOwC,GAAM,CACZ,MAAM,mBAAmBxC,EAAE,KAAK,KAAKwC,GAAOA,EAAI,QAAUA,EAAI,QAAU,iBAAiB,EAAE,CAC7F,CAAC,EACH,MACF,CACA,IAAMuD,EAASlB,EAAG,OAAO,QAAQ,kBAAkB,EACnD,GAAGkB,EAAO,CACR,IAAMpC,EAAKoC,EAAO,aAAa,UAAU,EACnC/F,EAAIoC,EAAM,SAAS,KAAKe,GAAGA,EAAE,KAAKQ,CAAE,EAC1CqC,GAAYhG,CAAC,CACf,CACF,CAAC,EAEDe,EAAE,cAAc,YAAY,EAAE,QAAU,IAAI,CAAE5B,EAAaL,EAAM,UAAUkB,GAAGA,EAAE,MAAM,SAAS,CAAC,CAAG,EACnGe,EAAE,cAAc,aAAa,EAAE,QAAS,IAAI,CAAE5B,EAAaL,EAAM,UAAUkB,GAAGA,EAAE,MAAM,SAAS,CAAC,CAAG,EAC5Fe,CACT,CAGE,SAASH,IAAc,CA54EzB,IAAAyB,EA64EI,IAAMtB,EAAE,SAAS,cAAc,KAAK,EAAGA,EAAE,UAAU,QACnD,IAAMf,EAAEoC,EAAM,KACR6D,EAAM5E,EAAK,aAAa,KAAK,GAAG,EAAE,MAAMrB,EAAE,WAAW,GAAG,EACxDkG,EAAc,OAAO,QAAQlG,EAAE,KAAK,WAAW,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC6D,EAAE1B,CAAC,IAAI,qBAAqB0B,CAAC,KAAK1B,CAAC,SAAS,EAAE,KAAK,GAAG,EAC/GiC,GAASpE,EAAE,OAAO,OAAO,CAAC,GAAG,IAAI6D,GAAC,CAj5E5C,IAAAxB,EAi5E+C,OAAAA,EAAAhB,EAAK,iBAAiB,KAAKqC,GAAGA,EAAE,MAAMG,CAAC,IAAvC,YAAAxB,EAA0C,KAAI,EAAE,OAAO,OAAO,EACnG8D,IAAU9D,EAAAhB,EAAK,KAAK,KAAKC,GAAGA,EAAE,MAAMtB,EAAE,OAAO,GAAG,IAAtC,YAAAqC,EAAyC,OAAQ,SAEjEtB,EAAE,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,yBAKOf,EAAE,KAAK,MAAM,SAAS;AAAA,uCACRA,EAAE,KAAK,YAAc,QAAG;AAAA,+BAChCA,EAAE,KAAK,MAAM,OAAO,WAAMA,EAAE,KAAK,OAAO,QAAQ,iBAAYA,EAAE,KAAK,OAAO,CAAC;AAAA,wCAClEkG,CAAW;AAAA,kEACelG,EAAE,KAAK,YAAY,QAAG,sBAAiBA,EAAE,KAAK,YAAY,OAAO,QAAQ,WAAW;AAAA;AAAA;AAAA;AAAA,yBAI7HiG,EAAIA,EAAI,KAAK,QAAG,kCAAkCA,EAAIA,EAAI,QAAQ,QAAG;AAAA,kEAC5BjG,EAAE,WAAW,cAAc,KAAK;AAAA;AAAA;AAAA;AAAA,8BAIpEmG,CAAO;AAAA,wBACb/B,EAAM,OAAQA,EAAM,KAAK,IAAI,EAAG,QAAG;AAAA;AAAA;AAAA;AAAA,iBAI1CpE,EAAE,YAAY,QAAQ,EAAE;AAAA,sCACHA,EAAE,YAAY,OAAO,EAAE;AAAA,kDACXA,EAAE,YAAY,MAAM,EAAE;AAAA,qCACnCA,EAAE,YAAY,MAAM,EAAE;AAAA,8DACGA,EAAE,YAAY,QAAQ,QAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAanFe,EAAE,cAAc,SAAS,EAAE,QAAQ,IAAI,CAAC5B,EAAaL,EAAM,UAAUkB,GAAGA,EAAE,MAAM,SAAS,CAAC,CAAE,EAC5Fe,EAAE,cAAc,SAAS,EAAE,QAAQ,IAAIqB,EAAM,KAAK,EAClDrB,EAAE,cAAc,WAAW,EAAE,QAAQ,IAAIqB,EAAM,OAAO,EACtDrB,EAAE,cAAc,QAAQ,EAAE,QAAQ,IAAI,OAAO,MAAM,EACnD,IAAMqF,EAAarF,EAAE,cAAc,iBAAiB,EACpD,OAAGqF,IACE1B,GACD0B,EAAW,SAAW,GACtBA,EAAW,MAAQrB,EACnBqB,EAAW,YAAc,sCAEzBA,EAAW,QAAU,SAAU,CAv8EvC,IAAA/D,EAAAC,EAAA+D,EAAAC,EAAAC,EAw8EU,IAAMvB,EAAOI,GAAa9C,GAAAD,EAAAD,EAAM,OAAN,YAAAC,EAAY,OAAZ,YAAAC,EAAkB,IAAI,EAChD,GAAG,CAAC0C,EAAK,CAAE,MAAM,iDAAiD,EAAG,MAAQ,CAC7E,IAAMrF,EAAM0F,EAAUL,CAAI,EACpBwB,EAAY,CAAC,GAChBF,GAAAD,EAAAjE,EAAM,OAAN,YAAAiE,EAAY,OAAZ,MAAAC,EAAkB,OAAOE,EAAU,KAAKpE,EAAM,KAAK,KAAK,KAAK,EAChE,IAAMmD,EAAUU,EAAMA,EAAI,OAAQM,EAAAlF,EAAK,aAAa,KAAKuB,GAAC,CA78EpE,IAAAP,EAAAC,EA68EsE,OAAAM,EAAE,QAAMN,GAAAD,EAAAD,EAAM,OAAN,YAAAC,EAAY,aAAZ,YAAAC,EAAwB,KAAG,IAA7D,YAAAiE,EAAgE,OAAQ,GACvGhB,GAASiB,EAAU,KAAKjB,CAAO,EAClC,IAAMkB,EAAQD,EAAU,KAAK,UAAK,EAC5BE,EAAS,aACf,GAAGC,GAAahH,CAAG,EAAE,CAEnB,IAAMiH,EADSC,GAAc,EACR,KAAKC,GAAGA,EAAE,MAAMnH,CAAG,GAAK,CAAC,KAAAqF,EAAM,OAAO,EAAK,EAChE,GAAG,CACD,MAAM+B,GAAoBpH,EAAKiH,EAAOF,EAAQD,CAAK,EACnD,MAAM,GAAGzB,CAAI,4DAA4D,CAC3E,OAAOxC,EAAI,CACT,MAAM,kCAAkCA,GAAOA,EAAI,QAAUA,EAAI,QAAU,iBAAiB,EAAE,CAChG,CACF,KAAO,CACL,IAAMwE,EAAS,MAAMC,GAAejC,EAAM0B,EAAQD,CAAK,EACvD,GAAG,CAACO,EAAO,GAAG,CAAE,MAAMA,EAAO,GAAG,EAAG,MAAQ,CAC3C,MAAM,GAAGhC,CAAI,uBAAuB,CACtC,CACF,GAGGjE,CACT,CAKA,SAASmG,IAAW,CAClB,GAAG,CACDC,GAA0B,EAC1B5H,GAAU,EACVD,GAAa,EACb8H,GAAkB,CACpB,OAAQ5E,EAAI,CACV6E,GAAW,CAAC,kBAAkB,OAAO7E,GAAOA,EAAI,SAAWA,CAAG,CAAC,EAAE,CAAC,EAClE,QAAQ,MAAMA,CAAG,CACnB,CACF,CACA,SAAS4E,IAAmB,CAC1B,IAAMpH,EAAI,SAAS,eAAe,SAAS,EAAMA,IAAGA,EAAE,QAAQ,IAAIoC,EAAM,KAAK,GAC7E,IAAMkF,EAAI,SAAS,eAAe,SAAS,EAAMA,IAAGA,EAAE,QAAQ,IAAIlF,EAAM,KAAK,GAC7E,IAAMW,EAAI,SAAS,eAAe,WAAW,EAAMA,IAAGA,EAAE,QAAQ,IAAIX,EAAM,OAAO,GACjF,IAAMmF,EAAI,SAAS,eAAe,UAAU,EACzCA,IAAMA,EAAI,QAAQ,IAAI,CACpB,QAAQ,oCAAoC,IAC7CC,EAAgB,MAAM,EACtB,aAAa,WAAW,oBAAoB,EAC5C,MAAM,qCAAgC,EACtC,SAAS,OAAO,EAEpB,EACF,EAEC,gBAAgB,CACf,IAAMlH,EAAOC,GAAe,EAC5B,GAAGD,EAAK,OAAO,CAAE+G,GAAW/G,CAAI,EAAG8G,GAAkB,EAAG,MAAQ,CAChE,GAAG,CACD,MAAMK,EAAY,QAAQ,CAC5B,OAAOjF,EAAI,CACT,QAAQ,KAAK,sBAAuBA,CAAG,EACvCkF,EAAc,SAAS,yEAAyE,CAClG,CAGA,GAAG,CAAChD,GAAoBY,EAAmB,CACzC,IAAMqC,EAAaH,EAAgB,KAAK,EACxC,GAAIG,EAcFvF,EAAM,KAAOwF,EAAeD,CAAU,MAbtC,IAAG,CACD,IAAME,EAAa,MAAMC,GAAwBxC,CAAkB,EAChEuC,GAAc,OAAOA,GAAe,WAErCzF,EAAM,KAAOwF,EAAeC,CAAU,EACtCL,EAAgB,MAAMpF,EAAM,IAAI,EAChC,QAAQ,KAAK,iCAAkCkD,CAAkB,EAErE,OAAO9C,EAAI,CACT,QAAQ,KAAK,wCAAyCA,CAAG,CAC3D,CAKJ,CACA0E,GAAU,CACZ,GAAG,EAIH,OAAO,aAAe,OAAO,cAAgB,CAAC,EAC9C,OAAO,aAAa,MAAQ9E,EAC5B,OAAO,aAAa,KAAO,IAAMA,EAAM,KAAK",
  "names": ["ensureAppConfig", "cfg", "configured", "merged", "sameOrigin", "sessionHasPlayer", "session", "playerKey", "normalizedKey", "player", "APP_CONFIG", "ensureAppConfig", "API_BASE", "PlayerIdentity", "STORAGE_KEY", "GUEST_KEY", "read", "err", "requireKey", "key", "clear", "getRosterEntry", "getRosterList", "entry", "isGuest", "CURRENT_PLAYER_KEY", "IS_GUEST_SESSION", "READ_ONLY_NOTICE", "requireWritable", "action", "DEFAULT_SHARED_STATE", "normalisePlayer", "character", "sanitizeName", "rosterKey", "keySource", "playerName", "normaliseSession", "session", "id", "title", "sanitizeOptional", "dm", "date", "capacity", "players", "normaliseSharedState", "input", "safe", "clean", "item", "name", "rawKey", "value", "status", "notes", "hidden", "card", "OfflineStateStore", "raw", "parsed", "state", "NetworkStatus", "banner", "pending", "lastError", "update", "message", "DraftStatus", "el", "set", "tone", "withApiBase", "path", "apiFetch", "options", "url", "opts", "response", "text", "contentType", "payload", "renderCurrentPlayerBanner", "playerKey", "rosterEntry", "displayName", "displayLabel", "escapeHTML", "logoutBtn", "handleLogout", "SharedState", "source", "normalised", "list", "player", "cached", "fn", "Backend", "sessionId", "body", "res", "RosterExtrasStore", "RosterMetaStore", "HTML_ESCAPE", "ch", "escapeAttr", "BASE_ROSTER_KEYS", "rosterHasKey", "addRosterExtra", "cleanName", "cleanStatus", "cleanNotes", "updateRosterDetails", "hiddenOverride", "cleanKey", "getRosterList", "opts", "includeHidden", "extras", "RosterExtrasStore", "meta", "RosterMetaStore", "list", "DATA", "r", "key", "rosterKey", "override", "entry", "sanitizeOptional", "item", "a", "b", "toLocalICS", "dt", "pad", "n", "downloadICS", "session", "tz", "start", "end", "ics", "blob", "a", "DATA", "b", "BASE_ROSTER_KEYS", "r", "rosterKey", "SharedState", "ELIGIBILITY", "validateConfig", "errors", "ids", "s", "idx", "showErrors", "main", "box", "e", "LocalDraftStore", "raw", "err", "data", "cloneDraftData", "loadSavedBuildForPlayer", "playerKey", "encoded", "response", "withApiBase", "text", "err", "saveBuildForPlayer", "build", "State", "snapshot", "cloneDraftData", "LocalDraftStore", "DraftStatus", "IS_GUEST_SESSION", "CURRENT_PLAYER_KEY", "ok", "localDraft", "renderAll", "savedBuild", "blob", "url", "SharedState", "_a", "rosterEntry", "PlayerIdentity", "renderDashboard", "_b", "_c", "core", "uni", "hasCharacter", "characterContent", "charName", "escapeHTML", "charClass", "charLevel", "uniKey", "uniName", "DATA", "u", "sessions", "playerSession", "s", "sessionHasPlayer", "sessionContent", "filled", "bindDashboardNav", "container", "btn", "target", "STEPS", "idx", "activateStep", "buildReady", "c", "renderSessionCards", "opts", "readOnly", "builds", "a", "b", "full", "playerInSession", "roster", "player", "extra", "classLabel", "uniLabel", "label", "rosterKey", "actionBtn", "escapeAttr", "joinDisabled", "themeInfo", "focusInfo", "finaleIndicator", "playerIndicator", "card", "setupCommentBoard", "root", "form", "textarea", "playerInput", "characterInput", "sessionInput", "list", "refreshBtn", "status", "statusTimer", "submitButton", "commentsReadOnly", "announce", "message", "tone", "inputEl", "READ_ONLY_NOTICE", "note", "formatStamp", "iso", "sortComments", "entries", "aTime", "normaliseComment", "input", "_d", "_e", "_f", "_g", "baseId", "textValue", "playerName", "sanitizeOptional", "characterName", "sessionId", "createdAt", "stamp", "state", "setComments", "seen", "cleaned", "entry", "normalised", "renderList", "item", "copy", "meta", "span", "remove", "handleDelete", "fetchComments", "silent", "payload", "apiFetch", "rows", "previous", "event", "optimistic", "saved", "hydrateQuestBoard", "quests", "frag", "quest", "title", "idSpan", "statusSpan", "notes", "getBuildCards", "STEPS", "currentStep", "focusCurrentTab", "nav", "active", "activateStep", "idx", "focusTab", "renderPanels", "renderNav", "onStepRailKeydown", "event", "target", "key", "currentIndex", "nextIndex", "previousScroll", "fragments", "s", "button", "selected", "hint", "escapeHTML", "badge", "errs", "validateConfig", "el", "step", "panelEl", "panelBuilder", "panelSummary", "panelIntro", "panelJoin", "p", "dashboardHtml", "renderDashboard", "setupCommentBoard", "hydrateQuestBoard", "bindDashboardNav", "DATA", "j", "markSaved", "section", "msg", "levelSel", "o", "box", "drawAbilityInputs", "m", "abilities", "arr", "ab", "d", "v", "State", "_a", "_b", "abObj", "err", "sel", "collegeGrid", "renderCollegeCards", "u", "card", "selectCollege", "e", "isSelected", "drawInfo", "out", "x", "spellRows", "lvl", "list", "f", "clubWrap", "drawClubs", "c", "id", "jobSel", "k", "readExtras", "jobKey", "pickedClubs", "maxClubs", "last", "job", "clubs", "parts", "quickPrompts", "boxPrompts", "q", "b", "IS_GUEST_SESSION", "wrap", "renderSessionCards", "ev", "addBtn", "READ_ONLY_NOTICE", "name", "ELIGIBILITY", "players", "player", "sanitizeName", "rosterKey", "CURRENT_PLAYER_KEY", "uniName", "builds", "getBuildCards", "klass", "rosterEntry", "PlayerIdentity", "Backend", "leaveBtn", "icsBtn", "downloadICS", "uni", "abilityList", "jobName", "publishBtn", "_c", "_d", "_e", "noteParts", "notes", "status", "rosterHasKey", "entry", "getRosterList", "r", "updateRosterDetails", "result", "addRosterExtra", "renderAll", "renderCurrentPlayerBanner", "bindHeaderActions", "showErrors", "l", "clr", "LocalDraftStore", "SharedState", "NetworkStatus", "localDraft", "cloneDraftData", "savedBuild", "loadSavedBuildForPlayer"]
}
